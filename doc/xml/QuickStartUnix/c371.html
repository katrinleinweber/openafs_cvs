<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Installing the First AFS Machine</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="AFS Quick Beginnings"
HREF="book1.html"><LINK
REL="PREVIOUS"
TITLE="Installation Overview"
HREF="c104.html"><LINK
REL="NEXT"
TITLE="Installing Additional Server Machines"
HREF="c5467.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>AFS Quick Beginnings: Version 3.6</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c104.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c5467.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="HDRWQ17"
></A
>Chapter 2. Installing the First AFS Machine</H1
><P
>This chapter describes how to install the first AFS machine in your cell, configuring it as both a file server machine and a
  client machine. After completing all procedures in this chapter, you can remove the client functionality if you wish, as described
  in <A
HREF="c371.html#HDRWQ98"
>Removing Client Functionality</A
>.</P
><P
>To install additional file server machines after completing this chapter, see <A
HREF="c5467.html"
>Installing Additional
  Server Machines</A
>.</P
><P
>To install additional client machines after completing this chapter, see <A
HREF="c8044.html"
>Installing Additional
  Client Machines</A
>. </P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="Header_29"
>Requirements and Configuration Decisions</A
></H1
><P
>The instructions in this chapter assume that you meet the following requirements. <UL
><LI
><P
>You are logged onto the machine's console as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
></P
></LI
><LI
><P
>A standard version of one of the operating systems supported by the current version of AFS is running on the
          machine</P
></LI
><LI
><P
>You can access the data on the AFS CD-ROMs, either through a local CD drive or via an NFS mount of a CD drive
          attached to a machine that is accessible by network</P
></LI
></UL
></P
><P
>You must make the following configuration decisions while installing the first AFS machine. To speed the installation
    itself, it is best to make the decisions before beginning. See the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration
    Guide</I
></SPAN
> about issues in cell administration and configuration for detailed guidelines.    <UL
><LI
><P
>Select the first AFS machine</P
></LI
><LI
><P
>Select the cell name</P
></LI
><LI
><P
>Decide which partitions or logical volumes to configure as AFS server partitions, and choose the directory names on
          which to mount them</P
></LI
><LI
><P
>Decide whether to use the standard AFS authentication and authorization software or Kerberos as obtained from
          another source. On several system types, the decision determines how you incorporate AFS into the machine's authentication
          system. If you wish to use Kerberos, contact the AFS Product Support group now to learn about how you must modify the
          installation procedure.</P
></LI
><LI
><P
>Decide how big to make the client cache</P
></LI
><LI
><P
>Decide how to configure the top levels of your cell's AFS filespace</P
></LI
></UL
></P
><P
>This chapter is divided into three large sections corresponding to the three parts of installing the first AFS machine.
    Perform all of the steps in the order they appear. Each functional section begins with a summary of the procedures to perform.
    The sections are as follows: <UL
><LI
><P
>Installing server functionality (begins in <A
HREF="c371.html#HDRWQ18"
>Overview: Installing Server
          Functionality</A
>)</P
></LI
><LI
><P
>Installing client functionality (begins in <A
HREF="c371.html#HDRWQ63"
>Overview: Installing Client
          Functionality</A
>)</P
></LI
><LI
><P
>Configuring your cell's filespace, establishing further security mechanisms, and enabling access to foreign cells
          (begins in <A
HREF="c371.html#HDRWQ71"
>Overview: Completing the Installation of the First AFS Machine</A
>)</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ18"
>Overview: Installing Server Functionality</A
></H1
><P
>In the first phase of installing your cell's first AFS machine, you install file server and database server functionality
    by performing the following procedures: <OL
TYPE="1"
><LI
><P
>Choose which machine to install as the first AFS machine</P
></LI
><LI
><P
>Create AFS-related directories on the local disk</P
></LI
><LI
><P
>Incorporate AFS modifications into the machine's kernel</P
></LI
><LI
><P
>Configure partitions or logical volumes for storing AFS volumes</P
></LI
><LI
><P
>On some system types, install and configure an AFS-modified version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
>
          program</P
></LI
><LI
><P
>If the machine is to remain a client machine, incorporate AFS into its authentication system</P
></LI
><LI
><P
>Start the Basic OverSeer (BOS) Server</P
></LI
><LI
><P
>Define the cell name and the machine's cell membership</P
></LI
><LI
><P
>Start the database server processes: Authentication Server, Backup Server, Protection Server, and Volume Location
          (VL) Server</P
></LI
><LI
><P
>Configure initial security mechanisms</P
></LI
><LI
><P
>Start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process, which incorporates three component processes: the File
          Server, Volume Server, and Salvager</P
></LI
><LI
><P
>Start the server portion of the Update Server</P
></LI
><LI
><P
>Start the controller process (called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
>) for the Network Time Protocol Daemon,
          which synchronizes machine clocks</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ19"
>Choosing the First AFS Machine</A
></H1
><P
>The first AFS machine you install must have sufficient disk space to store AFS volumes. To take best advantage of AFS's
    capabilities, store client-side binaries as well as user files in volumes. When you later install additional file server
    machines in your cell, you can distribute these volumes among the different machines as you see fit.</P
><P
>These instructions configure the first AFS machine as a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>database server machine</I
></SPAN
>, the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>binary
    distribution machine</I
></SPAN
> for its system type, and the cell's <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>system control machine</I
></SPAN
>. For a
    description of these roles, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
>.</P
><P
>Installation of additional machines is simplest if the first machine has the lowest IP address of any database server
    machine you currently plan to install. If you later install database server functionality on a machine with a lower IP address,
    you must first update the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file on all of your cell's client machines.
    For more details, see <A
HREF="c5467.html#HDRWQ114"
>Installing Database Server Functionality</A
>.</P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="Header_32"
>Creating AFS Directories</A
></H1
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directories on the
    local disk, to house server and client files respectively. Subsequent instructions copy files from the AFS CD-ROM into them.
    Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory as a mount point for CD-ROMs, if it does not already exist.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /cdrom</B
></SPAN
> 
</PRE
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ20"
>Performing Platform-Specific Procedures</A
></H1
><P
>Several of the initial procedures for installing a file server machine differ for each system type. For convenience, the
    following sections group them together for each system type: <UL
><LI
><P
>Incorporate AFS modifications into the kernel.</P
><P
>The kernel on every AFS file server and client machine must incorporate AFS extensions. On machines that use a
          dynamic kernel module loader, it is conventional to alter the machine's initialization script to load the AFS extensions
          at each reboot.       </P
></LI
><LI
><P
>Configure server partitions or logical volumes to house AFS volumes.</P
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes
          (for convenience, the documentation hereafter refers to partitions only). Each server partition is mounted at a directory
          named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where <VAR
CLASS="replaceable"
>xx</VAR
> is one or
          two lowercase letters. By convention, the first 26 partitions are mounted on the directories called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepa</B
></SPAN
> through <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepz</B
></SPAN
>, the 27th one is mounted on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepaa</B
></SPAN
> directory, and so on through <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepaz</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepba</B
></SPAN
>, continuing up to the index corresponding to the maximum number of server partitions
          supported in the current version of AFS (which is specified in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>).</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server
          machine's root directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is
          not an acceptable directory location).</P
><P
>You can also add or remove server partitions on an existing file server machine. For instructions, see the chapter
          in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about maintaining server machines.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Not all file system types supported by an operating system are necessarily supported as AFS server partitions. For
            possible restrictions, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
></BLOCKQUOTE
></DIV
></LI
><LI
><P
>On some system types, install and configure a modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program which
          recognizes the structures that the File Server uses to organize volume data on AFS server partitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program provided with the operating system does not understand the AFS data structures, and so
          removes them to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>lost+found</B
></SPAN
> directory.</P
></LI
><LI
><P
>If the machine is to remain an AFS client machine, modify the machine's authentication system so that users obtain
          an AFS token as they log into the local file system. Using AFS is simpler and more convenient for your users if you make
          the modifications on all client machines. Otherwise, users must perform a two-step login procedure (login to the local
          file system and then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> command). For further discussion of AFS
          authentication, see the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about cell configuration and
          administration issues.</P
></LI
></UL
></P
><P
>To continue, proceed to the appropriate section: <UL
><LI
><P
><A
HREF="c371.html#HDRWQ21"
>Getting Started on AIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ26"
>Getting Started on Digital UNIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ31"
>Getting Started on HP-UX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ36"
>Getting Started on IRIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ41"
>Getting Started on Linux Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ45"
>Getting Started on Solaris Systems</A
></P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ21"
>Getting Started on AIX Systems</A
></H1
><P
>Begin by running the AFS initialization script to call the AIX kernel extension facility, which dynamically loads AFS
    modifications into the kernel. Then use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SMIT</B
></SPAN
> program to configure partitions for storing
    AFS volumes, and replace the AIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program helper with a version that correctly handles AFS
    volumes. If the machine is to remain an AFS client machine, incorporate AFS into the AIX secondary authentication system.
       </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ22"
>Loading AFS into the AIX Kernel</A
></H2
><P
>The AIX kernel extension facility is the dynamic kernel loader provided by IBM Corporation. AIX does not support
      incorporation of AFS modifications during a kernel build.</P
><P
>For AFS to function correctly, the kernel extension facility must run each time the machine reboots, so the AFS
      initialization script (included in the AFS distribution) invokes it automatically. In this section you copy the script to the
      conventional location and edit it to select the appropriate options depending on whether NFS is also to run.</P
><P
>After editing the script, you run it to incorporate AFS into the kernel. In later sections you verify that the script
      correctly initializes all AFS components, then configure the AIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>inittab</B
></SPAN
> file so that the
      script runs automatically at reboot. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for AIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
            mounting CD-ROMs (either locally or remotely via NFS), see your AIX documentation. Then change directory as indicated.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/rs_aix42/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel library files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/dkload</B
></SPAN
> directory,
            and the AFS initialization script to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  dkload  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  rc.afs  /etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
> script, setting the <SAMP
CLASS="computeroutput"
>NFS</SAMP
>
            variable as indicated.</P
><P
>If the machine is not to function as an NFS/AFS Translator, set the <SAMP
CLASS="computeroutput"
>NFS</SAMP
> variable
            as follows.</P
><PRE
CLASS="programlisting"
>&#13;   NFS=$NFS_NONE
</PRE
><P
>If the machine is to function as an NFS/AFS Translator and is running AIX 4.2.1 or higher, set the
            <SAMP
CLASS="computeroutput"
>NFS</SAMP
> variable as follows. Note that NFS must already be loaded into the kernel, which
            happens automatically on systems running AIX 4.1.1 and later, as long as the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/exports</B
></SPAN
> exists.</P
><PRE
CLASS="programlisting"
>&#13;   NFS=$NFS_IAUTH
</PRE
></LI
><LI
><P
>Invoke the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
> script to load AFS modifications into the kernel. You can
            ignore any error messages about the inability to start the BOS Server or the Cache Manager or AFS client.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ23"
>Configuring Server Partitions on AIX Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific
      Procedures</A
>.</P
><P
>To configure server partitions on an AIX system, perform the following procedures: <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SMIT</B
></SPAN
> program to create a journaling file system on each partition to be
            configured as an AFS server partition.</P
></LI
><LI
><P
>Mount each partition at one of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
            directories. Choose one of the following three methods: <UL
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SMIT</B
></SPAN
> program</P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all partitions at once</P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command on each partition in turn</P
></LI
></UL
></P
><P
>Also configure the partitions so that they are mounted automatically at each reboot. For more information, refer
            to the AIX documentation.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ24"
>Replacing the fsck Program Helper on AIX Systems</A
></H2
><P
>In this section, you make modifications to guarantee that the appropriate <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program
      runs on AFS server partitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program provided with the operating system must never
      run on AFS server partitions. Because it does not recognize the structures that the File Server uses to organize volume data,
      it removes all of the data. To repeat:</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Never run the standard fsck program on AFS server partitions. It discards AFS
      volumes.</B
></SPAN
></P
><P
>On AIX systems, you do not replace the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> binary itself, but rather the
      <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>program helper</I
></SPAN
> file included in the AIX distribution as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/helpers/v3fshelper</B
></SPAN
>. <OL
TYPE="1"
><LI
><P
>Move the AIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program helper to a safe location and install the version from
            the AFS distribution in its place. The AFS CD-ROM must still be mounted at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
>
            directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin/helpers</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv v3fshelper v3fshelper.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p /cdrom/rs_aix42/root.server/etc/v3fshelper v3fshelper</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ25"
>Enabling AFS Login on AIX Systems</A
>. Otherwise, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the
            BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ25"
>Enabling AFS Login on AIX Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>Follow the instructions in this section to incorporate AFS modifications into the AIX secondary authentication system.
      <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls</B
></SPAN
> command to verify that the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs_dynamic_auth</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs_dynamic_kerbauth</B
></SPAN
> programs are installed
            in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls /usr/vice/etc</B
></SPAN
>   
</PRE
></P
><P
>If the files do not exist, mount the AFS CD-ROM for AIX (if it is not already), change directory as indicated, and
            copy them.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/rs_aix42/root.client/usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  -p  afs_dynamic*  /usr/vice/etc</B
></SPAN
>
</PRE
></LI
><LI
><P
>Edit the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/security/user</B
></SPAN
> file, making changes to the indicated stanzas:
            <UL
><LI
><P
>In the default stanza, set the <SAMP
CLASS="computeroutput"
>registry</SAMP
> attribute to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>DCE</B
></SPAN
> (not to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS</B
></SPAN
>), as follows: <PRE
CLASS="programlisting"
>&#13;   registry = DCE
</PRE
></P
></LI
><LI
><P
>In the default stanza, set the <SAMP
CLASS="computeroutput"
>SYSTEM</SAMP
> attribute as indicated.</P
><P
>If the machine is an AFS client only, set the following value:</P
><PRE
CLASS="programlisting"
>&#13;   SYSTEM = "AFS OR (AFS[UNAVAIL] AND compat[SUCCESS])"   
</PRE
><P
>If the machine is both an AFS and a DCE client, set the following value (it must appear on a single line in
                  the file):</P
><PRE
CLASS="programlisting"
>&#13;   SYSTEM = "DCE OR DCE[UNAVAIL] OR AFS OR (AFS[UNAVAIL]  \
       AND compat[SUCCESS])"
</PRE
></LI
><LI
><P
>In the <SAMP
CLASS="computeroutput"
>root</SAMP
> stanza, set the <SAMP
CLASS="computeroutput"
>registry</SAMP
>
                  attribute as follows. It enables the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> to log into the local
                  file system only, based on the password listed in the local password file. <PRE
CLASS="programlisting"
>&#13;   root:
         registry = files
</PRE
></P
></LI
></UL
></P
></LI
><LI
><P
>Edit the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/security/login.cfg</B
></SPAN
> file, creating or editing the indicated
            stanzas: <UL
><LI
><P
>In the <SAMP
CLASS="computeroutput"
>DCE</SAMP
> stanza, set the <SAMP
CLASS="computeroutput"
>program</SAMP
>
                  attribute as follows.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process):</P
><PRE
CLASS="programlisting"
>&#13;   DCE:
        program = /usr/vice/etc/afs_dynamic_auth   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication:</P
><PRE
CLASS="programlisting"
>&#13;   DCE:
        program = /usr/vice/etc/afs_dynamic_kerbauth
</PRE
></LI
><LI
><P
>In the <SAMP
CLASS="computeroutput"
>AFS</SAMP
> stanza, set the <SAMP
CLASS="computeroutput"
>program</SAMP
>
                  attribute as follows.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process):</P
><PRE
CLASS="programlisting"
>&#13;   AFS:
        program = /usr/vice/etc/afs_dynamic_auth   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication:</P
><PRE
CLASS="programlisting"
>&#13;   AFS:
        program = /usr/vice/etc/afs_dynamic_kerbauth
</PRE
></LI
></UL
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> (or if referring to these instructions while
            installing an additional file server machine, return to <A
HREF="c5467.html#HDRWQ108"
>Starting Server
            Programs</A
>).</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ26"
>Getting Started on Digital UNIX Systems</A
></H1
><P
>Begin by either building AFS modifications into a new static kernel or by setting up to dynamically load the AFS kernel
    module. Then create partitions for storing AFS volumes, and replace the Digital UNIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
>
    program with a version that correctly handles AFS volumes. If the machine is to remain an AFS client machine, incorporate AFS
    into the machine's Security Integration Architecture (SIA) matrix.    </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ27a"
>Loading AFS into the Digital UNIX Kernel</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sysconfig</B
></SPAN
> program is the dynamic kernel loader provided for Digital UNIX
      systems.</P
><P
>For AFS to function correctly, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sysconfig</B
></SPAN
> program must run each time the machine
      reboots, so the AFS initialization script (included on the AFS CD-ROM) invokes it automatically. In this section you copy the
      appropriate AFS library file to the location where the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sysconfig</B
></SPAN
> program accesses it and then
      run the script.</P
><P
>Mount the AFS CD-ROM for Digital UNIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions
      on mounting CD-ROMs (either locally or remotely via NFS), see your Digital UNIX documentation. Then change directory as
      indicated.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/root.client</B
></SPAN
>
</PRE
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> on Digital UNIX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
      extension as you copy the script.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp usr/vice/etc/afs.rc  /sbin/init.d/afs</B
></SPAN
>
</PRE
><P
>Copy the AFS kernel module to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/subsys</B
></SPAN
> directory.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/afs.mod /subsys/afs.mod</B
></SPAN
>   
</PRE
><P
>Set up the system to load the module at startup.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/autosysconfig add afs</B
></SPAN
>
</PRE
><P
>Reboot the machine to start using the new kernel, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ27"
>Building AFS into the Digital UNIX Kernel</A
></H2
><P
>Use the following instructions to build AFS modifications into the kernel on a Digital UNIX system. <OL
TYPE="1"
><LI
><P
>Create a copy called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS</B
></SPAN
> of the basic kernel configuration file included in the
            Digital UNIX distribution as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/conf/</B
></SPAN
><VAR
CLASS="replaceable"
>machine_name</VAR
>,
            where <VAR
CLASS="replaceable"
>machine_name</VAR
> is the machine's hostname in all uppercase letters. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/sys/conf</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
> <VAR
CLASS="replaceable"
>machine_name</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Add AFS to the list of options in the configuration file you created in the previous step, so that the result
            looks like the following: <PRE
CLASS="programlisting"
>&#13;          .                   .
          .                   .
       options               UFS
       options               NFS
       options               AFS
          .                   .
          .                   .
</PRE
></P
></LI
><LI
><P
>Add an entry for AFS to two places in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/conf/files</B
></SPAN
>. <UL
><LI
><P
>Add a line for AFS to the list of <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
>, so that the result looks like
                  the following: <PRE
CLASS="programlisting"
>&#13;             .                .      .
             .                .      .
      OPTIONS/nfs          optional nfs 
      OPTIONS/afs          optional afs 
      OPTIONS/nfs_server   optional nfs_server
             .                .      .
             .                .      .
</PRE
></P
></LI
><LI
><P
>Add an entry for AFS to the list of <SAMP
CLASS="computeroutput"
>MODULES</SAMP
>, so that the result looks like
                  the following: <PRE
CLASS="programlisting"
>&#13;             .                  .        .          .
             .                  .        .          .
      #
      MODULE/nfs_server     optional nfs_server Binary
      nfs/nfs_server.c      module nfs_server optimize -g3
      nfs/nfs3_server.c     module nfs_server optimize -g3
      #
      MODULE/afs            optional afs Binary
      afs/libafs.c          module afs
      #
</PRE
></P
></LI
></UL
></P
></LI
><LI
><P
>Add an entry for AFS to two places in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/vfs/vfs_conf.c</B
></SPAN
>.
            <UL
><LI
><P
>Add AFS to the list of defined file systems, so that the result looks like the following: <PRE
CLASS="programlisting"
>&#13;        .       .              
        .       .              
     #include &#60;afs.h&#62;
     #if defined(AFS) &#38;&#38; AFS
            extern struct vfsops afs_vfsops;
     #endif  
        .       .              
        .       .              
</PRE
></P
></LI
><LI
><P
>Put a declaration for AFS in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfssw[]</B
></SPAN
> table's MOUNT_ADDON slot, so that
                  the result looks like the following: <PRE
CLASS="programlisting"
>&#13;        .                          .              .
        .                          .              .
      &#38;fdfs_vfsops,         "fdfs",   /* 12 = MOUNT_FDFS */
   #if  defined(AFS)
      &#38;afs_vfsops,          "afs",
   #else
      (struct vfsops *)0,   "",       /* 13 = MOUNT_ADDON */
   #endif
   #if NFS &#38;&#38; INFS_DYNAMIC   
       &#38;nfs3_vfsops,        "nfsv3",  /* 14 = MOUNT_NFS3 */         
</PRE
></P
></LI
></UL
></P
></LI
><LI
><P
>Mount the AFS CD-ROM for Digital UNIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For
            instructions on mounting CD-ROMs (either locally or remotely via NFS), see your Digital UNIX documentation. Then change
            directory as indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> on Digital UNIX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
> extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp usr/vice/etc/afs.rc  /sbin/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel module to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys/BINARY</B
></SPAN
> directory.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.o /usr/sys/BINARY/afs.mod</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.nonfs.o /usr/sys/BINARY/afs.mod</B
></SPAN
>
</PRE
></LI
><LI
><P
>Configure and build the kernel. Respond to any prompts by pressing &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62;. The resulting kernel resides in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sys/AFS/vmunix</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>doconfig -c AFS</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Rename the existing kernel file and copy the new, AFS-modified file to the standard location. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv /vmunix /vmunix_noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /sys/AFS/vmunix /vmunix</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Reboot the machine to start using the new kernel, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ28"
>Configuring Server Partitions on Digital UNIX Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific Procedures</A
>.
      <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each directory just created. The entry maps the directory name to the disk
            partition to be mounted on it. <PRE
CLASS="programlisting"
>&#13;   /dev/<VAR
CLASS="replaceable"
>disk</VAR
> /vicep<VAR
CLASS="replaceable"
>xx</VAR
> ufs rw 0 2
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/rz3a /vicepa ufs rw 0 2
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate, but
            consult the Digital UNIX documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>newfs -v /dev/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
            partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ29"
>Replacing the fsck Program on Digital UNIX Systems</A
></H2
><P
>In this section, you make modifications to guarantee that the appropriate <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program
      runs on AFS server partitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program provided with the operating system must never
      run on AFS server partitions. Because it does not recognize the structures that the File Server uses to organize volume data,
      it removes all of the data. To repeat:</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Never run the standard fsck program on AFS server partitions. It discards AFS
      volumes.</B
></SPAN
></P
><P
>On Digital UNIX systems, the files <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/fsck</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sbin/fsck</B
></SPAN
> are driver programs. Rather than replacing either of them, you replace the actual binary
      included in the Digital UNIX distribution as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/ufs_fsck</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sbin/ufs_fsck</B
></SPAN
>. <OL
TYPE="1"
><LI
><P
>Install the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin</B
></SPAN
> and
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sbin</B
></SPAN
> directories. The AFS CD-ROM must still be mounted at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/root.server/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp vfsck /sbin/vfsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp vfsck /usr/sbin/vfsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Rename the Digital UNIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> binaries and create symbolic links to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> program. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv ufs_fsck ufs_fsck.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s vfsck ufs_fsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/sbin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv ufs_fsck ufs_fsck.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s vfsck ufs_fsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ30"
>Enabling AFS Login on Digital UNIX Systems</A
>. Otherwise, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ30"
>Enabling AFS Login on Digital UNIX Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>On Digital UNIX systems, the AFS initialization script automatically incorporates the AFS authentication library file
      into the Security Integration Architecture (SIA) matrix on the machine, so that users with AFS accounts obtain a token at
      login. In this section you copy the library file to the appropriate location.</P
><P
>For more information on SIA, see the Digital UNIX reference page for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>matrix.conf</B
></SPAN
>, or
      consult the section on security in your Digital UNIX documentation.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If the machine runs both the DCE and AFS client software, AFS must start after DCE. Consult the AFS initialization
        script for suggested symbolic links to create for correct ordering. Also, the system startup script order must initialize
        SIA before any long-running process that uses authentication.</P
></BLOCKQUOTE
></DIV
><P
>Perform the following steps to enable AFS login. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Digital UNIX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, if it is not
            already. Change directory as indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/alpha_dux40/lib/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS authentication library file to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/shlib</B
></SPAN
>
            directory.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process) in the cell:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  libafssiad.so  /usr/shlib</B
></SPAN
>   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication, rename the library file as you copy it:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  libafssiad.krb.so  /usr/shlib/libafssiad.so</B
></SPAN
>
</PRE
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> (or if referring to these instructions while
            installing an additional file server machine, return to <A
HREF="c5467.html#HDRWQ108"
>Starting Server
            Programs</A
>).</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ31"
>Getting Started on HP-UX Systems</A
></H1
><P
>Begin by building AFS modifications into a new kernel; HP-UX does not support dynamic loading. Then create partitions for
    storing AFS volumes, and install and configure the AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program to run on AFS
    server partitions. If the machine is to remain an AFS client machine, incorporate AFS into the machine's Pluggable
    Authentication Module (PAM) scheme.    </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ32"
>Building AFS into the HP-UX Kernel</A
></H2
><P
>Use the following instructions to build AFS modifications into the kernel on an HP-UX system. <OL
TYPE="1"
><LI
><P
>Move the existing kernel-related files to a safe location. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /stand/vmunix /stand/vmunix.noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /stand/system /stand/system.noafs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Mount the AFS CD-ROM for HP-UX on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
            mounting CD-ROMs (either locally or remotely via NFS), see your HP-UX documentation. Then change directory as indicated.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/hp_ux110/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization file to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> on HP-UX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
            extension as you copy the file. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp usr/vice/etc/afs.rc  /sbin/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs.driver</B
></SPAN
> to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/conf/master.d</B
></SPAN
> directory, changing its name to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> as you
            do. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  usr/vice/etc/afs.driver  /usr/conf/master.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel module to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/conf/lib</B
></SPAN
> directory.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.a /usr/conf/lib</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality, change the file's name as you copy it:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp bin/libafs.nonfs.a /usr/conf/lib/libafs.a</B
></SPAN
>
</PRE
></LI
><LI
><P
>Incorporate the AFS driver into the kernel, either using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program or a
            series of individual commands. <UL
><LI
><P
>To use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program: <OL
TYPE="a"
><LI
><P
>Invoke the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program, specifying the hostname of the local machine
                        as <VAR
CLASS="replaceable"
>local_hostname</VAR
>. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> graphical user
                        interface pops up. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sam -display</B
></SPAN
> <VAR
CLASS="replaceable"
>local_hostname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>:0</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Kernel Configuration</B
></SPAN
> icon, then the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Drivers</B
></SPAN
> icon. From the list of drivers, select <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
>.</P
></LI
><LI
><P
>Open the pull-down <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Actions</B
></SPAN
> menu and choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Add Driver to Kernel</B
></SPAN
> option.</P
></LI
><LI
><P
>Open the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Actions</B
></SPAN
> menu again and choose the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Create a New Kernel</B
></SPAN
> option.</P
></LI
><LI
><P
>Confirm your choices by choosing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Yes</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>OK</B
></SPAN
> when prompted by subsequent pop-up windows. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program builds the kernel and reboots the system.</P
></LI
><LI
><P
>Login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
>To use individual commands: <OL
TYPE="a"
><LI
><P
>Edit the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/system</B
></SPAN
>, adding an entry for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> to the <SAMP
CLASS="computeroutput"
>Subsystems</SAMP
> section.</P
></LI
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/build</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mk_kernel</B
></SPAN
> command to build the kernel. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /stand/build</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mk_kernel</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Move the new kernel to the standard location (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/stand/vmunix</B
></SPAN
>), reboot
                        the machine to start using it, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                        <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv /stand/build/vmunix_test /stand/vmunix</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>             
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></LI
></UL
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ33"
>Configuring Server Partitions on HP-UX Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific Procedures</A
>.
      <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program to create a file system on each partition. For instructions,
            consult the HP-UX documentation.</P
></LI
><LI
><P
>On some HP-UX systems that use logical volumes, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>SAM</B
></SPAN
> program automatically
            mounts the partitions. If it has not, mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount
            -a</B
></SPAN
> command to mount all partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount
            each partition in turn.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ34"
>Configuring the AFS-modified fsck Program on HP-UX Systems</A
></H2
><P
>In this section, you make modifications to guarantee that the appropriate <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program
      runs on AFS server partitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program provided with the operating system must never
      run on AFS server partitions. Because it does not recognize the structures that the File Server uses to organize volume data,
      it removes all of the data. To repeat:</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Never run the standard fsck program on AFS server partitions. It discards AFS
      volumes.</B
></SPAN
></P
><P
>On HP-UX systems, there are several configuration files to install in addition to the AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary). <OL
TYPE="1"
><LI
><P
>Create the command configuration file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/lib/mfsconfig.d/afs</B
></SPAN
>. Use a text
            editor to place the indicated two lines in it: <PRE
CLASS="programlisting"
>&#13;   format_revision 1
   fsck            0        m,P,p,d,f,b:c:y,n,Y,N,q,
</PRE
></P
></LI
><LI
><P
>Create and change directory to an AFS-specific command directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/fs/afs</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /sbin/fs/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /sbin/fs/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS-modified version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary) and related files from the distribution directory to the new AFS-specific command
            directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p /cdrom/hp_ux110/root.server/etc/*  .</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Change the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary's name to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> and set
            the mode bits appropriately on all of the files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/fs/afs</B
></SPAN
> directory.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv  vfsck  fsck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chmod  755  *</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
> file, changing the file system type for each AFS server
            partition from <SAMP
CLASS="computeroutput"
>hfs</SAMP
> to <SAMP
CLASS="computeroutput"
>afs</SAMP
>. This ensures that the
            AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program runs on the appropriate partitions.</P
><P
>The sixth line in the following example of an edited file shows an AFS server partition, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepa</B
></SPAN
>.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/vg00/lvol1 / hfs defaults 0 1
   /dev/vg00/lvol4 /opt hfs defaults 0 2
   /dev/vg00/lvol5 /tmp hfs defaults 0 2
   /dev/vg00/lvol6 /usr hfs defaults 0 2
   /dev/vg00/lvol8 /var hfs defaults 0 2
   /dev/vg00/lvol9 /vicepa afs defaults 0 2
   /dev/vg00/lvol7 /usr/vice/cache hfs defaults 0 2
</PRE
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ35"
>Enabling AFS Login on HP-UX Systems</A
>. Otherwise, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the
            BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ35"
>Enabling AFS Login on HP-UX Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>At this point you incorporate AFS into the operating system's Pluggable Authentication Module (PAM) scheme. PAM
      integrates all authentication mechanisms on the machine, including login, to provide the security infrastructure for
      authenticated access to and from the machine.</P
><P
>Explaining PAM is beyond the scope of this document. It is assumed that you understand the syntax and meanings of
      settings in the PAM configuration file (for example, how the <SAMP
CLASS="computeroutput"
>other</SAMP
> entry works, the effect of
      marking an entry as <SAMP
CLASS="computeroutput"
>required</SAMP
>, <SAMP
CLASS="computeroutput"
>optional</SAMP
>, or
      <SAMP
CLASS="computeroutput"
>sufficient</SAMP
>, and so on).</P
><P
>The following instructions explain how to alter the entries in the PAM configuration file for each service for which you
      wish to use AFS authentication. Other configurations possibly also work, but the instructions specify the recommended and
      tested configuration.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>The instructions specify that you mark each entry as <SAMP
CLASS="computeroutput"
>optional</SAMP
>. However, marking some
        modules as optional can mean that they grant access to the corresponding service even when the user does not meet all of the
        module's requirements. In some operating system revisions, for example, if you mark as optional the module that controls
        login via a dial-up connection, it allows users to login without providing a password. See the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release
        Notes</I
></SPAN
> for a discussion of any limitations that apply to this operating system.</P
><P
>Also, with some operating system versions you must install patches for PAM to interact correctly with certain
        authentication programs. For details, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
></BLOCKQUOTE
></DIV
><P
>The recommended AFS-related entries in the PAM configuration file make use of one or more of the following three
      attributes. <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>try_first_pass</SAMP
></B
></SPAN
></DT
><DD
><P
>This is a standard PAM attribute that can be included on entries after the first one for a service; it directs
              the module to use the password that was provided to the first module. For the AFS module, it means that AFS
              authentication succeeds if the password provided to the module listed first is the user's correct AFS password. For
              further discussion of this attribute and its alternatives, see the operating system's PAM documentation.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>ignore_root</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, directs it to ignore not only the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>, but also any user with UID 0 (zero).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>setenv_password_expires</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, sets the environment variable PASSWORD_EXPIRES to the expiration
              date of the user's AFS password, which is recorded in the Authentication Database.</P
></DD
></DL
></DIV
></P
><P
>Perform the following steps to enable AFS login. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for HP-UX on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, if it is not already.
            Then change directory as indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/lib/security</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS authentication library file to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/security</B
></SPAN
> directory. Then
            create a symbolic link to it whose name does not mention the version. Omitting the version eliminates the need to edit
            the PAM configuration file if you later update the library file.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process) in the cell:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/hp_ux110/lib/pam_afs.so.1  .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  pam_afs.so.1  pam_afs.so</B
></SPAN
>   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/hp_ux110/lib/pam_afs.krb.so.1   .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s pam_afs.krb.so.1 pam_afs.so</B
></SPAN
>
</PRE
></LI
><LI
><P
>Edit the <SAMP
CLASS="computeroutput"
>Authentication management</SAMP
> section of the HP-UX PAM configuration file,
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/pam.conf</B
></SPAN
> by convention. The entries in this section have the value
            <SAMP
CLASS="computeroutput"
>auth</SAMP
> in their second field.</P
><P
>First edit the standard entries, which refer to the HP-UX PAM module (usually, the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/security/libpam_unix.1</B
></SPAN
>) in their fourth field. For each service for which you want to
            use AFS authentication, edit the third field of its entry to read <SAMP
CLASS="computeroutput"
>optional</SAMP
>. The
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file in the HP-UX distribution usually includes standard entries for the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>login</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ftp</B
></SPAN
> services, for instance.</P
><P
>If there are services for which you want to use AFS authentication, but for which the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file does not already include a standard entry, you must create that entry and place the
            value <SAMP
CLASS="computeroutput"
>optional</SAMP
> in its third field. For instance, the HP-UX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file does not usually include standard entries for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>remsh</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>telnet</B
></SPAN
> services.</P
><P
>Then create an AFS-related entry for each service, placing it immediately below the standard entry. The following
            example shows what the <SAMP
CLASS="computeroutput"
>Authentication Management</SAMP
> section looks like after you have you
            edited or created entries for the services mentioned previously. Note that the example AFS entries appear on two lines
            only for legibility.</P
><PRE
CLASS="programlisting"
>&#13;   login   auth  optional  /usr/lib/security/libpam_unix.1
   login   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
   ftp     auth  optional  /usr/lib/security/libpam_unix.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root
   remsh   auth  optional  /usr/lib/security/libpam_unix.1
   remsh   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root            
   telnet  auth  optional  /usr/lib/security/libpam_unix.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
</PRE
></LI
><LI
><P
>If you use the Common Desktop Environment (CDE) on the machine and want users to obtain an AFS token as they log
            in, also add or edit the following four entries in the <SAMP
CLASS="computeroutput"
>Authentication management</SAMP
>
            section. Note that the AFS-related entries appear on two lines here only for legibility. <PRE
CLASS="programlisting"
>&#13;   dtlogin   auth  optional  /usr/lib/security/libpam_unix.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtaction  auth  optional  /usr/lib/security/libpam_unix.1
   dtaction  auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> (or if referring to these instructions while
            installing an additional file server machine, return to <A
HREF="c5467.html#HDRWQ108"
>Starting Server
            Programs</A
>).</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ36"
>Getting Started on IRIX Systems</A
></H1
><P
>To incorporate AFS into the kernel on IRIX systems, choose one of two methods: <UL
><LI
><P
>Run the AFS initialization script to invoke the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> program distributed by Silicon
          Graphics, Incorporated (SGI), which dynamically loads AFS modifications into the kernel</P
></LI
><LI
><P
>Build a new static kernel</P
></LI
></UL
></P
><P
>Then create partitions for storing AFS volumes. You do not need to replace the IRIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
>
    program because SGI has already modified it to handle AFS volumes properly. If the machine is to remain an AFS client machine,
    verify that the IRIX login utility installed on the machine grants an AFS token.</P
><P
>In preparation for either dynamic loading or kernel building, perform the following procedures: <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for IRIX on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on mounting
          CD-ROMs (either locally or remotely via NFS), see your IRIX documentation. Then change directory as indicated.
          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/sgi_65/root.client</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> on IRIX machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
          extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   usr/vice/etc/afs.rc  /etc/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
> command to determine the machine's CPU board type. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> value in the output must match one of the supported CPU board types
          listed in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
> for the current version of AFS. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to either <A
HREF="c371.html#HDRWQ37"
>Loading AFS into the IRIX Kernel</A
> or <A
HREF="c371.html#HDRWQ38"
>Building AFS into the IRIX Kernel</A
>.</P
></LI
></OL
></P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ37"
>Loading AFS into the IRIX Kernel</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> program is the dynamic kernel loader provided by SGI for IRIX systems. If you
      use it rather than building AFS modifications into a static kernel, then for AFS to function correctly the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> program must run each time the machine reboots. Therefore, the AFS initialization script (included
      on the AFS CD-ROM) invokes it automatically when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsml</B
></SPAN
> configuration variable is
      activated. In this section you activate the variable and run the script.</P
><P
>In later sections you verify that the script correctly initializes all AFS components, then create the links that
      incorporate AFS into the IRIX startup and shutdown sequence. <OL
TYPE="1"
><LI
><P
>Create the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
> directory to house the AFS kernel library
            file. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/etc/sgiload</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
>
            directory. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> portion of the library file name must
            match the value previously returned by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname -m</B
></SPAN
> command. Also choose the file
            appropriate to whether the machine's kernel supports NFS server functionality (NFS must be supported for the machine to
            act as an NFS/AFS Translator). Single- and multiprocessor machines use the same library file.</P
><P
>(You can choose to copy all of the kernel library files into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
> directory, but they require a significant amount of space.)</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  usr/vice/etc/sgiload/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.o  /usr/vice/etc/sgiload</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  usr/vice/etc/sgiload/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.nonfs.o</B
></SPAN
>   \
                   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/sgiload</B
></SPAN
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsml</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsml on</B
></SPAN
>   
</PRE
></P
><P
>If the machine is to function as an NFS/AFS Translator and the kernel supports NFS server functionality, activate
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
> variable.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsxnfs on</B
></SPAN
>
</PRE
></LI
><LI
><P
>Run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
> script to load AFS extensions into the kernel. The script
            invokes the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> command, automatically determining which kernel library file to use
            based on this machine's CPU type and the activation state of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
>
            variable.</P
><P
>You can ignore any error messages about the inability to start the BOS Server or the Cache Manager or AFS
            client.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>
</PRE
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ39"
>Configuring Server Partitions on IRIX Systems</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ38"
>Building AFS into the IRIX Kernel</A
></H2
><P
>Use the following instructions to build AFS modifications into the kernel on an IRIX system. <OL
TYPE="1"
><LI
><P
>Copy the kernel initialization file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs.sm</B
></SPAN
> to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/system</B
></SPAN
> directory, and the kernel master file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> to
            the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/master.d</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/afs.sm  /var/sysgen/system</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/afs  /var/sysgen/master.d</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the local file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/var/sysgen/boot/afs.a</B
></SPAN
>; the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
            portion of the library file name must match the value previously returned by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>uname
            -m</B
></SPAN
> command. Also choose the file appropriate to whether the machine's kernel supports NFS server
            functionality (NFS must be supported for the machine to act as an NFS/AFS Translator). Single- and multiprocessor
            machines use the same library file.</P
><P
>If the machine's kernel supports NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   bin/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.a   /var/sysgen/boot/afs.a</B
></SPAN
>   
</PRE
><P
>If the machine's kernel does not support NFS server functionality:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  bin/libafs.IP</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.nonfs.a  /var/sysgen/boot/afs.a</B
></SPAN
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to deactivate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsml</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsml off</B
></SPAN
>   
</PRE
></P
><P
>If the machine is to function as an NFS/AFS Translator and the kernel supports NFS server functionality, activate
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsxnfs</B
></SPAN
> variable.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsxnfs on</B
></SPAN
>
</PRE
></LI
><LI
><P
>Copy the existing kernel file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix</B
></SPAN
>, to a safe location. Compile the new kernel,
            which is created in the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix.install</B
></SPAN
>. It overwrites the existing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/unix</B
></SPAN
> file when the machine reboots in the next step. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /unix /unix_noafs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>autoconfig</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Reboot the machine to start using the new kernel, and login again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ39"
>Configuring Server Partitions on IRIX Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific
      Procedures</A
>.</P
><P
>AFS supports use of both EFS and XFS partitions for housing AFS volumes. SGI encourages use of XFS partitions.
      <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each partition (or logical volume created with the XLV volume manager) to be
            mounted on one of the directories created in the previous step.</P
><P
>For an XFS partition or logical volume:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  xfs  rw,raw=/dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>  0  0   
</PRE
><P
>For an EFS partition:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  efs  rw,raw=/dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>  0  0   
</PRE
><P
>The following are examples of an entry for each file system type:</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/dks0d2s6 /vicepa  xfs rw,raw=/dev/rdsk/dks0d2s6  0 0
   /dev/dsk/dks0d3s1 /vicepb  efs rw,raw=/dev/rdsk/dks0d3s1  0 0
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted on a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following commands are probably appropriate,
            but consult the IRIX documentation for more information. In both cases, <VAR
CLASS="replaceable"
>raw_device</VAR
> is a raw
            device name like <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/dev/rdsk/dks0d0s0</B
></SPAN
> for a single disk partition or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/dev/rxlv/xlv0</B
></SPAN
> for a logical volume.</P
><P
>For XFS file systems, include the indicated options to configure the partition or logical volume with inodes large
            enough to accommodate AFS-specific information:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -t xfs -i size=512 -l size=4000b</B
></SPAN
> <VAR
CLASS="replaceable"
>raw_device</VAR
>   
</PRE
><P
>For EFS file systems:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -t efs</B
></SPAN
> <VAR
CLASS="replaceable"
>raw_device</VAR
>
</PRE
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
            partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> If you have configured partitions or logical volumes to use XFS, issue
            the following command to verify that the inodes are configured properly (are large enough to accommodate AFS-specific
            information). If the configuration is correct, the command returns no output. Otherwise, it specifies the command to run
            in order to configure each partition or logical volume properly. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/xfs_size_check</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ40"
>Enabling AFS Login on IRIX Systems</A
>. Otherwise, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the
            BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ40"
>Enabling AFS Login on IRIX Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>The standard IRIX command-line <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>login</B
></SPAN
> program and the graphical <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>xdm</B
></SPAN
> login program both automatically grant an AFS token when AFS is incorporated into the machine's
      kernel. However, some IRIX distributions use another login utility by default, and it does not necessarily incorporate the
      required AFS modifications. If that is the case, you must disable the default utility if you want AFS users to obtain AFS
      tokens at login. For further discussion, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
><P
>If you configure the machine to use an AFS-modified login utility, then the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsauthlib.so</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afskauthlib.so</B
></SPAN
> files (included in the AFS
      distribution) must reside in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls</B
></SPAN
> command to verify.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls /usr/vice/etc</B
></SPAN
>   
</PRE
><P
>If the files do not exist, mount the AFS CD-ROM for IRIX (if it is not already), change directory as indicated, and copy
      them.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/sgi_65/root.client/usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  -p  *authlib*  /usr/vice/etc</B
></SPAN
>   
</PRE
><P
>After taking any necessary action, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ41"
>Getting Started on Linux Systems</A
></H1
><P
>Begin by running the AFS initialization script to call the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>insmod</B
></SPAN
> program, which
    dynamically loads AFS modifications into the kernel. Then create partitions for storing AFS volumes. You do not need to replace
    the Linux <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program. If the machine is to remain an AFS client machine, incorporate AFS into
    the machine's Pluggable Authentication Module (PAM) scheme.    </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ42"
>Loading AFS into the Linux Kernel</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>insmod</B
></SPAN
> program is the dynamic kernel loader for Linux. Linux does not support
      incorporation of AFS modifications during a kernel build.</P
><P
>For AFS to function correctly, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>insmod</B
></SPAN
> program must run each time the machine
      reboots, so the AFS initialization script (included on the AFS CD-ROM) invokes it automatically. The script also includes
      commands that select the appropriate AFS library file automatically. In this section you run the script.</P
><P
>In later sections you verify that the script correctly initializes all AFS components, then activate a configuration
      variable, which results in the script being incorporated into the Linux startup and shutdown sequence. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Linux on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
            mounting CD-ROMs (either locally or remotely via NFS), see your Linux documentation. Then change directory as indicated.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/i386_linux22/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS kernel library files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/modload</B
></SPAN
> directory.
            The filenames for the libraries have the format <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>libafs-</B
></SPAN
><VAR
CLASS="replaceable"
>version</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.o</B
></SPAN
>, where
            <VAR
CLASS="replaceable"
>version</VAR
> indicates the kernel build level. The string <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.mp</B
></SPAN
> in
            the <VAR
CLASS="replaceable"
>version</VAR
> indicates that the file is appropriate for machines running a multiprocessor
            kernel. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  modload  /usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d</B
></SPAN
> on Linux machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
            extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p   afs.rc  /etc/rc.d/init.d/afs</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script to load AFS extensions into the kernel. You can ignore any error messages about
            the inability to start the BOS Server or the Cache Manager or AFS client. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ43"
>Configuring Server Partitions on Linux Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific Procedures</A
>.
      <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/fstab</B
></SPAN
>, for each directory just created. The entry maps the directory name to the disk
            partition to be mounted on it. <PRE
CLASS="programlisting"
>&#13;   /dev/<VAR
CLASS="replaceable"
>disk</VAR
>  /vicep<VAR
CLASS="replaceable"
>xx</VAR
>  ext2  defaults  0  2   
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/sda8 /vicepa ext2 defaults 0 2
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate, but
            consult the Linux documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkfs -v /dev/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Mount each partition by issuing either the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount -a</B
></SPAN
> command to mount all
            partitions at once or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mount</B
></SPAN
> command to mount each partition in turn.</P
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ44"
>Enabling AFS Login on Linux Systems</A
>. Otherwise, proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the
            BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ44"
>Enabling AFS Login on Linux Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>At this point you incorporate AFS into the operating system's Pluggable Authentication Module (PAM) scheme. PAM
      integrates all authentication mechanisms on the machine, including login, to provide the security infrastructure for
      authenticated access to and from the machine.</P
><P
>Explaining PAM is beyond the scope of this document. It is assumed that you understand the syntax and meanings of
      settings in the PAM configuration file (for example, how the <SAMP
CLASS="computeroutput"
>other</SAMP
> entry works, the effect of
      marking an entry as <SAMP
CLASS="computeroutput"
>required</SAMP
>, <SAMP
CLASS="computeroutput"
>optional</SAMP
>, or
      <SAMP
CLASS="computeroutput"
>sufficient</SAMP
>, and so on).</P
><P
>The following instructions explain how to alter the entries in the PAM configuration file for each service for which you
      wish to use AFS authentication. Other configurations possibly also work, but the instructions specify the recommended and
      tested configuration.</P
><P
>The recommended AFS-related entries in the PAM configuration file make use of one or more of the following three
      attributes. <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>try_first_pass</SAMP
></B
></SPAN
></DT
><DD
><P
>This is a standard PAM attribute that can be included on entries after the first one for a service; it directs
              the module to use the password that was provided to the first module. For the AFS module, it means that AFS
              authentication succeeds if the password provided to the module listed first is the user's correct AFS password. For
              further discussion of this attribute and its alternatives, see the operating system's PAM documentation.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>ignore_root</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, directs it to ignore not only the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>, but also any user with UID 0 (zero).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>setenv_password_expires</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, sets the environment variable PASSWORD_EXPIRES to the expiration
              date of the user's AFS password, which is recorded in the Authentication Database.</P
></DD
></DL
></DIV
></P
><P
>Perform the following steps to enable AFS login. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Linux on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, if it is not already.
            Then change to the directory for PAM modules, which depends on which Linux distribution you are using.</P
><P
>If you are using a Linux distribution from Red Hat Software:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /lib/security</B
></SPAN
>   
</PRE
><P
>If you are using another Linux distribution:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/lib/security</B
></SPAN
>
</PRE
></LI
><LI
><P
>Copy the appropriate AFS authentication library file to the directory to which you changed in the previous step.
            Create a symbolic link whose name does not mention the version. Omitting the version eliminates the need to edit the PAM
            configuration file if you later update the library file.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process):</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/i386_linux22/lib/pam_afs.so.1  .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s pam_afs.so.1 pam_afs.so</B
></SPAN
>   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/i386_linux22/lib/pam_afs.krb.so.1   .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s pam_afs.krb.so.1 pam_afs.so</B
></SPAN
>
</PRE
></LI
><LI
><P
>For each service with which you want to use AFS authentication, insert an entry for the AFS PAM module into the
            <SAMP
CLASS="computeroutput"
>auth</SAMP
> section of the service's PAM configuration file. (Linux uses a separate
            configuration file for each service, unlike some other operating systems which list all services in a single file.) Mark
            the entry as <SAMP
CLASS="computeroutput"
>sufficient</SAMP
> in the second field.</P
><P
>Place the AFS entry below any entries that impose conditions under which you want the service to fail for a user
            who does not meet the entry's requirements. Mark these entries <SAMP
CLASS="computeroutput"
>required</SAMP
>. Place the AFS
            entry above any entries that need to execute only if AFS authentication fails.</P
><P
>Insert the following AFS entry if using the Red Hat distribution:</P
><PRE
CLASS="programlisting"
>&#13;   auth  sufficient  /lib/security/pam_afs.so   try_first_pass  ignore_root   
</PRE
><P
>Insert the following AFS entry if using another distribution:</P
><PRE
CLASS="programlisting"
>&#13;   auth  sufficient  /usr/lib/security/pam_afs.so  try_first_pass  ignore_root   
</PRE
><P
>The following example illustrates the recommended configuration of the configuration file for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>login</B
></SPAN
> service (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/pam.d/login</B
></SPAN
>) on a machine using the Red Hat
            distribution.</P
><PRE
CLASS="programlisting"
>&#13;   #%PAM-1.0
   auth      required   /lib/security/pam_securetty.so
   auth      required   /lib/security/pam_nologin.so
   auth      sufficient /lib/security/pam_afs.so try_first_pass ignore_root
   auth      required   /lib/security/pam_pwdb.so shadow nullok
   account   required   /lib/security/pam_pwdb.so
   password  required   /lib/security/pam_cracklib.so
   password  required   /lib/security/pam_pwdb.so shadow nullok use_authtok
   session   required   /lib/security/pam_pwdb.so
</PRE
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> (or if referring to these instructions while
            installing an additional file server machine, return to <A
HREF="c5467.html#HDRWQ108"
>Starting Server
            Programs</A
>).</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ45"
>Getting Started on Solaris Systems</A
></H1
><P
>Begin by running the AFS initialization script to call the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program distributed by
    Sun Microsystems, which dynamically loads AFS modifications into the kernel. Then create partitions for storing AFS volumes, and
    install and configure the AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program to run on AFS server partitions. If the
    machine is to remain an AFS client machine, incorporate AFS into the machine's Pluggable Authentication Module (PAM) scheme.
       </P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ46"
>Loading AFS into the Solaris Kernel</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program is the dynamic kernel loader provided by Sun Microsystems for
      Solaris systems. Solaris does not support incorporation of AFS modifications during a kernel build.</P
><P
>For AFS to function correctly, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program must run each time the machine
      reboots, so the AFS initialization script (included on the AFS CD-ROM) invokes it automatically. In this section you copy the
      appropriate AFS library file to the location where the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program accesses it and then
      run the script.</P
><P
>In later sections you verify that the script correctly initializes all AFS components, then create the links that
      incorporate AFS into the Solaris startup and shutdown sequence. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Solaris on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory. For instructions on
            mounting CD-ROMs (either locally or remotely via NFS), see your Solaris documentation. Then change directory as
            indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /cdrom/sun4x_56/root.client/usr/vice/etc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS initialization script to the local directory for initialization files (by convention, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> on Solaris machines). Note the removal of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rc</B
></SPAN
>
            extension as you copy the script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  afs.rc  /etc/init.d/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the appropriate AFS kernel library file to the local file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/kernel/fs/afs</B
></SPAN
>.</P
><P
>If the machine is running Solaris 2.6 or the 32-bit version of Solaris 7, its kernel supports NFS server
            functionality, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs.o /kernel/fs/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running Solaris 2.6 or the 32-bit version of Solaris 7, and its kernel does not support NFS
            server functionality or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is not running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs.nonfs.o /kernel/fs/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running the 64-bit version of Solaris 7, its kernel supports NFS server functionality, and the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs64.o /kernel/fs/sparcv9/afs</B
></SPAN
>   
</PRE
><P
>If the machine is running the 64-bit version of Solaris 7, and its kernel does not support NFS server
            functionality or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>nfsd</B
></SPAN
> process is not running:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p modload/libafs64.nonfs.o /kernel/fs/sparcv9/afs</B
></SPAN
>
</PRE
></LI
><LI
><P
>Run the AFS initialization script to load AFS modifications into the kernel. You can ignore any error messages
            about the inability to start the BOS Server or the Cache Manager or AFS client. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>   
</PRE
></P
><P
>When an entry called <SAMP
CLASS="computeroutput"
>afs</SAMP
> does not already exist in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/name_to_sysnum</B
></SPAN
> file, the script automatically creates it and reboots the machine to start
            using the new version of the file. If this happens, log in again as the superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
            after the reboot and run the initialization script again. This time the required entry exists in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/name_to_sysnum</B
></SPAN
> file, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>modload</B
></SPAN
> program runs.</P
><PRE
CLASS="programlisting"
>&#13;   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs start</B
></SPAN
>
</PRE
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ47"
>Configuring the AFS-modified fsck Program on Solaris Systems</A
></H2
><P
>In this section, you make modifications to guarantee that the appropriate <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program
      runs on AFS server partitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program provided with the operating system must never
      run on AFS server partitions. Because it does not recognize the structures that the File Server uses to organize volume data,
      it removes all of the data. To repeat:</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Never run the standard fsck program on AFS server partitions. It discards AFS volumes.</B
></SPAN
>
      <OL
TYPE="1"
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/fs/afs</B
></SPAN
> directory to house the AFS-modified <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program and related files. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/lib/fs/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/lib/fs/afs</B
></SPAN
>  
</PRE
></P
></LI
><LI
><P
>Copy the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vfsck</B
></SPAN
> binary to the newly created directory, changing the name as you do
            so. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /cdrom/sun4x_56/root.server/etc/vfsck  fsck</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Working in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/fs/afs</B
></SPAN
> directory, create the following links to Solaris
            libraries: <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/clri</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/df</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/edquota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ff</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fsdb</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fsirand</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/fstyp</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/labelit</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/lockfs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/mkfs</B
></SPAN
>  
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/mount</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ncheck</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/newfs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quot</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quotaoff</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/quotaon</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/repquota</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/tunefs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ufsdump</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/ufsrestore</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/lib/fs/ufs/volcopy</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Append the following line to the end of the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/dfs/fstypes</B
></SPAN
>.
            <PRE
CLASS="programlisting"
>&#13;   afs AFS Utilities
</PRE
></P
></LI
><LI
><P
>Edit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/mountall</B
></SPAN
> file, making two changes. <UL
><LI
><P
>Add an entry for AFS to the <SAMP
CLASS="computeroutput"
>case</SAMP
> statement for option 2, so that it reads
                  as follows: <PRE
CLASS="programlisting"
>&#13;   case "$2" in
   ufs)    foptions="-o p"
           ;;
   afs)    foptions="-o p"
           ;;
   s5)     foptions="-y -t /var/tmp/tmp$$ -D"
           ;;
   *)      foptions="-y"
           ;;
</PRE
></P
></LI
><LI
><P
>Edit the file so that all AFS and UFS partitions are checked in parallel. Replace the following section of
                  code: <PRE
CLASS="programlisting"
>&#13;   # For  fsck purposes, we make a distinction between ufs and
   # other file systems
   #
   if [ "$fstype" = "ufs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi  
</PRE
></P
><P
>with the following section of code:</P
><PRE
CLASS="programlisting"
>&#13;   # For fsck purposes, we make a distinction between ufs/afs
   # and other file systems.
   #
   if [ "$fstype" = "ufs" -o "$fstype" = "afs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi
</PRE
></LI
></UL
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ48"
>Configuring Server Partitions on Solaris Systems</A
></H2
><P
>Every AFS file server machine must have at least one partition or logical volume dedicated to storing AFS volumes. Each
      server partition is mounted at a directory named <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>, where
      <VAR
CLASS="replaceable"
>xx</VAR
> is one or two lowercase letters. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directories must reside in the file server machine's root
      directory, not in one of its subdirectories (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vicepa</B
></SPAN
> is not an acceptable
      directory location). For additional information, see <A
HREF="c371.html#HDRWQ20"
>Performing Platform-Specific Procedures</A
>.
      <OL
TYPE="1"
><LI
><P
>Create a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> for each AFS server
            partition you are configuring (there must be at least one). Repeat the command for each partition. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
>
</PRE
></P
></LI
><LI
><P
>Add a line with the following format to the file systems registry file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/vfstab</B
></SPAN
>, for each partition to be mounted on a directory created in the previous step. Note
            the value <SAMP
CLASS="computeroutput"
>afs</SAMP
> in the fourth field, which tells Solaris to use the AFS-modified
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fsck</B
></SPAN
> program on this partition. <PRE
CLASS="programlisting"
>&#13;   /dev/dsk/<VAR
CLASS="replaceable"
>disk</VAR
>   /dev/rdsk/<VAR
CLASS="replaceable"
>disk</VAR
>   /vicep<VAR
CLASS="replaceable"
>xx</VAR
>   afs   <VAR
CLASS="replaceable"
>boot_order</VAR
>  yes  
</PRE
></P
><P
>The following is an example for the first partition being configured.</P
><PRE
CLASS="programlisting"
>&#13;   /dev/dsk/c0t6d0s1 /dev/rdsk/c0t6d0s1 /vicepa afs 3 yes
</PRE
></LI
><LI
><P
>Create a file system on each partition that is to be mounted at a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicep</B
></SPAN
><VAR
CLASS="replaceable"
>xx</VAR
> directory. The following command is probably appropriate, but
            consult the Solaris documentation for more information. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>newfs -v /dev/rdsk/</B
></SPAN
><VAR
CLASS="replaceable"
>disk</VAR
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mountall</B
></SPAN
> command to mount all partitions at once.</P
></LI
><LI
><P
>If you plan to retain client functionality on this machine after completing the installation, proceed to <A
HREF="c371.html#HDRWQ49"
>Enabling AFS Login and Editing the File Systems Clean-up Script on Solaris Systems</A
>. Otherwise,
            proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ49"
>Enabling AFS Login and Editing the File Systems Clean-up Script on Solaris Systems</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you plan to remove client functionality from this machine after completing the installation, skip this section and
        proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>.</P
></BLOCKQUOTE
></DIV
><P
>At this point you incorporate AFS into the operating system's Pluggable Authentication Module (PAM) scheme. PAM
      integrates all authentication mechanisms on the machine, including login, to provide the security infrastructure for
      authenticated access to and from the machine.</P
><P
>Explaining PAM is beyond the scope of this document. It is assumed that you understand the syntax and meanings of
      settings in the PAM configuration file (for example, how the <SAMP
CLASS="computeroutput"
>other</SAMP
> entry works, the effect of
      marking an entry as <SAMP
CLASS="computeroutput"
>required</SAMP
>, <SAMP
CLASS="computeroutput"
>optional</SAMP
>, or
      <SAMP
CLASS="computeroutput"
>sufficient</SAMP
>, and so on).</P
><P
>The following instructions explain how to alter the entries in the PAM configuration file for each service for which you
      wish to use AFS authentication. Other configurations possibly also work, but the instructions specify the recommended and
      tested configuration.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>The instructions specify that you mark each entry as <SAMP
CLASS="computeroutput"
>optional</SAMP
>. However, marking some
        modules as optional can mean that they grant access to the corresponding service even when the user does not meet all of the
        module's requirements. In some operating system revisions, for example, if you mark as optional the module that controls
        login via a dial-up connection, it allows users to login without providing a password. See the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release
        Notes</I
></SPAN
> for a discussion of any limitations that apply to this operating system.</P
><P
>Also, with some operating system versions you must install patches for PAM to interact correctly with certain
        authentication programs. For details, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
></BLOCKQUOTE
></DIV
><P
>The recommended AFS-related entries in the PAM configuration file make use of one or more of the following three
      attributes. <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>try_first_pass</SAMP
></B
></SPAN
></DT
><DD
><P
>This is a standard PAM attribute that can be included on entries after the first one for a service; it directs
              the module to use the password that was provided to the first module. For the AFS module, it means that AFS
              authentication succeeds if the password provided to the module listed first is the user's correct AFS password. For
              further discussion of this attribute and its alternatives, see the operating system's PAM documentation.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>ignore_root</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, directs it to ignore not only the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>, but also any user with UID 0 (zero).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>setenv_password_expires</SAMP
></B
></SPAN
></DT
><DD
><P
>This attribute, specific to the AFS PAM module, sets the environment variable PASSWORD_EXPIRES to the expiration
              date of the user's AFS password, which is recorded in the Authentication Database.</P
></DD
></DL
></DIV
></P
><P
>Perform the following steps to enable AFS login. <OL
TYPE="1"
><LI
><P
>Mount the AFS CD-ROM for Solaris on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, if it is not already.
            Then change directory as indicated. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/lib/security</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Copy the AFS authentication library file to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/security</B
></SPAN
> directory. Then
            create a symbolic link to it whose name does not mention the version. Omitting the version eliminates the need to edit
            the PAM configuration file if you later update the library file.</P
><P
>If you use the AFS Authentication Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process):</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/sun4x_56/lib/pam_afs.so.1 .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s pam_afs.so.1 pam_afs.so</B
></SPAN
>   
</PRE
><P
>If you use a Kerberos implementation of AFS authentication:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /cdrom/sun4x_56/lib/pam_afs.krb.so.1 .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s pam_afs.krb.so.1 pam_afs.so</B
></SPAN
>
</PRE
></LI
><LI
><P
>Edit the <SAMP
CLASS="computeroutput"
>Authentication management</SAMP
> section of the Solaris PAM configuration file,
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/pam.conf</B
></SPAN
> by convention. The entries in this section have the value
            <SAMP
CLASS="computeroutput"
>auth</SAMP
> in their second field.</P
><P
>First edit the standard entries, which refer to the Solaris PAM module (usually, the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/security/pam_unix.so.1</B
></SPAN
>) in their fourth field. For each service for which you want to
            use AFS authentication, edit the third field of its entry to read <SAMP
CLASS="computeroutput"
>optional</SAMP
>. The
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file in the Solaris distribution usually includes standard entries for the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>login</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rlogin</B
></SPAN
>, and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rsh</B
></SPAN
> services, for instance.</P
><P
>If there are services for which you want to use AFS authentication, but for which the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file does not already include a standard entry, you must create that entry and place the
            value <SAMP
CLASS="computeroutput"
>optional</SAMP
> in its third field. For instance, the Solaris <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pam.conf</B
></SPAN
> file does not usually include standard entries for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ftp</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>telnet</B
></SPAN
> services.</P
><P
>Then create an AFS-related entry for each service, placing it immediately below the standard entry. The following
            example shows what the <SAMP
CLASS="computeroutput"
>Authentication Management</SAMP
> section looks like after you have you
            edited or created entries for the services mentioned previously. Note that the example AFS entries appear on two lines
            only for legibility.</P
><PRE
CLASS="programlisting"
>&#13;   login   auth  optional  /usr/lib/security/pam_unix.so.1
   login   auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rlogin  auth  optional  /usr/lib/security/pam_unix.so.1
   rlogin  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rsh     auth  optional  /usr/lib/security/pam_unix.so.1
   rsh     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root            
   ftp     auth  optional  /usr/lib/security/pam_unix.so.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root
   telnet  auth  optional  /usr/lib/security/pam_unix.so.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
</PRE
></LI
><LI
><P
>If you use the Common Desktop Environment (CDE) on the machine and want users to obtain an AFS token as they log
            in, also add or edit the following four entries in the <SAMP
CLASS="computeroutput"
>Authentication management</SAMP
>
            section. Note that the AFS-related entries appear on two lines here only for legibility. <PRE
CLASS="programlisting"
>&#13;   dtlogin   auth  optional  /usr/lib/security/pam_unix.so.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtsession  auth  optional /usr/lib/security/pam_unix.so.1
   dtsession  auth  optional /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
</PRE
></P
></LI
><LI
><P
>Some Solaris distributions include a script that locates and removes unneeded files from various file systems. Its
            conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib/fs/nfs/nfsfind</B
></SPAN
>. The script generally uses an argument
            to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>find</B
></SPAN
> command to define which file systems to search. In this step you modify the
            command to exclude the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory. Otherwise, the command traverses the AFS
            filespace of every cell that is accessible from the machine, which can take many hours. The following alterations are
            possibilities, but you must verify that they are appropriate for your cell.</P
><P
>The first possible alteration is to add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-local</B
></SPAN
> flag to the existing command,
            so that it looks like the following:</P
><PRE
CLASS="programlisting"
>&#13;   find $dir -local -name .nfs\* -mtime +7 -mount -exec rm -f {} \;   
</PRE
><P
>Another alternative is to exclude any directories whose names begin with the lowercase letter <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>a</B
></SPAN
> or a non-alphabetic character.</P
><PRE
CLASS="programlisting"
>&#13;   find /[A-Zb-z]*  <VAR
CLASS="replaceable"
>remainder of existing command</VAR
>   
</PRE
><P
>Do not use the following command, which still searches under the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory,
            looking for a subdirectory of type <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>4.2</B
></SPAN
>.</P
><PRE
CLASS="programlisting"
>&#13;   find / -fstype 4.2     /* <VAR
CLASS="replaceable"
>do not use</VAR
> */
</PRE
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> (or if referring to these instructions while
            installing an additional file server machine, return to <A
HREF="c5467.html#HDRWQ108"
>Starting Server
            Programs</A
>).</P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ50"
>Starting the BOS Server</A
></H1
><P
>You are now ready to start the AFS server processes on this machine. Begin by copying the AFS server binaries from the
    CD-ROM to the conventional local disk location, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory. The following
    instructions also create files in other subdirectories of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> directory.</P
><P
>Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
> command to initialize the Basic OverSeer (BOS) Server, which
    monitors and controls other AFS server processes on its server machine. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
    flag to disable authorization checking. Because you have not yet configured your cell's AFS authentication and authorization
    mechanisms, the BOS Server cannot perform authorization checking as it does during normal operation. In no-authorization mode,
    it does not verify the identity or privilege of the issuer of a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> command, and so performs
    any operation for anyone.</P
><P
>Disabling authorization checking gravely compromises cell security. You must complete all subsequent steps in one
    uninterrupted pass and must not leave the machine unattended until you restart the BOS Server with authorization checking
    enabled, in <A
HREF="c371.html#HDRWQ72"
>Verifying the AFS Initialization Script</A
>.</P
><P
>As it initializes for the first time, the BOS Server creates the following directories and files, setting the owner to the
    local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> and the mode bits to limit the ability to write (and in some cases, read)
    them. For a description of the contents and function of these directories and files, see the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS
    Administration Guide</I
></SPAN
> about administering server machines. For further discussion of the mode bit settings, see <A
HREF="c371.html#HDRWQ96"
>Protecting Sensitive AFS Directories</A
>.            <UL
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/db</B
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local</B
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs</B
></SPAN
></P
></LI
></UL
></P
><P
>The BOS Server also creates symbolic links called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> to the corresponding files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
>
    directory. The AFS command interpreters consult the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory because they generally run
    on client machines. On machines that are AFS servers only (as this machine currently is), the files reside only in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory; the links enable the command interpreters to retrieve the information they need.
    Later instructions for installing the client functionality replace the links with actual files. <OL
TYPE="1"
><LI
><P
>On the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, mount the AFS CD-ROM for this machine's system type,
          if it is not already. For instructions on mounting CD-ROMs (either locally or remotely via NFS), consult the operating
          system documentation.</P
></LI
><LI
><P
>Copy files from the CD-ROM to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/root.server/usr/afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  *  /usr/afs</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
> command. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
          flag to disable authorization checking. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bosserver -noauth &#38;</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Verify that the BOS Server created <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> as symbolic links to the corresponding files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls -l  /usr/vice/etc</B
></SPAN
>
</PRE
></P
><P
>If either or both of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> do not exist, or are not links, issue the following commands.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/afs/etc/ThisCell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/afs/etc/CellServDB</B
></SPAN
> 
</PRE
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ51"
>Defining Cell Name and Membership for Server Processes</A
></H1
><P
>Now assign your cell's name. The chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about cell configuration
    and administration issues discusses the important considerations, explains why changing the name is difficult, and outlines the
    restrictions on name format. Two of the most important restrictions are that the name cannot include uppercase letters or more
    than 64 characters.</P
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos setcellname</B
></SPAN
> command to assign the cell name. It creates two files:
    <UL
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
>, which defines this machine's cell membership</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
>, which lists the cell's database server machines; the
          machine named on the command line is placed on the list automatically</P
></LI
></UL
> <DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>In the following and every instruction in this guide, for the <VAR
CLASS="replaceable"
>machine name</VAR
> argument
        substitute the fully-qualified hostname (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs1.abc.com</B
></SPAN
>) of the machine you are
        installing. For the <VAR
CLASS="replaceable"
>cell name</VAR
> argument substitute your cell's complete name (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>abc.com</B
></SPAN
>).</P
></BLOCKQUOTE
></DIV
></P
><OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos setcellname</B
></SPAN
> command to set the cell name. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/afs/bin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos setcellname</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
><P
>Because you are not authenticated and authorization checking is disabled, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
>
        command interpreter possibly produces error messages about being unable to obtain tickets and running unauthenticated. You
        can safely ignore the messages.    </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listhosts</B
></SPAN
> command to verify that the machine you are installing is now
        registered as the cell's first database server machine. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos listhosts</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   Cell name is <VAR
CLASS="replaceable"
>cell_name</VAR
>
       Host 1 is <VAR
CLASS="replaceable"
>machine_name</VAR
>
</PRE
></P
></LI
></OL
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ52"
>Starting the Database Server Processes</A
></H1
><P
>Next use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to create entries for the four database server processes
    in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local/BosConfig</B
></SPAN
> file and start them running. The four processes run on database
    server machines only: <UL
><LI
><P
>The Authentication Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver</B
></SPAN
> process) maintains the Authentication
          Database</P
></LI
><LI
><P
>The Backup Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver</B
></SPAN
> process) maintains the Backup Database</P
></LI
><LI
><P
>The Protection Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ptserver</B
></SPAN
> process) maintains the Protection
          Database</P
></LI
><LI
><P
>The Volume Location (VL) Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vlserver</B
></SPAN
> process) maintains the Volume
          Location Database (VLDB)</P
></LI
></UL
></P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>AFS's authentication and authorization software is based on algorithms and other procedures known as
      <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Kerberos</I
></SPAN
>, as originally developed by Project Athena at the Massachusetts Institute of Technology. Some
      cells choose to replace the AFS Authentication Server and other security-related protocols with Kerberos as obtained directly
      from Project Athena or other sources. If you wish to do this, contact the AFS Product Support group now to learn about
      necessary modifications to the installation.</P
></BLOCKQUOTE
></DIV
><P
>The remaining instructions in this chapter include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> argument on all applicable
    commands. Provide the cell name you assigned in <A
HREF="c371.html#HDRWQ51"
>Defining Cell Name and Membership for Server
    Processes</A
>. If a command appears on multiple lines, it is only for legibility.   <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the Authentication Server. The current
          working directory is still <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kaserver simple /usr/afs/bin/kaserver</B
></SPAN
>  \
 <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>                 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>   
</PRE
></P
><P
>You can safely ignore the messages that tell you to add Kerberos to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/services</B
></SPAN
> file; AFS uses a default value that makes the addition unnecessary. You can also
          ignore messages about the failure of authentication.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the Backup Server. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver simple /usr/afs/bin/buserver</B
></SPAN
>  \
 <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>                 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the Protection Server. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ptserver simple /usr/afs/bin/ptserver</B
></SPAN
>  \
 <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>                 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the VL Server. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vlserver simple /usr/afs/bin/vlserver</B
></SPAN
>  \
 <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>                 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ53"
>Initializing Cell Security</A
></H1
><P
>Now initialize the cell's security mechanisms. Begin by creating the following two initial entries in the Authentication
    Database: <UL
><LI
><P
>A generic administrative account, called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> by convention. If you choose to
          assign a different name, substitute it throughout the remainder of this document.</P
><P
>After you complete the installation of the first machine, you can continue to have all administrators use the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> account, or you can create a separate administrative account for each of them. The
          latter scheme implies somewhat more overhead, but provides a more informative audit trail for administrative
          operations.</P
></LI
><LI
><P
>The entry for AFS server processes, called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
>. No user logs in under this
          identity, but the Authentication Server's Ticket Granting Service (TGS) module uses the associated key to encrypt the
          server tickets that it grants to AFS clients for presentation to server processes during mutual authentication. (The
          chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about cell configuration and administration describes the
          role of server encryption keys in mutual authentication.)</P
><P
>In Step <A
HREF="c371.html#LIWQ58"
>7</A
>, you also place the initial AFS server encryption key into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file. The AFS server processes refer to this file to learn the server
          encryption key when they need to decrypt server tickets.</P
></LI
></UL
></P
><P
>You also issue several commands that enable the new <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user to issue privileged
    commands in all of the AFS suites.</P
><P
>The following instructions do not configure all of the security mechanisms related to the AFS Backup System. See the
    chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about configuring the Backup System. <OL
TYPE="1"
><LI
><P
>Enter <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas</B
></SPAN
> interactive mode. Because the machine is in no-authorization checking
          mode, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> flag to suppress the Authentication Server's usual prompt for a
          password. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas  -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> 
   ka&#62;
</PRE
>    </P
></LI
><LI
><P
><A
NAME="LIWQ54"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas create</B
></SPAN
> command to create Authentication
          Database entries called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
>.</P
><P
>Do not provide passwords on the command line. Instead provide them as <VAR
CLASS="replaceable"
>afs_passwd</VAR
> and
          <VAR
CLASS="replaceable"
>admin_passwd</VAR
> in response to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas</B
></SPAN
> command interpreter's
          prompts as shown, so that they do not appear on the standard output stream.</P
><P
>You need to enter the <VAR
CLASS="replaceable"
>afs_passwd</VAR
> string only in this step and in Step <A
HREF="c371.html#LIWQ58"
>7</A
>, so provide a value that is as long and complex as possible, preferably including numerals,
          punctuation characters, and both uppercase and lowercase letters. Also make the <VAR
CLASS="replaceable"
>admin_passwd</VAR
> as
          long and complex as possible, but keep in mind that administrators need to enter it often. Both passwords must be at least
          six characters long.</P
><PRE
CLASS="programlisting"
>&#13;   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>create afs</B
></SPAN
> 
   initial_password:  <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   Verifying, please re-enter initial_password: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>create admin</B
></SPAN
>
   initial_password: <VAR
CLASS="replaceable"
>admin_passwd</VAR
>
   Verifying, please re-enter initial_password: <VAR
CLASS="replaceable"
>admin_passwd</VAR
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ55"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas examine</B
></SPAN
> command to display the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> entry. The output includes a checksum generated by encrypting a constant with the server
          encryption key derived from the <VAR
CLASS="replaceable"
>afs_passwd</VAR
> string. In Step <A
HREF="c371.html#LIWQ59"
>8</A
> you
          issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listkeys</B
></SPAN
> command to verify that the checksum in its output matches the
          checksum in this output. <PRE
CLASS="programlisting"
>&#13;   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>examine afs</B
></SPAN
>
   User data for afs
    key (0) cksum is <VAR
CLASS="replaceable"
>checksum</VAR
> . . .
</PRE
>   </P
></LI
><LI
><P
><A
NAME="LIWQ56"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas setfields</B
></SPAN
> command to turn on the
          <SAMP
CLASS="computeroutput"
>ADMIN</SAMP
> flag in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> entry. This enables the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user to issue privileged <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas</B
></SPAN
> commands. Then issue
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas examine</B
></SPAN
> command to verify that the <SAMP
CLASS="computeroutput"
>ADMIN</SAMP
> flag
          appears in parentheses on the first line of the output, as shown in the example. <PRE
CLASS="programlisting"
>&#13;   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>setfields admin -flags admin</B
></SPAN
>
   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>examine admin</B
></SPAN
> 
   User data for admin (ADMIN) . . .
</PRE
>   </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas quit</B
></SPAN
> command to leave <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas</B
></SPAN
>
          interactive mode. <PRE
CLASS="programlisting"
>&#13;   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
>
</PRE
>       </P
></LI
><LI
><P
><A
NAME="LIWQ57"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos adduser</B
></SPAN
> command to add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
> file. This enables the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user to issue privileged <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos</B
></SPAN
> commands. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos adduser</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
>    </P
></LI
><LI
><P
><A
NAME="LIWQ58"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos addkey</B
></SPAN
> command to define the AFS server
          encryption key in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file.</P
><P
>Do not provide the password on the command line. Instead provide it as <VAR
CLASS="replaceable"
>afs_passwd</VAR
> in
          response to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> command interpreter's prompts, as shown. Provide the same string as
          in Step <A
HREF="c371.html#LIWQ54"
>2</A
>.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos addkey</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-kvno 0 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   Input key: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   Retype input key: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ59"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listkeys</B
></SPAN
> command to verify that the checksum
          for the new key in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>KeyFile</B
></SPAN
> file is the same as the checksum for the key in the
          Authentication Database's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
> entry, which you displayed in Step <A
HREF="c371.html#LIWQ55"
>3</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos listkeys</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   key 0 has cksum <VAR
CLASS="replaceable"
>checksum</VAR
>    
</PRE
></P
><P
>You can safely ignore any error messages indicating that <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> failed to get tickets
          or that authentication failed.</P
><P
>If the keys are different, issue the following commands, making sure that the <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
          string is the same in each case. The <VAR
CLASS="replaceable"
>checksum</VAR
> strings reported by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas
          examine</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listkeys</B
></SPAN
> commands must match; if they do not, repeat these
          instructions until they do, using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-kvno</B
></SPAN
> argument to increment the key version number
          each time.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./kas  -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> 
   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>setpassword afs -kvno 1</B
></SPAN
> 
   new_password: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   Verifying, please re-enter initial_password: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>examine afs</B
></SPAN
>
   User data for afs
    key (1) cksum is <VAR
CLASS="replaceable"
>checksum</VAR
> . . .
   ka&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos addkey</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-kvno 1 -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> 
   Input key: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   Retype input key: <VAR
CLASS="replaceable"
>afs_passwd</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos listkeys</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   key 1 has cksum <VAR
CLASS="replaceable"
>checksum</VAR
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pts createuser</B
></SPAN
> command to create a Protection Database entry for the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user.</P
><P
>By default, the Protection Server assigns AFS UID 1 (one) to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user,
          because it is the first user entry you are creating. If the local password file (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/passwd</B
></SPAN
> or equivalent) already has an entry for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> that
          assigns it a UNIX UID other than 1, it is best to use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pts createuser</B
></SPAN
> command to make the new AFS UID match the existing UNIX UID. Otherwise, it is best
          to accept the default.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./pts createuser -name admin -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>AFS UID</VAR
>&#62;]  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   User admin has id <VAR
CLASS="replaceable"
>AFS UID</VAR
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pts adduser</B
></SPAN
> command to make the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
>
          user a member of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:administrators</B
></SPAN
> group, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pts
          membership</B
></SPAN
> command to verify the new membership. Membership in the group enables the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user to issue privileged <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>pts</B
></SPAN
> commands and some privileged
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> commands. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./pts adduser admin system:administrators -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./pts membership admin -cell</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
   Groups admin (id: 1) is a member of:
     system:administrators
</PRE
>    </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos restart</B
></SPAN
> command with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-all</B
></SPAN
> flag
          to restart the database server processes, so that they start using the new server encryption key. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos restart</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-all -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ60"
>Starting the File Server, Volume Server, and Salvager</A
></H1
><P
>Start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process, which consists of the File Server, Volume Server, and Salvager
    (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fileserver</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volserver</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>salvager</B
></SPAN
> processes). <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
>
          process. The command appears here on multiple lines only for legibility. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs fs /usr/afs/bin/fileserver</B
></SPAN
>   \
                   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/volserver /usr/afs/bin/salvager</B
></SPAN
>  \
                   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>   
</PRE
></P
><P
>Sometimes a message about Volume Location Database (VLDB) initialization appears, along with one or more instances
          of an error message similar to the following:</P
><PRE
CLASS="programlisting"
>&#13;   FSYNC_clientInit temporary failure (will retry)   
</PRE
><P
>This message appears when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volserver</B
></SPAN
> process tries to start before the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fileserver</B
></SPAN
> process has completed its initialization. Wait a few minutes after the last such message
          before continuing, to guarantee that both processes have started successfully.  </P
><P
>You can verify that the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> process has started successfully by issuing the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos status</B
></SPAN
> command. Its output mentions two <SAMP
CLASS="computeroutput"
>proc
          starts</SAMP
>.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos status</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs -long -noauth</B
></SPAN
>
</PRE
></LI
><LI
><P
>Your next action depends on whether you have ever run AFS file server machines in the cell: <UL
><LI
><P
>If you are installing the first AFS server machine ever in the cell (that is, you are not upgrading the AFS
                software from a previous version), create the first AFS volume, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
>.</P
><P
>For the <VAR
CLASS="replaceable"
>partition name</VAR
> argument, substitute the name of one of the machine's AFS
                server partitions (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepa</B
></SPAN
>).</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
>   \
                   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>   
</PRE
><P
>The Volume Server produces a message confirming that it created the volume on the specified partition. You can
                ignore error messages indicating that tokens are missing, or that authentication failed.    </P
></LI
><LI
><P
>If there are existing AFS file server machines and volumes in the cell, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos
                syncvldb</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos syncserv</B
></SPAN
> commands to synchronize the VLDB with the
                actual state of volumes on the local machine. To follow the progress of the synchronization operation, which can
                take several minutes, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> flag. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos syncvldb</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose  -noauth</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos syncserv</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose  -noauth</B
></SPAN
>   
</PRE
></P
><P
>You can ignore error messages indicating that tokens are missing, or that authentication failed.</P
></LI
></UL
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ61"
>Starting the Server Portion of the Update Server</A
></H1
><P
>Start the server portion of the Update Server (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> process), to distribute the
    contents of directories on this machine to other server machines in the cell. It becomes active when you configure the client
    portion of the Update Server on additional server machines.</P
><P
>Distributing the contents of its <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory makes this machine the cell's
    <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>system control machine</I
></SPAN
>. The other server machines in the cell run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientetc</B
></SPAN
> process (an instance of the client portion of the Update Server) to retrieve the
    configuration files. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-crypt</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
>
    initialization command to specify that the Update Server distributes the contents of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory only in encrypted form, as shown in the following instruction. Several of the
    files in the directory, particularly the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>KeyFile</B
></SPAN
> file, are crucial to cell security and so must
    never cross the network unencrypted.</P
><P
>(You can choose not to configure a system control machine, in which case you must update the configuration files in each
    server machine's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory individually. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
>
    commands used for this purpose also encrypt data before sending it across the network.)</P
><P
>Distributing the contents of its <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory to other server machines of its
    system type makes this machine a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>binary distribution machine</I
></SPAN
>. The other server machines of its system type
    run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientbin</B
></SPAN
> process (an instance of the client portion of the Update Server) to
    retrieve the binaries.</P
><P
>The binaries in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory are not sensitive, so it is not necessary to
    encrypt them before transfer across the network. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-clear</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
> initialization command to specify that the Update Server distributes the contents of the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory in unencrypted form unless an <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclientbin</B
></SPAN
> process requests encrypted transfer.</P
><P
>Note that the server and client portions of the Update Server always mutually authenticate with one another, regardless of
    whether you use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-clear</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-crypt</B
></SPAN
> arguments. This protects
    their communications from eavesdropping to some degree.</P
><P
>For more information on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upclient</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
>
    processes, see their reference pages in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
>. The commands appear on
    multiple lines here only for legibility. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver</B
></SPAN
>
          process. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name&#62;</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>upserver simple</B
></SPAN
>  \ 
             <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/upserver  -crypt /usr/afs/etc</B
></SPAN
>    \
             <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-clear /usr/afs/bin" -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
> 
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ62"
>Starting the Controller for NTPD</A
></H1
><P
>Keeping the clocks on all server and client machines in your cell synchronized is crucial to several functions, and in
    particular to the correct operation of AFS's distributed database technology, Ubik. The chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS
    Administration Guide</I
></SPAN
> about administering server machines explains how time skew can disturb Ubik's performance and
    cause service outages in your cell.</P
><P
>The AFS distribution includes a version of the Network Time Protocol Daemon (NTPD) for synchronizing the clocks on server
    machines. If a time synchronization program is not already running on the machine, then in this section you start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process to configure NTPD for use with AFS.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Do not run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process if NTPD or another time synchronization protocol is
      already running on the machine. Some versions of some operating systems run a time synchronization program by default, as
      detailed in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
><P
>Attempting to run multiple instances of the NTPD causes an error. Running NTPD together with another time
      synchronization protocol is unnecessary and can cause instability in the clock setting.</P
></BLOCKQUOTE
></DIV
><P
>If you run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process and your cell has reliable network connectivity to machines
    outside your cell, then it is conventional to configure the first AFS machine to refer to a time source outside the cell. When
    you later install the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> program on other server machines in the cell, it configures NTPD
    to choose a time source at random from among the database server machines listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file. Time synchronization therefore works in a chained manner: this database
    server machine refers to a time source outside the cell, the database server machines refer to the machine among them that has
    access to the most accurate time (NTPD itself includes code for determining this), and each non-database server machine refers
    to a local database server machine chosen at random from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file. If
    you ever decide to remove database server functionality from this machine, it is best to transfer responsibility for consulting
    an external time source to a remaining database server machine.</P
><P
>If your cell does not have network connectivity to external machines, or if the connectivity is not reliable, include the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localclock</B
></SPAN
> flag to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> command as indicated in the
    following instructions. The flag tells NTPD to rely on the machine's internal clock when all external time sources are
    inaccessible. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> command has other arguments that are possibly useful given your cell
    configuration; see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
>.</P
><P
>Choosing an appropriate external time source is important, but involves more considerations than can be discussed here. If
    you need help in selecting a source, contact the AFS Product Support group.</P
><P
>As the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process initializes NTPD, trace messages sometimes appear on the standard
    output stream. You can ignore them, but they can be informative if you understand how NTPD works. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos create</B
></SPAN
> command to start the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
>
          process. For the <VAR
CLASS="replaceable"
>host</VAR
> argument, substitute the fully-qualified hostname or IP address of one or
          more machines outside the cell that are to serve as time sources. Separate each name with a space. <UL
><LI
><P
>If your cell usually has reliable network connectivity to an external time source, use the following command:
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp simple</B
></SPAN
>   \
        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/runntp</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>host</VAR
>&#62;+<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"  -cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If your cell does not have network connectivity to an external time source, use the following command:
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp simple</B
></SPAN
>  \ 
        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/runntp -localclock"</B
></SPAN
>  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>If your cell has network connectivity to an external time source, but the network connection is frequently
                interrupted, use the following command: <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./bos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp simple</B
></SPAN
>  \ 
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"/usr/afs/bin/runntp -localclock</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>host</VAR
>&#62;+<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>"</B
></SPAN
>  \
         <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>cell name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noauth</B
></SPAN
>
</PRE
></P
></LI
></UL
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ63"
>Overview: Installing Client Functionality</A
></H1
><P
>The machine you are installing is now an AFS file server machine, database server machine, system control machine, and
    binary distribution machine. Now make it a client machine by completing the following tasks: <OL
TYPE="1"
><LI
><P
>Define the machine's cell membership for client processes</P
></LI
><LI
><P
>Create the client version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file</P
></LI
><LI
><P
>Define cache location and size</P
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory and start the Cache Manager</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ64"
>Copying Client Files to the Local Disk</A
></H1
><P
>Before installing and configuring the AFS client, copy the necessary files from the AFS CD-ROM to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. <OL
TYPE="1"
><LI
><P
>On the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, mount the AFS CD-ROM for this machine's system type,
          if it is not already. For instructions on mounting CD-ROMs (either locally or remotely via NFS), consult the operating
          system documentation.</P
></LI
><LI
><P
>Copy files to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory.</P
><P
>This step places a copy of the AFS initialization script (and related files, if applicable) into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. In the preceding instructions for incorporating AFS into the kernel, you
          copied the script directly to the operating system's conventional location for initialization files. When you incorporate
          AFS into the machine's startup sequence in a later step, you can choose to link the two files.</P
><P
>On some system types that use a dynamic kernel loader program, you previously copied AFS library files into a
          subdirectory of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. On other system types, you copied the
          appropriate AFS library file directly to the directory where the operating system accesses it. The following commands do
          not copy or recopy the AFS library files into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory, because on
          some system types the library files consume a large amount of space. If you want to copy them, add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-r</B
></SPAN
> flag to the first <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
> command and skip the second <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp</B
></SPAN
> command.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/root.client/usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -p  *  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp  C  /usr/vice/etc</B
></SPAN
>
</PRE
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ65"
>Defining Cell Membership for Client Processes</A
></H1
><P
>Every AFS client machine has a copy of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> file on its local disk
    to define the machine's cell membership for the AFS client programs that run on it. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> file you created in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory (in <A
HREF="c371.html#HDRWQ51"
>Defining Cell Name and Membership for Server Processes</A
>) is used only by server processes.</P
><P
>Among other functions, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> file on a client machine determines the following:
    <UL
><LI
><P
>The cell in which users authenticate when they log onto the machine, assuming it is using an AFS-modified login
          utility</P
></LI
><LI
><P
>The cell in which users authenticate by default when they issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
>
          command</P
></LI
><LI
><P
>The cell membership of the AFS server processes that the AFS command interpreters on this machine contact by
          default</P
></LI
></UL
> <OL
TYPE="1"
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory and remove the symbolic link created in <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm ThisCell</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> file as a copy of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
> file. Defining the same local cell for both server and client processes leads
          to the most consistent AFS performance. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /usr/afs/etc/ThisCell  ThisCell</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ66"
>Creating the Client CellServDB File</A
></H1
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file on a client machine's local disk lists the database
    server machines for each cell that the local Cache Manager can contact. If there is no entry in the file for a cell, or if the
    list of database server machines is wrong, then users working on this machine cannot access the cell. The chapter in the
    <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering client machines explains how to maintain the file after
    creating it.</P
><P
>As the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program initializes the Cache Manager, it copies the contents of the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file into kernel memory. The Cache Manager always consults the list in kernel memory
    rather than the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file itself. Between reboots of the machine, you can use the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs newcell</B
></SPAN
> command to update the list in kernel memory directly; see the chapter in the
    <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering client machines.</P
><P
>The AFS distribution includes the file <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB.sample</B
></SPAN
>, and you have already copied it
    to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. It includes an entry for all AFS cells that agreed to share
    their database server machine information at the time your AFS CD-ROM was created. The AFS Product Support group also maintains
    a copy of the file, updating it as necessary. If you are interested in participating in the global AFS namespace, it is a good
    policy to consult the file occasionally for updates. Ask the AFS Product Support group for a pointer to its location.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB.sample</B
></SPAN
> file can be a good basis for the client <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file, because all of the entries in it use the correct format. You can add or remove cell
    entries as you see fit. Later (in <A
HREF="c371.html#HDRWQ91"
>Enabling Access to Foreign Cells</A
>) you perform additional steps
    that enable the Cache Manager actually to reach the cells.</P
><P
>In this section, you add an entry for the local cell to the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. The
    current working directory is still <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
>. <OL
TYPE="1"
><LI
><P
>Remove the symbolic link created in <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
> and rename the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB.sample</B
></SPAN
> file to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm CellServDB</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mv CellServDB.sample CellServDB</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Add an entry for the local cell to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. One easy method is to use
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cat</B
></SPAN
> command to append the contents of the server <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/CellServDB</B
></SPAN
> file to the client version. <PRE
CLASS="programlisting"
>&#13;    # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cat  /usr/afs/etc/CellServDB &#62;&#62;  CellServDB</B
></SPAN
>   
</PRE
></P
><P
>Then open the file in a text editor to verify that there are no blank lines, and that all entries have the required
          format, which is described just following. The ordering of cells is not significant, but it can be convenient to have the
          client machine's home cell at the top; move it there now if you wish. <UL
><LI
><P
>The first line of a cell's entry has the following format: <PRE
CLASS="programlisting"
>&#13;   &#62;<VAR
CLASS="replaceable"
>cell_name</VAR
>      #<VAR
CLASS="replaceable"
>organization</VAR
>   
</PRE
></P
><P
>where <VAR
CLASS="replaceable"
>cell_name</VAR
> is the cell's complete Internet domain name (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>abc.com</B
></SPAN
>) and <VAR
CLASS="replaceable"
>organization</VAR
> is an optional field that follows any
                number of spaces and the number sign (<SAMP
CLASS="computeroutput"
>#</SAMP
>). By convention it names the organization
                to which the cell corresponds (for example, the ABC Corporation).</P
></LI
><LI
><P
>After the first line comes a separate line for each database server machine. Each line has the following
                format: <PRE
CLASS="programlisting"
>&#13;   <VAR
CLASS="replaceable"
>IP_address</VAR
>   #<VAR
CLASS="replaceable"
>machine_name</VAR
>   
</PRE
></P
><P
>where <VAR
CLASS="replaceable"
>IP_address</VAR
> is the machine's IP address in dotted decimal format (for example,
                192.12.105.3). Following any number of spaces and the number sign (<SAMP
CLASS="computeroutput"
>#</SAMP
>) is
                <VAR
CLASS="replaceable"
>machine_name</VAR
>, the machine's fully-qualified hostname (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>db1.abc.com</B
></SPAN
>). In this case, the number sign does not indicate a comment;
                <VAR
CLASS="replaceable"
>machine_name</VAR
> is a required field.</P
></LI
></UL
></P
></LI
><LI
><P
>If the file includes cells that you do not wish users of this machine to access, remove their entries.</P
></LI
></OL
></P
><P
>The following example shows entries for two cells, each of which has three database server machines:</P
><PRE
CLASS="programlisting"
>&#13;   &#62;abc.com       #ABC Corporation (home cell)
   192.12.105.3      #db1.abc.com
   192.12.105.4      #db2.abc.com
   192.12.105.55     #db3.abc.com
   &#62;stateu.edu    #State University cell
   138.255.68.93     #serverA.stateu.edu
   138.255.68.72     #serverB.stateu.edu
   138.255.33.154    #serverC.stateu.edu
</PRE
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ67"
>Configuring the Cache</A
></H1
><P
>The Cache Manager uses a cache on the local disk or in machine memory to store local copies of files fetched from file
    server machines. As the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program initializes the Cache Manager, it sets basic cache
    configuration parameters according to definitions in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/cacheinfo</B
></SPAN
> file.
    The file has three fields: <OL
TYPE="1"
><LI
><P
>The first field names the local directory on which to mount the AFS filespace. The conventional location is the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory.</P
></LI
><LI
><P
>The second field defines the local disk directory to use for the disk cache. The conventional location is the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/cache</B
></SPAN
> directory, but you can specify an alternate directory if another
          partition has more space available. There must always be a value in this field, but the Cache Manager ignores it if the
          machine uses a memory cache.</P
></LI
><LI
><P
>The third field specifies the number of kilobyte (1024 byte) blocks to allocate for the cache.</P
></LI
></OL
></P
><P
>The values you define must meet the following requirements. <UL
><LI
><P
>On a machine using a disk cache, the Cache Manager expects always to be able to use the amount of space specified in
          the third field. Failure to meet this requirement can cause serious problems, some of which can be repaired only by
          rebooting. You must prevent non-AFS processes from filling up the cache partition. The simplest way is to devote a
          partition to the cache exclusively.</P
></LI
><LI
><P
>The amount of space available in memory or on the partition housing the disk cache directory imposes an absolute
          limit on cache size.</P
></LI
><LI
><P
>The maximum supported cache size can vary in each AFS release; see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>
          for the current version.</P
></LI
><LI
><P
>For a disk cache, you cannot specify a value in the third field that exceeds 95% of the space available on the
          partition mounted at the directory named in the second field. If you violate this restriction, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program exits without starting the Cache Manager and prints an appropriate message on the
          standard output stream. A value of 90% is more appropriate on most machines. Some operating systems (such as AIX) do not
          automatically reserve some space to prevent the partition from filling completely; for them, a smaller value (say, 80% to
          85% of the space available) is more appropriate.</P
></LI
><LI
><P
>For a memory cache, you must leave enough memory for other processes and applications to run. If you try to allocate
          more memory than is actually available, the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program exits without initializing the
          Cache Manager and produces the following message on the standard output stream. <PRE
CLASS="programlisting"
>&#13;   afsd: memCache allocation failure at <VAR
CLASS="replaceable"
>number</VAR
> KB
</PRE
></P
><P
>The <VAR
CLASS="replaceable"
>number</VAR
> value is how many kilobytes were allocated just before the failure, and so
          indicates the approximate amount of memory available.</P
></LI
></UL
></P
><P
>Within these hard limits, the factors that determine appropriate cache size include the number of users working on the
    machine, the size of the files with which they work, and (for a memory cache) the number of processes that run on the machine.
    The higher the demand from these factors, the larger the cache needs to be to maintain good performance.</P
><P
>Disk caches smaller than 10 MB do not generally perform well. Machines serving multiple users usually perform better with
    a cache of at least 60 to 70 MB. The point at which enlarging the cache further does not really improve performance depends on
    the factors mentioned previously and is difficult to predict.</P
><P
>Memory caches smaller than 1 MB are nonfunctional, and the performance of caches smaller than 5 MB is usually
    unsatisfactory. Suitable upper limits are similar to those for disk caches but are probably determined more by the demands on
    memory from other sources on the machine (number of users and processes). Machines running only a few processes possibly can use
    a smaller memory cache.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ68"
>Configuring a Disk Cache</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Not all file system types that an operating system supports are necessarily supported for use as the cache partition.
        For possible restrictions, see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
>.</P
></BLOCKQUOTE
></DIV
><P
>To configure the disk cache, perform the following procedures: <OL
TYPE="1"
><LI
><P
>Create the local directory to use for caching. The following instruction shows the conventional location,
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/cache</B
></SPAN
>. If you are devoting a partition exclusively to caching, as
            recommended, you must also configure it, make a file system on it, and mount it at the directory created in this step.
            <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /usr/vice/cache</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cacheinfo</B
></SPAN
> file to define the configuration parameters discussed
            previously. The following instruction shows the standard mount location, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
>, and the
            standard cache location, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/cache</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:</B
></SPAN
><VAR
CLASS="replaceable"
>#blocks</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>" &#62; /usr/vice/etc/cacheinfo</B
></SPAN
>
</PRE
></P
><P
>The following example defines the disk cache size as 50,000 KB:</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:50000" &#62; /usr/vice/etc/cacheinfo</B
></SPAN
>
</PRE
></LI
></OL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ69"
>Configuring a Memory Cache</A
></H2
><P
>To configure a memory cache, create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cacheinfo</B
></SPAN
> file to define the configuration
      parameters discussed previously. The following instruction shows the standard mount location, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
>, and the standard cache location, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/cache</B
></SPAN
> (though the
      exact value of the latter is irrelevant for a memory cache).</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:</B
></SPAN
><VAR
CLASS="replaceable"
>#blocks</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>" &#62; /usr/vice/etc/cacheinfo</B
></SPAN
>
</PRE
><P
>The following example allocates 25,000 KB of memory for the cache.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>echo "/afs:/usr/vice/cache:25000" &#62; /usr/vice/etc/cacheinfo</B
></SPAN
>
</PRE
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ70"
>Configuring the Cache Manager</A
></H1
><P
>By convention, the Cache Manager mounts the AFS filespace on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory. In
    this section you create that directory.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program sets several cache configuration parameters as it initializes the Cache
    Manager, and starts daemons that improve performance. You can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command's arguments
    to override the parameters' default values and to change the number of some of the daemons. Depending on the machine's cache
    size, its amount of RAM, and how many people work on it, you can sometimes improve Cache Manager performance by overriding the
    default values. For a discussion of all of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command's arguments, see its reference page
    in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
>.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command line in the AFS initialization script on each system type includes an
    <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable. You can use it to set nondefault values for the command's arguments, in one
    of the following ways: <UL
><LI
><P
>You can create an <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>options file</I
></SPAN
> that sets values for
          arguments to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command. If the file exists, its contents are automatically
          substituted for the <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable in the AFS initialization script. The AFS
          distribution for some system types includes an options file; on other system types, you must create it.</P
><P
>You use two variables in the AFS initialization script to specify the path to the options file:
          <SAMP
CLASS="computeroutput"
>CONFIG</SAMP
> and <SAMP
CLASS="computeroutput"
>AFSDOPT</SAMP
>. On system types that define a
          conventional directory for configuration files, the <SAMP
CLASS="computeroutput"
>CONFIG</SAMP
> variable indicates it by
          default; otherwise, the variable indicates an appropriate location.</P
><P
>List the desired <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options on a single line in the options file, separating each
          option with one or more spaces. The following example sets the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-stat</B
></SPAN
> argument to 2500,
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-daemons</B
></SPAN
> argument to 4, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volumes</B
></SPAN
> argument to
          100.</P
><PRE
CLASS="programlisting"
>&#13;   -stat 2500 -daemons 4 -volumes 100   
</PRE
></LI
><LI
><P
>On a machine that uses a disk cache, you can set the <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable in the AFS
          initialization script to one of <SAMP
CLASS="computeroutput"
>$SMALL</SAMP
>, <SAMP
CLASS="computeroutput"
>$MEDIUM</SAMP
>, or
          <SAMP
CLASS="computeroutput"
>$LARGE</SAMP
>. The AFS initialization script uses one of these settings if the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file named by the <SAMP
CLASS="computeroutput"
>AFSDOPT</SAMP
> variable does not exist. In
          the script as distributed, the <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable is set to the value
          <SAMP
CLASS="computeroutput"
>$MEDIUM</SAMP
>.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Do not set the <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable to <SAMP
CLASS="computeroutput"
>$SMALL</SAMP
>,
            <SAMP
CLASS="computeroutput"
>$MEDIUM</SAMP
>, or <SAMP
CLASS="computeroutput"
>$LARGE</SAMP
> on a machine that uses a memory
            cache. The arguments it sets are appropriate only on a machine that uses a disk cache.</P
></BLOCKQUOTE
></DIV
><P
>The script (or on some system types the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file named by the
          <SAMP
CLASS="computeroutput"
>AFSDOPT</SAMP
> variable) defines a value for each of <SAMP
CLASS="computeroutput"
>SMALL</SAMP
>,
          <SAMP
CLASS="computeroutput"
>MEDIUM</SAMP
>, and <SAMP
CLASS="computeroutput"
>LARGE</SAMP
> that sets <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command arguments appropriately for client machines of different sizes: <UL
><LI
><P
><SAMP
CLASS="computeroutput"
>SMALL</SAMP
> is suitable for a small machine that serves one or two users and has
                approximately 8 MB of RAM and a 20-MB cache</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>MEDIUM</SAMP
> is suitable for a medium-sized machine that serves two to six users
                and has 16 MB of RAM and a 40-MB cache</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>LARGE</SAMP
> is suitable for a large machine that serves five to ten users and has
                32 MB of RAM and a 100-MB cache</P
></LI
></UL
></P
></LI
><LI
><P
>You can choose not to create an <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file and to set the
          <SAMP
CLASS="computeroutput"
>OPTIONS</SAMP
> variable in the initialization script to a null value rather than to the default
          <SAMP
CLASS="computeroutput"
>$MEDIUM</SAMP
> value. You can then either set arguments directly on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command line in the script, or set no arguments (and so accept default values for all Cache
          Manager parameters).</P
></LI
></UL
> <OL
TYPE="1"
><LI
><P
>Create the local directory on which to mount the AFS filespace, by convention <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
>.
          If the directory already exists, verify that it is empty. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir /afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>On AIX systems, add the following line to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/vfs</B
></SPAN
> file. It enables AIX to
          unmount AFS correctly during shutdown. <PRE
CLASS="programlisting"
>&#13;   afs     4     none     none
</PRE
></P
></LI
><LI
><P
>On Linux systems, copy the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig</B
></SPAN
> directory, removing
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.conf</B
></SPAN
> extension as you do so. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp /usr/vice/etc/afs.conf /etc/sysconfig/afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Edit the machine's AFS initialization script or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file to set
          appropriate values for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command parameters. The script resides in the indicated
          location on each system type: <UL
><LI
><P
>On AIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
></P
></LI
><LI
><P
>On Digital UNIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On HP-UX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On IRIX systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
></P
></LI
><LI
><P
>On Linux systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig/afs</B
></SPAN
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file)</P
></LI
><LI
><P
>On Solaris systems, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs</B
></SPAN
></P
></LI
></UL
></P
><P
>Use one of the methods described in the introduction to this section to add the following flags to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command line. If you intend for the machine to remain an AFS client, also set any
          performance-related arguments you wish. <UL
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-nosettime</B
></SPAN
> flag, because this is a file server machine that is also a
                client. The flag prevents the machine from picking a file server machine in the cell as its source for the correct
                time, which client machines normally do. File server machines instead use NTPD (as controlled by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>runntp</B
></SPAN
> process) or another protocol to synchronize their clocks.</P
></LI
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-memcache</B
></SPAN
> flag if the machine is to use a memory cache.</P
></LI
><LI
><P
>Add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> flag to display a trace of the Cache Manager's
                initialization on the standard output stream.</P
></LI
></UL
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ71"
>Overview: Completing the Installation of the First AFS Machine</A
></H1
><P
>The machine is now configured as an AFS file server and client machine. In this final phase of the installation, you
    initialize the Cache Manager and then create the upper levels of your AFS filespace, among other procedures. The procedures are:
    <OL
TYPE="1"
><LI
><P
>Verify that the initialization script works correctly, and incorporate it into the operating system's startup and
          shutdown sequence</P
></LI
><LI
><P
>Create and mount top-level volumes</P
></LI
><LI
><P
>Create and mount volumes to store system binaries in AFS</P
></LI
><LI
><P
>Enable access to foreign cells</P
></LI
><LI
><P
>Institute additional security measures</P
></LI
><LI
><P
>Remove client functionality if desired</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ72"
>Verifying the AFS Initialization Script</A
></H1
><P
>At this point you run the AFS initialization script to verify that it correctly invokes all of the necessary programs and
    AFS processes, and that they start correctly. The following are the relevant commands: <UL
><LI
><P
>The command that dynamically loads AFS modifications into the kernel, on some system types (not applicable if the
          kernel has AFS modifications built in)</P
></LI
><LI
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
> command, which starts the BOS Server; it in turn starts the server
          processes for which you created entries in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local/BosConfig</B
></SPAN
> file</P
></LI
><LI
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> command, which initializes the Cache Manager</P
></LI
></UL
></P
><P
>On system types that use a dynamic loader program, you must reboot the machine before running the initialization script,
    so that it can freshly load AFS modifications into the kernel.</P
><P
>If there are problems during the initialization, attempt to resolve them. The AFS Product Support group can provide
    assistance if necessary. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos shutdown</B
></SPAN
> command to shut down the AFS server processes other than the
          BOS Server. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-wait</B
></SPAN
> flag to delay return of the command shell prompt until all
          processes shut down completely. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bos shutdown</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-wait</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ps</B
></SPAN
> command to learn the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bosserver</B
></SPAN
>
          process's process ID number (PID), and then the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
> command to stop it. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ps</B
></SPAN
> <VAR
CLASS="replaceable"
>appropriate_ps_options</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>| grep bosserver</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
> <VAR
CLASS="replaceable"
>bosserver_PID</VAR
>
</PRE
></P
></LI
><LI
><P
>Issue the appropriate commands to run the AFS initialization script for this system type.</P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On AIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Digital UNIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On HP-UX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On IRIX systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>If you have configured the machine to use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ml</B
></SPAN
> dynamic loader program,
                reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsserver</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsclient</B
></SPAN
> configuration variables.
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsserver on</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsclient on</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Linux systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -r now</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>On Solaris systems:</B
></SPAN
> <OL
TYPE="a"
><LI
><P
>Reboot the machine and log in again as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.
                <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown -i6 -g0 -y</B
></SPAN
>
   login: <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
   Password: <VAR
CLASS="replaceable"
>root_password</VAR
>
</PRE
></P
></LI
><LI
><P
>Run the AFS initialization script. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d/afs  start</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
>Wait for the message that confirms that Cache Manager initialization is complete.</P
><P
>On machines that use a disk cache, it can take a while to initialize the Cache Manager for the first time, because
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program must create all of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>V</B
></SPAN
><VAR
CLASS="replaceable"
>n</VAR
> files in the cache directory. Subsequent Cache Manager
          initializations do not take nearly as long, because the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>V</B
></SPAN
><VAR
CLASS="replaceable"
>n</VAR
>
          files already exist.</P
><P
>As a basic test of correct AFS functioning, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> command to authenticate
          as the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
> user. Provide the password (<VAR
CLASS="replaceable"
>admin_passwd</VAR
>) you
          defined in <A
HREF="c371.html#HDRWQ53"
>Initializing Cell Security</A
>.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/klog admin</B
></SPAN
>
   Password:  <VAR
CLASS="replaceable"
>admin_passwd</VAR
>
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tokens</B
></SPAN
> command to verify that the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
>
          command worked correctly. If it did, the output looks similar to the following example for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>abc.com</B
></SPAN
> cell, where <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>admin</B
></SPAN
>'s AFS UID is 1. If the output does not
          seem correct, resolve the problem. Changes to the AFS initialization script are possibly necessary. The AFS Product
          Support group can provide assistance as necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/tokens</B
></SPAN
>
   Tokens held by the Cache Manager:
   User's (AFS ID 1) tokens for afs@abc.com [Expires May 22 11:52]
       --End of list--
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos status</B
></SPAN
> command to verify that the output for each process reads
          <SAMP
CLASS="computeroutput"
>Currently running normally</SAMP
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bos status</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62;
</PRE
>  </P
></LI
><LI
><P
>Change directory to the local file system root (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
>) and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs checkvolumes</B
></SPAN
> command. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs checkvolumes</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ73"
>Activating the AFS Initialization Script</A
></H1
><P
>Now that you have confirmed that the AFS initialization script works correctly, take the action necessary to have it run
    automatically at each reboot. Proceed to the instructions for your system type: <UL
><LI
><P
><A
HREF="c371.html#HDRWQ74"
>Activating the Script on AIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ75"
>Activating the Script on Digital UNIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ76"
>Activating the Script on HP-UX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ77"
>Activating the Script on IRIX Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ78"
>Activating the Script on Linux Systems</A
></P
></LI
><LI
><P
><A
HREF="c371.html#HDRWQ79"
>Activating the Script on Solaris Systems</A
></P
></LI
></UL
></P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ74"
>Activating the Script on AIX Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Edit the AIX initialization file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/inittab</B
></SPAN
>, adding the following line to invoke
          the AFS initialization script. Place it just after the line that starts NFS daemons. <PRE
CLASS="programlisting"
>&#13;   rcafs:2:wait:/etc/rc.afs &#62; /dev/console 2&#62;&#38;1 # Start AFS services
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
> directories. If you want to avoid
          potential confusion by guaranteeing that they are always the same, create a link between them. You can always retrieve the
          original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm  rc.afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/rc.afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ75"
>Activating the Script on Digital UNIX Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
          -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the Digital UNIX
          startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd  /sbin/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  ../init.d/afs  /sbin/rc3.d/S67afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  ../init.d/afs  /sbin/rc0.d/K66afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directories. If you want
          to avoid potential confusion by guaranteeing that they are always the same, create a link between them. You can always
          retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /sbin/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ76"
>Activating the Script on HP-UX Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
          -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the HP-UX startup and
          shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /sbin/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /sbin/rc2.d/S460afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /sbin/rc2.d/K800afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/init.d</B
></SPAN
> directories. If you want
          to avoid potential confusion by guaranteeing that they are always the same, create a link between them. You can always
          retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /sbin/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ77"
>Activating the Script on IRIX Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
          -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the IRIX startup and
          shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /etc/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc2.d/S35afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc0.d/K35afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directories. If you want
          to avoid potential confusion by guaranteeing that they are always the same, create a link between them. You can always
          retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ78"
>Activating the Script on Linux Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to activate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afs</B
></SPAN
>
          configuration variable. Based on the instruction in the AFS initialization file that begins with the string
          <SAMP
CLASS="computeroutput"
>#chkconfig</SAMP
>, the command automatically creates the symbolic links that incorporate the
          script into the Linux startup and shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/sbin/chkconfig  --add afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/rc.d/init.d</B
></SPAN
> directories, and
          copies of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> options file in both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/sysconfig</B
></SPAN
> directories. If you want to avoid
          potential confusion by guaranteeing that the two copies of each file are always the same, create a link between them. You
          can always retrieve the original script or options file from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc afs.conf</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/rc.d/init.d/afs  afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/sysconfig/afs  afs.conf</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Proceed to <A
HREF="c371.html#HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ79"
>Activating the Script on Solaris Systems</A
></H2
><OL
TYPE="1"
><LI
><P
>Change to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directory and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln
          -s</B
></SPAN
> command to create symbolic links that incorporate the AFS initialization script into the Solaris startup and
          shutdown sequence. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /etc/init.d</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc3.d/S99afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s ../init.d/afs /etc/rc0.d/K66afs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> There are now copies of the AFS initialization file in both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/init.d</B
></SPAN
> directories. If you want
          to avoid potential confusion by guaranteeing that they are always the same, create a link between them. You can always
          retrieve the original script from the AFS CD-ROM if necessary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm afs.rc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s  /etc/init.d/afs  afs.rc</B
></SPAN
>
</PRE
></P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ80"
>Configuring the Top Levels of the AFS Filespace</A
></H1
><P
>If you have not previously run AFS in your cell, you now configure the top levels of your cell's AFS filespace. If you
    have run a previous version of AFS, the filespace is already configured. Proceed to <A
HREF="c371.html#HDRWQ83"
>Storing AFS Binaries
    in AFS</A
>.   </P
><P
>You created the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume in <A
HREF="c371.html#HDRWQ60"
>Starting the File Server,
    Volume Server, and Salvager</A
>, and the Cache Manager mounted it automatically on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory when you ran the AFS initialization script in <A
HREF="c371.html#HDRWQ72"
>Verifying the AFS
    Initialization Script</A
>. You now set the access control list (ACL) on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory;
    creating, mounting, and setting the ACL are the three steps required when creating any volume.</P
><P
>After setting the ACL on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume, you create your cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume, mount it as a subdirectory of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory, and
    set the ACL. Create both a read/write and a regular mount point for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume. The
    read/write mount point enables you to access the read/write version of replicated volumes when necessary. Creating both mount
    points essentially creates separate read-only and read-write copies of your filespace, and enables the Cache Manager to traverse
    the filespace on a read-only path or read/write path as appropriate. For further discussion of these concepts, see the chapter
    in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about administering volumes.   </P
><P
>Then replicate both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volumes.
    This is required if you want to replicate any other volumes in your cell, because all volumes mounted above a replicated volume
    must themselves be replicated in order for the Cache Manager to access the replica.</P
><P
>When the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume is replicated, the Cache Manager is programmed to access its
    read-only version (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs.readonly</B
></SPAN
>) whenever possible. To make changes to the contents of the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume (when, for example, you mount another cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume at the second level in your filespace), you must mount the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume temporarily, make the changes, release the volume and remove the temporary mount point.
    For instructions, see <A
HREF="c371.html#HDRWQ91"
>Enabling Access to Foreign Cells</A
>.     <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl</B
></SPAN
> command to edit the ACL on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory. Add an entry that grants the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>l</B
></SPAN
> (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>lookup</B
></SPAN
>) and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>r</B
></SPAN
> (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>read</B
></SPAN
>) permissions
          to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group, to enable all AFS users who can reach your cell to traverse
          through the directory. If you prefer to enable access only to locally authenticated users, substitute the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:authuser</B
></SPAN
> group.</P
><P
>Note that there is already an ACL entry that grants all seven access rights to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:administrators</B
></SPAN
> group. It is a default entry that AFS places on every new volume's root
          directory.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs setacl /afs system:anyuser rl</B
></SPAN
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ81"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> command to create the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume. Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount it as
          a subdirectory of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs</B
></SPAN
> directory, where it serves as the root of your cell's local
          AFS filespace. Finally, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl</B
></SPAN
> command to create an ACL entry for the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group (or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:authuser</B
></SPAN
> group).</P
><P
>For the <VAR
CLASS="replaceable"
>partition name</VAR
> argument, substitute the name of one of the machine's AFS server
          partitions (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/vicepa</B
></SPAN
>). For the <VAR
CLASS="replaceable"
>cellname</VAR
> argument,
          substitute your cell's fully-qualified Internet domain name (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>abc.com</B
></SPAN
>).</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/vos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> 
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs mkmount /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs setacl /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser rl</B
></SPAN
>
</PRE
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Create a symbolic link to a shortened cell name, to reduce the length of
          pathnames for users in the local cell. For example, in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>abc.com</B
></SPAN
> cell, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/abc</B
></SPAN
> is a link to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/abc.com</B
></SPAN
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s</B
></SPAN
>  <VAR
CLASS="replaceable"
>full_cellname</VAR
>  <VAR
CLASS="replaceable"
>short_cellname</VAR
>
</PRE
>   </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to create a read/write mount point for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume (you created a regular mount point in Step <A
HREF="c371.html#LIWQ81"
>2</A
>).</P
><P
>By convention, the name of a read/write mount point begins with a period, both to distinguish it from the regular
          mount point and to make it visible only when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-a</B
></SPAN
> flag is used on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls</B
></SPAN
> command.</P
><P
>Change directory to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> to make it easier to access the command
          binaries.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/afs/bin</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs mkmount   /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>   <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell -rw</B
></SPAN
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ82"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos addsite</B
></SPAN
> command to define a replication site
          for both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volumes. In each
          case, substitute for the <VAR
CLASS="replaceable"
>partition name</VAR
> argument the partition where the volume's read/write
          version resides. When you install additional file server machines, it is a good idea to create replication sites on them
          as well. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos addsite</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos addsite</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs examine</B
></SPAN
> command to verify that the Cache Manager can access both the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volumes, before you attempt to
          replicate them. The output lists each volume's name, volumeID number, quota, size, and the size of the partition that
          houses them. If you get an error message instead, do not continue before taking corrective action. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs examine /afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs examine /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>
</PRE
>    </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release</B
></SPAN
> command to release a replica of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volumes to the sites you defined in Step
          <A
HREF="c371.html#LIWQ82"
>5</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos release root.afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./vos release root.cell</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs checkvolumes</B
></SPAN
> to force the Cache Manager to notice that you have
          released read-only versions of the volumes, then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs examine</B
></SPAN
> command again. This
          time its output mentions the read-only version of the volumes (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs.readonly</B
></SPAN
> and
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell.readonly</B
></SPAN
>) instead of the read/write versions, because of the Cache Manager's
          bias to access the read-only version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume if it exists.
          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs checkvolumes</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs examine /afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>./fs examine /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>
</PRE
></P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ83"
>Storing AFS Binaries in AFS</A
></H1
><P
>In the conventional configuration, you make AFS client binaries and configuration files available in the subdirectories of
    the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> directory on client machines (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsws</B
></SPAN
> is an
    acronym for <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AFS w</B
></SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ork</I
></SPAN
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>s</B
></SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>tation</I
></SPAN
>). You can conserve local disk space by creating <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> as a link to an AFS volume that houses the AFS client binaries and configuration files for
    this system type.</P
><P
>In this section you create the necessary volumes. The conventional location to which to link <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
>, where
    <VAR
CLASS="replaceable"
>sysname</VAR
> is the appropriate system type name as specified in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release
    Notes</I
></SPAN
>. The instructions in <A
HREF="c8044.html"
>Installing Additional Client Machines</A
> assume that you have
    followed the instructions in this section.</P
><P
>If you have previously run AFS in the cell, the volumes possibly already exist. If so, you need to perform Step <A
HREF="c371.html#LIWQ86"
>8</A
> only.</P
><P
>The current working directory is still <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>, which houses the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos</B
></SPAN
> command suite binaries. In the following commands, it is
    possible you still need to specify the pathname to the commands, depending on how your PATH environment variable is set.
    <OL
TYPE="1"
><LI
><P
><A
NAME="LIWQ84"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> command to create volumes for storing
          the AFS client binaries for this system type. The following example instruction creates volumes called
          <VAR
CLASS="replaceable"
>sysname</VAR
>, <VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr</B
></SPAN
>, and
          <VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.afsws</B
></SPAN
>. Refer to the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release
          Notes</I
></SPAN
> to learn the proper value of <VAR
CLASS="replaceable"
>sysname</VAR
> for this system type. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <VAR
CLASS="replaceable"
>sysname</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.usr</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62; <VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.usr.afsws</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount the newly created volumes. Because the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume is replicated, you must precede the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>cellname</I
></SPAN
> part
          of the pathname with a period to specify the read/write mount point, as shown. Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos
          release</B
></SPAN
> command to release a new replica of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume, and the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs checkvolumes</B
></SPAN
> command to force the local Cache Manager to access them. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount -dir /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-vol</B
></SPAN
> <VAR
CLASS="replaceable"
>sysname</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount -dir /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr</B
></SPAN
>  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-vol</B
></SPAN
> <VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.usr</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount -dir /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-vol</B
></SPAN
> <VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.usr.afsws</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release root.cell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs checkvolumes</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl</B
></SPAN
> command to grant the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>l</B
></SPAN
>
          (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>lookup</B
></SPAN
>) and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>r</B
></SPAN
> (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>read</B
></SPAN
>)
          permissions to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group on each new directory's ACL. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl  -dir  .  usr  usr/afsws  -acl  system:anyuser rl</B
></SPAN
> 
</PRE
>     </P
></LI
><LI
><P
><A
NAME="LIWQ85"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setquota</B
></SPAN
> command to set an unlimited quota on
          the volume mounted at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> directory. This
          enables you to copy all of the appropriate files from the CD-ROM into the volume without exceeding the volume's
          quota.</P
><P
>If you wish, you can set the volume's quota to a finite value after you complete the copying operation. At that
          point, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos examine</B
></SPAN
> command to determine how much space the volume is occupying.
          Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setquota</B
></SPAN
> command to set a quota that is slightly larger.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setquota /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws  0</B
></SPAN
>
</PRE
></LI
><LI
><P
>Mount the AFS CD-ROM for this machine's system type on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory,
          if it is not already. For instructions on mounting CD-ROMs (either locally or remotely via NFS), consult the operating
          system documentation.   </P
></LI
><LI
><P
>Copy the contents of the indicated directories from the CD-ROM into the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> directory.
          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/bin  .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc  .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/include  .</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp /cdrom/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/lib  .</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl</B
></SPAN
> command to set the ACL on each directory appropriately. To
          comply with the terms of your AFS License agreement, you must prevent unauthorized users from accessing AFS software. To
          enable access for locally authenticated users only, set the ACL on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>etc</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>include</B
></SPAN
>, and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>lib</B
></SPAN
> subdirectories to grant the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>l</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>r</B
></SPAN
> permissions to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:authuser</B
></SPAN
> group rather than the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group. The
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group must retain the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>l</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>r</B
></SPAN
> permissions on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bin</B
></SPAN
> subdirectory to enable unauthenticated
          users to access the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> binary. To ensure that unauthorized users are not accessing AFS
          software, check periodically that the ACLs on these directories are set properly. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/</B
></SPAN
><VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl  -dir etc include lib  -acl  system:authuser rl</B
></SPAN
>  \
              <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser none</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
><A
NAME="LIWQ86"
></A
>Create <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
> on the local disk as a symbolic link to the
          directory <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/@sys/usr/afsws</B
></SPAN
>. You can specify the actual system name instead of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>@sys</B
></SPAN
> if you wish, but the advantage of using <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>@sys</B
></SPAN
> is that it
          remains valid if you upgrade this machine to a different system type. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/@sys/usr/afsws  /usr/afsws</B
></SPAN
>
</PRE
>  </P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> To enable users to issue commands from the AFS suites (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
>) without having to specify a pathname to their binaries, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws/bin</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws/etc</B
></SPAN
> directories in the PATH
          environment variable you define in each user's shell initialization file (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.cshrc</B
></SPAN
>).</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ87"
>Storing AFS Documents in AFS</A
></H1
><P
>The AFS distribution includes the following documents: <UL
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Release Notes</I
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Quick Beginnings</I
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS User Guide</I
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
></P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
></P
></LI
></UL
></P
><P
>The AFS CD-ROM for each system type has a top-level <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Documentation</B
></SPAN
> directory, with a
    subdirectory for each document format provided. The different formats are suitable for online viewing, printing, or both.</P
><P
>This section explains how to create and mount a volume to house the documents, making them available to your users. The
    recommended mount point for the volume is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc</B
></SPAN
>. If you wish, you can create a link to the mount point on each client machine's local disk,
    called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsdoc</B
></SPAN
>. Alternatively, you can create a link to the mount point in each user's home
    directory. You can also choose to permit users to access only certain documents (most probably, the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS User
    Guide</I
></SPAN
>) by creating different mount points or setting different ACLs on different document directories.</P
><P
>The current working directory is still <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
>, which houses the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos</B
></SPAN
> command suite binaries you use to create and mount volumes.
    In the following commands, it is possible you still need to specify the pathname to the commands, depending on how your PATH
    environment variable is set. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
> command to create a volume for storing the AFS documentation.
          Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-maxquota</B
></SPAN
> argument to set an unlimited quota on the volume. This enables you
          to copy all of the appropriate files from the CD-ROM into the volume without exceeding the volume's quota.</P
><P
>If you wish, you can set the volume's quota to a finite value after you complete the copying operations. At that
          point, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos examine</B
></SPAN
> command to determine how much space the volume is occupying.
          Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setquota</B
></SPAN
> command to set a quota that is slightly larger.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos create</B
></SPAN
>  &#60;<VAR
CLASS="replaceable"
>machine name</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>partition name</VAR
>&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsdoc  -maxquota  0</B
></SPAN
> 
</PRE
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount the new volume. Because the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume is replicated, you must precede the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>cellname</I
></SPAN
> with a period to
          specify the read/write mount point, as shown. Then issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release</B
></SPAN
> command to
          release a new replica of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs
          checkvolumes</B
></SPAN
> command to force the local Cache Manager to access them. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount -dir /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc</B
></SPAN
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-vol</B
></SPAN
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsdoc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release root.cell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs checkvolumes</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl</B
></SPAN
> command to grant the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rl</B
></SPAN
>
          permissions to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group on the new directory's ACL. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc</B
></SPAN
> 
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs setacl  .  system:anyuser rl</B
></SPAN
> 
</PRE
></P
></LI
><LI
><P
>Mount the AFS CD-ROM for any system type on the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/cdrom</B
></SPAN
> directory, if one is
          not already. For instructions on mounting CD-ROMs (either locally or remotely via NFS), consult the operating system
          documentation.     </P
></LI
><LI
><P
>Copy the AFS documents in one or more formats from the CD-ROM into subdirectories of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc</B
></SPAN
> directory. Repeat
          the commands for each format. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir</B
></SPAN
> <VAR
CLASS="replaceable"
>format_name</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd</B
></SPAN
> <VAR
CLASS="replaceable"
>format_name</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp -rp /cdrom/Documentation/</B
></SPAN
><VAR
CLASS="replaceable"
>format</VAR
>  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.</B
></SPAN
>      
</PRE
></P
><P
>If you choose to store the HTML version of the documents in AFS, note that in addition to a subdirectory for each
          document there are several files with a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.gif</B
></SPAN
> extension, which enable readers to move
          easily between sections of a document. The file called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>index.htm</B
></SPAN
> is an introductory HTML
          page that contains a hyperlink to each of the documents. For online viewing to work properly, these files must remain in
          the top-level HTML directory (the one named, for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc/html</B
></SPAN
>).</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> If you believe it is helpful to your users to access the AFS documents
          in a certain format via a local disk directory, create <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsdoc</B
></SPAN
> on the local disk as a
          symbolic link to the documentation directory in AFS (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc/</B
></SPAN
><VAR
CLASS="replaceable"
>format_name</VAR
>). <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc/</B
></SPAN
><VAR
CLASS="replaceable"
>format_name</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsdoc</B
></SPAN
>
</PRE
></P
><P
>An alternative is to create a link in each user's home directory to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afsdoc/</B
></SPAN
><VAR
CLASS="replaceable"
>format_name</VAR
> directory.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ88"
>Storing System Binaries in AFS</A
></H1
><P
>You can also choose to store other system binaries in AFS volumes, such as the standard UNIX programs conventionally
    located in local disk directories such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/bin</B
></SPAN
>, and
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/lib</B
></SPAN
>. Storing such binaries in an AFS volume not only frees local disk space, but makes it
    easier to update binaries on all client machines.</P
><P
>The following is a suggested scheme for storing system binaries in AFS. It does not include instructions, but you can use
    the instructions in <A
HREF="c371.html#HDRWQ83"
>Storing AFS Binaries in AFS</A
> (which are for AFS-specific binaries) as a
    template.</P
><P
>Some files must remain on the local disk for use when AFS is inaccessible (during bootup and file server or network
    outages). The required binaries include the following: <UL
><LI
><P
>A text editor, network commands, and so on</P
></LI
><LI
><P
>Files used during the boot sequence before the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsd</B
></SPAN
> program runs, such as
          initialization and configuration files, and binaries for commands that mount file systems</P
></LI
><LI
><P
>Files used by dynamic kernel loader programs</P
></LI
></UL
></P
><P
>In most cases, it is more secure to enable only locally authenticated users to access system binaries, by granting the
    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>l</B
></SPAN
> (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>lookup</B
></SPAN
>) and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>r</B
></SPAN
> (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>read</B
></SPAN
>) permissions to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:authuser</B
></SPAN
> group on the ACLs of
    directories that contain the binaries. If users need to access a binary while unauthenticated, however, the ACL on its directory
    must grant those permissions to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:anyuser</B
></SPAN
> group.</P
><P
>The following chart summarizes the suggested volume and mount point names for storing system binaries. It uses a separate
    volume for each directory. You already created a volume called <VAR
CLASS="replaceable"
>sysname</VAR
> for this machine's system type
    when you followed the instructions in <A
HREF="c371.html#HDRWQ83"
>Storing AFS Binaries in AFS</A
>.</P
><P
>You can name volumes in any way you wish, and mount them at other locations than those suggested here. However, this
    scheme has several advantages: <UL
><LI
><P
>Volume names clearly identify volume contents</P
></LI
><LI
><P
>Using the <VAR
CLASS="replaceable"
>sysname</VAR
> prefix on every volume makes it is easy to back up all of the volumes
          together, because the AFS Backup System enables you to define sets of volumes based on a string included in all of their
          names</P
></LI
><LI
><P
>It makes it easy to track related volumes, keeping them together on the same file server machine if desired</P
></LI
><LI
><P
>There is a clear relationship between volume name and mount point name</P
></LI
></UL
></P
><DIV
CLASS="informaltable"
><A
NAME="AEN5058"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL
WIDTH="50*"><COL
WIDTH="50*"><THEAD
><TR
><TH
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Volume Name</B
></SPAN
></TH
><TH
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Mount Point</B
></SPAN
></TH
></TR
></THEAD
><TBODY
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bin</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/bin</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>etc</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.afsws</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.bin</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/bin</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.etc</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/etc</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.inc</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/include</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.lib</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/lib</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.loc</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/local</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.man</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/man</B
></SPAN
></TD
></TR
><TR
><TD
><VAR
CLASS="replaceable"
>sysname</VAR
>.<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>usr.sys</B
></SPAN
></TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>/<VAR
CLASS="replaceable"
>sysname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/sys</B
></SPAN
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ91"
>Enabling Access to Foreign Cells</A
></H1
><P
>In this section you create a mount point in your AFS filespace for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume
    of each foreign cell that you want to enable your users to access. For users working on a client machine to access the cell,
    there must in addition be an entry for it in the client machine's local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file. (The instructions in <A
HREF="c371.html#HDRWQ66"
>Creating the Client
    CellServDB File</A
> suggest that you use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB.sample</B
></SPAN
> file included in the AFS
    distribution as the basis for your cell's client <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. The sample file lists all of
    the cells that had agreed to participate in the AFS global namespace at the time your AFS CD-ROM was created. As mentioned in
    that section, the AFS Product Support group also maintains a copy of the file, updating it as necessary.)</P
><P
>The chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Guide</I
></SPAN
> about cell administration and configuration issues
    discusses the implications of participating in the global AFS namespace. The chapter about administering client machines
    explains how to maintain knowledge of foreign cells on client machines, and includes suggestions for maintaining a central
    version of the file in AFS. <OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount each foreign cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume on a directory called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>foreign_cell</VAR
>. Because the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
>
          volume is replicated, you must create a temporary mount point for its read/write version in a directory to which you have
          write access (such as your cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
> directory).
          Create the mount points, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release</B
></SPAN
> command to release new replicas to the
          read-only sites for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.afs</B
></SPAN
> volume, and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs
          checkvolumes</B
></SPAN
> command to force the local Cache Manager to access the new replica.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>You need to issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command only once for each foreign cell's
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell</B
></SPAN
> volume. You do not need to repeat the command on each client machine.</P
></BLOCKQUOTE
></DIV
><P
>Substitute your cell's name for <VAR
CLASS="replaceable"
>cellname</VAR
>.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /afs/.</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs  mkmount  temp  root.afs</B
></SPAN
>   
</PRE
><P
>Repeat the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command for each foreign cell you wish to mount at this
          time.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs mkmount temp/</B
></SPAN
><VAR
CLASS="replaceable"
>foreign_cell</VAR
> <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root.cell -c</B
></SPAN
> <VAR
CLASS="replaceable"
>foreign_cell</VAR
>   
</PRE
><P
>Issue the following commands only once.</P
><PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs rmmount temp</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/vos release root.afs</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs checkvolumes</B
></SPAN
>
</PRE
></LI
><LI
><P
><A
NAME="LIWQ92"
></A
>If this machine is going to remain an AFS client after you complete the installation, verify
          that the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file includes an entry for each foreign
          cell.</P
><P
>For each cell that does not already have an entry, complete the following instructions: <OL
TYPE="a"
><LI
><P
>Create an entry in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file. Be sure to comply with the formatting
                instructions in <A
HREF="c371.html#HDRWQ66"
>Creating the Client CellServDB File</A
>.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs newcell</B
></SPAN
> command to add an entry for the cell directly to the
                list that the Cache Manager maintains in kernel memory. Provide each database server machine's fully qualified
                hostname. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/fs newcell</B
></SPAN
> &#60;<VAR
CLASS="replaceable"
>foreign_cell</VAR
>&#62; &#60;<VAR
CLASS="replaceable"
>dbserver1&#62;</VAR
>    \
            [&#60;<VAR
CLASS="replaceable"
>dbserver2&#62;</VAR
>] [&#60;<VAR
CLASS="replaceable"
>dbserver3&#62;</VAR
>]
</PRE
></P
></LI
><LI
><P
>If you plan to maintain a central version of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file (the
                conventional location is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/afs/</B
></SPAN
><VAR
CLASS="replaceable"
>cellname</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/common/etc/CellServDB</B
></SPAN
>), create it now as a copy of the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/CellServDB</B
></SPAN
> file. Verify that it includes an entry for each foreign cell you
                want your users to be able to access. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir common</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>mkdir common/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cp  /usr/vice/etc/CellServDB  common/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/vos release root.cell</B
></SPAN
>
</PRE
></P
></LI
></OL
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls</B
></SPAN
> command to verify that the new cell's mount point is visible in your
          filespace. The output lists the directories at the top level of the new cell's AFS filespace. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ls /afs/</B
></SPAN
><VAR
CLASS="replaceable"
>foreign_cell</VAR
>
</PRE
></P
></LI
><LI
><P
>Please register your cell with the AFS Product Support group at this time. If you do not want to participate in the
          global AFS namespace, they list your cell in a private <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> file that is not
          available to other AFS cells.</P
></LI
></OL
></P
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ93"
>Improving Cell Security</A
></H1
><P
>This section discusses ways to improve the security of AFS data in your cell. Also see the chapter in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM
    AFS Administration Guide</I
></SPAN
> about configuration and administration issues.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ94"
>Controlling root Access</A
></H2
><P
>As on any machine, it is important to prevent unauthorized users from logging onto an AFS server or client machine as
      the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>. Take care to keep the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>
      password secret.</P
><P
>The local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> superuser does not have special access to AFS data through the Cache
      Manager (as members of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:administrators</B
></SPAN
> group do), but it does have the following
      privileges: <UL
><LI
><P
>On client machines, the ability to issue commands from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
> suite that affect
            AFS performance</P
></LI
><LI
><P
>On server machines, the ability to disable authorization checking, or to install rogue process binaries</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ95"
>Controlling System Administrator Access</A
></H2
><P
>Following are suggestions for managing AFS administrative privilege: <UL
><LI
><P
>Create an administrative account for each administrator named something like
            <VAR
CLASS="replaceable"
>username</VAR
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.admin</B
></SPAN
>. Administrators authenticate under these
            identities only when performing administrative tasks, and destroy the administrative tokens immediately after finishing
            the task (either by issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>unlog</B
></SPAN
> command, or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>klog</B
></SPAN
> command to adopt their regular identity).</P
></LI
><LI
><P
>Set a short ticket lifetime for administrator accounts (for example, 20 minutes) by using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-lifetime</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kas setfields</B
></SPAN
> command, which is
            described in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
>. Do not however, use a short lifetime for users
            who issue long-running <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands.</P
></LI
><LI
><P
>Limit the number of system administrators in your cell, especially those who belong to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>system:administrators</B
></SPAN
> group. By default they have all ACL rights on all directories in the local
            AFS filespace, and therefore must be trusted not to examine private files.</P
></LI
><LI
><P
>Limit the use of system administrator accounts on machines in public areas. It is especially important not to
            leave such machines unattended without first destroying the administrative tokens.</P
></LI
><LI
><P
>Limit the use by administrators of standard UNIX commands that make connections to remote machines (such as the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>telnet</B
></SPAN
> utility). Many of these programs send passwords across the network without
            encrypting them.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ96"
>Protecting Sensitive AFS Directories</A
></H2
><P
>Some subdirectories of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
> directory contain files crucial to cell security.
      Unauthorized users must not read or write to these files because of the potential for misuse of the information they
      contain.</P
><P
>As the BOS Server initializes for the first time on a server machine, it creates several files and directories (as
      mentioned in <A
HREF="c371.html#HDRWQ50"
>Starting the BOS Server</A
>). It sets their owner to the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> and sets their mode bits to enable writing by the owner only; in some cases, it also restricts
      reading.</P
><P
>At each subsequent restart, the BOS Server checks that the owner and mode bits on these files are still set
      appropriately. If they are not, it write the following message to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BosLog</B
></SPAN
>
      file:</P
><PRE
CLASS="programlisting"
>&#13;   Bosserver reports inappropriate access on server directories   
</PRE
><P
>The BOS Server does not reset the mode bits, which enables you to set alternate values if you wish.</P
><P
>The following charts lists the expected mode bit settings. A question mark indicates that the BOS Server does not check
      that mode bit.</P
><DIV
CLASS="informaltable"
><A
NAME="AEN5367"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL
WIDTH="30*"><COL
WIDTH="70*"><TBODY
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwxr</SAMP
>?<SAMP
CLASS="computeroutput"
>xr-x</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwx</SAMP
>???<SAMP
CLASS="computeroutput"
>---</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwxr</SAMP
>?<SAMP
CLASS="computeroutput"
>xr-x</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/db</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwx</SAMP
>???<SAMP
CLASS="computeroutput"
>---</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwxr</SAMP
>?<SAMP
CLASS="computeroutput"
>xr-x</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>-rw</SAMP
>????<SAMP
CLASS="computeroutput"
>---</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>-rw</SAMP
>?????<SAMP
CLASS="computeroutput"
>--</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwx</SAMP
>???<SAMP
CLASS="computeroutput"
>---</SAMP
></TD
></TR
><TR
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs</B
></SPAN
></TD
><TD
><SAMP
CLASS="computeroutput"
>drwxr</SAMP
>?<SAMP
CLASS="computeroutput"
>xr-x</SAMP
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ98"
>Removing Client Functionality</A
></H1
><P
>Follow the instructions in this section only if you do not wish this machine to remain an AFS client. Removing client
    functionality means that you cannot use this machine to access AFS files. <OL
TYPE="1"
><LI
><P
>Remove the files from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc</B
></SPAN
> directory. The command does not remove the
          directory for files used by the dynamic kernel loader program, if it exists on this system type. Those files are still
          needed on a server-only machine. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/vice/etc</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm  *</B
></SPAN
> 
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm -rf  C</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Create symbolic links to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ThisCell</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CellServDB</B
></SPAN
> files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc</B
></SPAN
> directory. This makes it
          possible to issue commands from the AFS command suites (such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs</B
></SPAN
>) on this machine. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/afs/etc/ThisCell ThisCell</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ln -s /usr/afs/etc/CellServDB CellServDB</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>On IRIX systems, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>chkconfig</B
></SPAN
> command to deactivate the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>afsclient</B
></SPAN
> configuration variable. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/etc/chkconfig -f afsclient off</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Reboot the machine. Most system types use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown</B
></SPAN
> command, but the appropriate
          options vary. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>shutdown</B
></SPAN
> <VAR
CLASS="replaceable"
>appropriate_options</VAR
>
</PRE
></P
></LI
></OL
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c104.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c5467.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Installation Overview</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Installing Additional Server Machines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>