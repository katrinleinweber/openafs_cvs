<?xml version="1.0" encoding="UTF-8"?>
<refentry id="backup_savedb8">
  <refmeta>
    <refentrytitle>backup savedb</refentrytitle>
    <manvolnum>8</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>backup savedb</refname>
    <refpurpose>Creates a saved copy of the Backup Database</refpurpose>
  </refnamediv>
  <refsect1>
    <title>Synopsis</title>
    <para><emphasis role="bold">backup savedb</emphasis> [<emphasis role="bold">-portoffset</emphasis> &lt;<emphasis>TC port offset</emphasis>&gt;]
        [<emphasis role="bold">-archive</emphasis> &lt;<emphasis>date time</emphasis>&gt;+] [<emphasis role="bold">-localauth</emphasis>]
        [<emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;] [<emphasis role="bold">-help</emphasis>]</para>

    <para><emphasis role="bold">backup sa</emphasis> [<emphasis role="bold">-p</emphasis> &lt;<emphasis>TC port offset</emphasis>&gt;] [<emphasis role="bold">-a</emphasis> &lt;<emphasis>date time</emphasis>&gt;+]
        [<emphasis role="bold">-l</emphasis>] [<emphasis role="bold">-c</emphasis> &lt;<emphasis>cell name</emphasis>&gt;] [<emphasis role="bold">-h</emphasis>]</para>

  </refsect1>
  <refsect1>
    <title>Description</title>
    <para>The <emphasis role="bold">backup savedb</emphasis> command creates a backup copy of the entire Backup
    Database and writes it to the tape in the device controlled by the Tape
    Coordinator indicated with the <emphasis role="bold">-portoffset</emphasis> argument. If the database is
    damaged (as reported by the <emphasis role="bold">backup dbverify</emphasis> command), this command
    repairs as much of the corruption as possible as it creates the saved
    copy. The Backup Server creates a dump record for the saved database in
    the Backup Database (but in the disk version of the database only, not in
    the version written to tape).</para>

    <para>If the <computeroutput>FILE YES</computeroutput> instruction appears in the
    <replaceable>/usr/afs/backup/CFG_</replaceable><emphasis>device_name</emphasis><replaceable></replaceable> file associated with the specified
    port offset, then the <emphasis role="bold">backup savedb</emphasis> command dumps the database copy to
    the backup data file listed for that port offset in the Tape Coordinator's
    <replaceable>/usr/afs/backup/tapeconfig</replaceable> file, instead of to tape. For the sake of
    clarity, the following text refers to tapes only, but the Backup System
    handles backup data files in much the same way.</para>

    <para>If the <emphasis role="bold">-archive</emphasis> flag is provided, after writing the saved copy of the
    database the Backup System truncates the copy of the database on disk by
    deleting volume dump records with timestamps prior to the specified date
    and time (it does not delete the dump records created by previous <emphasis role="bold">backup
    savedb</emphasis> commands, however).</para>

    <para>If the tape to which the database copy is written has an AFS tape name, it
    must be <computeroutput>Ubik_db_dump.1</computeroutput> or <computeroutput>&lt;NULL&gt;</computeroutput>. Any permanent name is
    acceptable.</para>

    <para>The Tape Coordinator's default response to this command is to access the
    first tape by invoking the <computeroutput>MOUNT</computeroutput> instruction in the local
    <replaceable>/usr/afs/backup/CFG_</replaceable><emphasis>device_name</emphasis><replaceable></replaceable> file, or by prompting the backup
    operator to insert the tape if there is no <computeroutput>MOUNT</computeroutput> instruction. However,
    if the <computeroutput>AUTOQUERY NO</computeroutput> instruction appears in the <replaceable>CFG_</replaceable><emphasis>device_name</emphasis><replaceable></replaceable>
    file, or if the issuer of the <emphasis role="bold">butc</emphasis> command included the <emphasis role="bold">-noautoquery</emphasis>
    flag, the Tape Coordinator instead expects the tape to be in the device
    already.  If it is not, the Tape Coordinator invokes the <computeroutput>MOUNT</computeroutput>
    instruction or prompts the operator. It also invokes the <computeroutput>MOUNT</computeroutput>
    instruction or prompts for any additional tapes needed to complete the
    operation; the backup operator must arrange to provide them.</para>

  </refsect1>
  <refsect1>
    <title>Options</title>
    <variablelist>
      <varlistentry>
        <term><emphasis role="bold">-portoffset</emphasis> &lt;<emphasis>TC port offset</emphasis>&gt;</term>
        <listitem>
          <para>Specifies the port offset number of the Tape Coordinator handling the
          tapes for this operation.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-archive</emphasis> &lt;<emphasis>date time</emphasis>&gt;+</term>
        <listitem>
          <para>Specifies a date and time; volume dump records with earlier timestamps are
          deleted from the disk copy of the Backup Database after the Backup System
          dumps the database (a dump's timestamp appears in the <computeroutput>created</computeroutput> field of
          the output from the <emphasis role="bold">backup dumpinfo</emphasis> command). However, if a dump set
          contains any dump created after the specified date, none of the dump
          records associated with the dump set are deleted. Dump records for
          previous dumps of the database (created with the <emphasis role="bold">backup savedb</emphasis> command)
          are never deleted; use the <emphasis role="bold">backup deletedump</emphasis> command to remove them.</para>

          <para>Provide one of two values:</para>

          <itemizedlist>
            <listitem>
              <para>The string <computeroutput>NOW</computeroutput> to indicate the current date and time, in which case the
              Backup System deletes all dump records except those for dumps of the
              Backup Database itself.</para>

            </listitem>
            <listitem>
              <para>A date value in the format <emphasis>mm/dd/yyyy</emphasis> [<emphasis>hh:MM</emphasis>]. The month (<emphasis>mm</emphasis>),
              day (<emphasis>dd</emphasis>), and year (<emphasis>yyyy</emphasis>) are required, and valid values for the
              year range from <computeroutput>1970</computeroutput> to <computeroutput>2037</computeroutput>; higher values are not valid because
              the latest possible date in the standard UNIX representation is in
              February 2038. The Backup System automatically reduces any later date to
              the maximum value.</para>

              <para>The hour and minutes (<emphasis>hh:MM</emphasis>) are optional, but if provided must be in
              24-hour format (for example, the value <computeroutput>14:36</computeroutput> represents 2:36 p.m.). If
              omitted, the time defaults to 59 seconds after midnight (00:00:59
              hours). Similarly, the <emphasis role="bold">backup</emphasis> command interpreter automatically adds 59
              seconds to any time value provided. In both cases, adding 59 seconds
              compensates for how the Backup Database and <emphasis role="bold">backup dumpinfo</emphasis> command
              represent dump creation times in hours and minutes only. That is, the
              Database records a creation timestamp of <computeroutput>20:55</computeroutput> for any dump created
              between 20:55:00 and 20:55:59. Automatically adding 59 seconds to a time
              thus includes the records for all dumps created during that minute.</para>

            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-localauth</emphasis></term>
        <listitem>
          <para>Constructs a server ticket using a key from the local
          <replaceable>/usr/afs/etc/KeyFile</replaceable> file. The <emphasis role="bold">backup</emphasis> command interpreter presents
          it to the Backup Server, Volume Server and VL Server during mutual
          authentication. Do not combine this flag with the <emphasis role="bold">-cell</emphasis> argument. For
          more details, see <link linkend="backup8">backup(8)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;</term>
        <listitem>
          <para>Names the cell in which to run the command. Do not combine this argument
          with the <emphasis role="bold">-localauth</emphasis> flag. For more details, see <link linkend="backup8">backup(8)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-help</emphasis></term>
        <listitem>
          <para>Prints the online help for this command. All other valid options are
          ignored.</para>

        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>Examples</title>
    <para>The following example writes a copy of the Backup Database to the tape
    device controlled by the Tape Coordinator with port offset 1:</para>

<programlisting>
   % backup savedb -portoffset 1

</programlisting>
    </refsect1>
    <refsect1>
      <title>Privilege Required</title>
      <para>The issuer must be listed in the <replaceable>/usr/afs/etc/UserList</replaceable> file on every
      machine where the Backup Server is running, or must be logged onto a
      server machine as the local superuser <computeroutput>root</computeroutput> if the <emphasis role="bold">-localauth</emphasis> flag is
      included.</para>

    </refsect1>
    <refsect1>
      <title>See Also</title>
      <para><link linkend="butc5">butc(5)</link>,
      <link linkend="backup8">backup(8)</link>,
      <link linkend="backup_dbverify8">backup_dbverify(8)</link>,
      <link linkend="backup_restoredb8">backup_restoredb(8)</link>,
      <link linkend="butc8">butc(8)</link></para>

    </refsect1>
    <refsect1>
      <title>Copyright</title>
      <para>IBM Corporation 2000. &lt;http://www.ibm.com/&gt; All Rights Reserved.</para>

      <para>This documentation is covered by the IBM Public License Version 1.0.  It was
      converted from HTML to POD by software written by Chas Williams and Russ
      Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</para>

    </refsect1>
  </refentry>
