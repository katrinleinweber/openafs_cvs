<?xml version="1.0" encoding="UTF-8"?>
<refentry id="backup_dbverify8">
  <refmeta>
    <refentrytitle>backup dbverify</refentrytitle>
    <manvolnum>8</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>backup dbverify</refname>
    <refpurpose>Checks the integrity of the Backup Database</refpurpose>
  </refnamediv>
  <refsect1>
    <title>Synopsis</title>
    <para><emphasis role="bold">backup dbverify</emphasis> [<emphasis role="bold">-detail</emphasis>] [<emphasis role="bold">-localauth</emphasis>] [<emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;]
        [<emphasis role="bold">-help</emphasis>]</para>

    <para><emphasis role="bold">backup db</emphasis> [<emphasis role="bold">-d</emphasis>] [<emphasis role="bold">-l</emphasis>] [<emphasis role="bold">-c</emphasis> &lt;<emphasis>cell name</emphasis>&gt;] [<emphasis role="bold">-h</emphasis>]</para>

  </refsect1>
  <refsect1>
    <title>Description</title>
    <para>The <emphasis role="bold">backup dbverify</emphasis> command checks the integrity of the Backup
    Database. The command's output indicates whether the Backup Database is
    damaged (data is corrupted) or not. If the Backup Database is undamaged,
    it is safe to continue using it. If it is corrupted, discontinue any
    backup operations until it is repaired.</para>

  </refsect1>
  <refsect1>
    <title>Cautions</title>
    <para>While this command runs, no other backup operation can access the Backup
    Database; the other commands do not run until this command
    completes. Avoid issuing this command when other backup operations are
    likely to run. The <emphasis role="bold">backup savedb</emphasis> command repairs some types of
    corruption.</para>

  </refsect1>
  <refsect1>
    <title>Options</title>
    <variablelist>
      <varlistentry>
        <term><emphasis role="bold">-detail</emphasis></term>
        <listitem>
          <para>Reports the number of orphaned blocks found, any inconsistencies, and the
          name of the server machine running the Backup Server that is checking its
          copy of the database.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-localauth</emphasis></term>
        <listitem>
          <para>Constructs a server ticket using a key from the local
          <replaceable>/usr/afs/etc/KeyFile</replaceable> file. The <emphasis role="bold">backup</emphasis> command interpreter presents
          it to the Backup Server, Volume Server and VL Server during mutual
          authentication. Do not combine this flag with the <emphasis role="bold">-cell</emphasis> argument. For
          more details, see <link linkend="backup8">backup(8)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;</term>
        <listitem>
          <para>Names the cell in which to run the command. Do not combine this argument
          with the <emphasis role="bold">-localauth</emphasis> flag. For more details, see <link linkend="backup8">backup(8)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-help</emphasis></term>
        <listitem>
          <para>Prints the online help for this command. All other valid options are
          ignored.</para>

        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>Output</title>
    <para>The command displays one of the following two messages:</para>

    <variablelist>
      <varlistentry>
        <term>Database OK</term>
        <listitem>
          <para>The database is undamaged and can be used.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Database not OK</term>
        <listitem>
          <para>The database is damaged. You can use the backup savedb command to repair
          many kinds of corruption as it creates a backup copy.  For more detailed
          instructions, see the <emphasis>IBM AFS Administration Guide</emphasis> chapter about
          performing backup operations.</para>

        </listitem>
      </varlistentry>
    </variablelist>
    <para>The <emphasis role="bold">-detail</emphasis> flag provides additional information:</para>

    <itemizedlist>
      <listitem>
        <para>The number of <emphasis>orphan blocks</emphasis> found. These are ranges of memory that the
        Backup Server preallocated in the database but cannot use. Orphan blocks
        do not interfere with database access, but do waste disk space. To free
        the unusable space, dump the database to tape by using the <emphasis role="bold">backup
        savedb</emphasis> command, and then restore it by using the <emphasis role="bold">backup restoredb</emphasis>
        command.</para>

      </listitem>
      <listitem>
        <para>Any inconsistencies in the database, such as invalid hostnames for Tape
        Coordinator machines.</para>

      </listitem>
      <listitem>
        <para>The name of the database server machine on which the Backup Database was
        checked, designated as the <computeroutput>Database checker</computeroutput>. For a detailed trace of
        the verification operation, see the <replaceable>/usr/afs/logs/BackupLog</replaceable> file on the
        indicated machine. You can use the <emphasis role="bold">bos getlog</emphasis> command to display it.</para>

      </listitem>
    </itemizedlist>
  </refsect1>
  <refsect1>
    <title>Examples</title>
    <para>The following command confirms that the Backup Database is undamaged:</para>

<programlisting>
   % backup dbverify
   Database OK

</programlisting>
      <para>The following command confirms that the Backup Database is undamaged and
      that it has no orphan blocks or invalid Tape Coordinator entries. The
      Backup Server running on the machine <computeroutput>db1.abc.com</computeroutput> checked its copy of
      the Database.</para>

<programlisting>
   % backup dbverify -detail
   Database OK
   Orphan blocks 0
   Database checker was db1.abc.com

</programlisting>
      </refsect1>
      <refsect1>
        <title>Privilege Required</title>
        <para>The issuer must be listed in the <replaceable>/usr/afs/etc/UserList</replaceable> file on every
        machine where the Backup Server is running, or must be logged onto a
        server machine as the local superuser <computeroutput>root</computeroutput> if the <emphasis role="bold">-localauth</emphasis> flag is
        included.</para>

      </refsect1>
      <refsect1>
        <title>See Also</title>
        <para><link linkend="BackupLog5">BackupLog(5)</link>,
        <link linkend="backup8">backup(8)</link>,
        <link linkend="backup_restoredb8">backup_restoredb(8)</link>,
        <link linkend="backup_savedb8">backup_savedb(8)</link>,
        <link linkend="bos_getlog8">bos_getlog(8)</link></para>

      </refsect1>
      <refsect1>
        <title>Copyright</title>
        <para>IBM Corporation 2000. &lt;http://www.ibm.com/&gt; All Rights Reserved.</para>

        <para>This documentation is covered by the IBM Public License Version 1.0.  It was
        converted from HTML to POD by software written by Chas Williams and Russ
        Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</para>

      </refsect1>
    </refentry>
