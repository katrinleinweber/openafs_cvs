<?xml version="1.0" encoding="UTF-8"?>
<refentry id="vos_release1">
  <refmeta>
    <refentrytitle>vos release</refentrytitle>
    <manvolnum>1</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>vos release</refname>
    <refpurpose>Updates read-only volumes to match the read/write source volume</refpurpose>
  </refnamediv>
  <refsect1>
    <title>Synopsis</title>
    <para><emphasis role="bold">vos release</emphasis> <emphasis role="bold">-id</emphasis> &lt;<emphasis>volume name or ID</emphasis>&gt; [<emphasis role="bold">-f</emphasis>]
        [<emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;] [<emphasis role="bold">-noauth</emphasis>] [<emphasis role="bold">-localauth</emphasis>] [<emphasis role="bold">-verbose</emphasis>]
        [<emphasis role="bold">-help</emphasis>]</para>

    <para><emphasis role="bold">vos rel</emphasis> <emphasis role="bold">-i</emphasis> &lt;<emphasis>volume name or ID</emphasis>&gt; [<emphasis role="bold">-f</emphasis>] [<emphasis role="bold">-c</emphasis> &lt;<emphasis>cell name</emphasis>&gt;]
        [<emphasis role="bold">-n</emphasis>] [<emphasis role="bold">-l</emphasis>] [<emphasis role="bold">-v</emphasis>] [<emphasis role="bold">-h</emphasis>]</para>

  </refsect1>
  <refsect1>
    <title>Description</title>
    <para>The <emphasis role="bold">vos release</emphasis> command copies the contents of the indicated read/write
    source volume to each read-only site defined in the source volume's Volume
    Location Database (VLDB) entry. (Use the <emphasis role="bold">vos addsite</emphasis> command to define
    sites as necessary before issuing this command). Each read-only copy has
    the same name as read/write source with the addition of a <computeroutput>.readonly</computeroutput>
    extension.</para>

    <para>For users to have a consistent view of the file system, the release of the
    new volume version must be atomic: either all read-only sites receive the
    new version, or all sites keep the version they currently have. The <emphasis role="bold">vos
    release</emphasis> command is designed to ensure that all copies of the volume's
    read-only version match both the read/write source and each other. In
    cases where problems such as machine or server process outages prevent
    successful completion of the release operation, AFS uses two mechanisms to
    alert the administrator.</para>

    <para>First, the command interpreter generates an error message on the standard
    error stream naming each read-only site that did not receive the new
    volume version. Second, during the release operation the Volume Location
    (VL) Server marks site definitions in the VLDB entry with flags (<computeroutput>New
    release</computeroutput> and <computeroutput>Old release</computeroutput>) that indicate whether or not the site has the
    new volume version. If any flags remain after the operation completes, it
    was not successful. The Cache Manager refuses to access a read-only site
    marked with the <computeroutput>Old release</computeroutput> flag, which potentially imposes a greater
    load on the sites marked with the <computeroutput>New release</computeroutput> flag. It is important to
    investigate and eliminate the cause of the failure and then to issue the
    <emphasis role="bold">vos release</emphasis> command as many times as necessary to complete the release
    without errors.</para>

    <para>The pattern of site flags remaining in the volume's VLDB entry after a
    failed release operation can help determine the point at which the
    operation failed. Use the <emphasis role="bold">vos examine</emphasis> or <emphasis role="bold">vos listvldb</emphasis> command to
    display the VLDB entry. The VL Server sets the flags in concert with the
    Volume Server's operations, as follows:</para>

    <itemizedlist>
      <listitem>
        <para>Before the operation begins, the VL Server sets the <computeroutput>New release</computeroutput> flag on
        the read/write site definition in the VLDB entry and the <computeroutput>Old release</computeroutput>
        flag on read-only site definitions (unless the read-only site has been
        defined since the last release operation and has no actual volume, in
        which case its site flag remains <computeroutput>Not released</computeroutput>).</para>

      </listitem>
      <listitem>
        <para>If necessary, the Volume Server creates a temporary copy (a <emphasis>clone</emphasis>) of
        the read/write source called the ReleaseClone (see the following
        discussion of when the Volume Server does or does not create a new
        ReleaseClone.) It assigns the ReleaseClone its own volume ID number, which
        the VL Server records in the <computeroutput>RClone</computeroutput> field of the source volume's VLDB
        entry.</para>

      </listitem>
      <listitem>
        <para>The Volume Server distributes a copy of the ReleaseClone to each read-only
        site defined in the VLDB entry. As the site successfully receives the new
        clone, the VL Server sets the site's flag in the VLDB entry to <computeroutput>New
        release</computeroutput>.</para>

      </listitem>
      <listitem>
        <para>When all the read-only copies are successfully released, the VL Server
        clears all the <computeroutput>New release</computeroutput> site flags. The ReleaseClone is no longer
        needed, so the Volume Server deletes it and the VL Server erases its ID
        from the VLDB entry.</para>

      </listitem>
    </itemizedlist>
    <para>By default, the Volume Server determines automatically whether or not it
    needs to create a new ReleaseClone:</para>

    <itemizedlist>
      <listitem>
        <para>If there are no flags (<computeroutput>New release</computeroutput>, <computeroutput>Old release</computeroutput>, or <computeroutput>Not released</computeroutput>)
        on site definitions in the VLDB entry, the previous <emphasis role="bold">vos release</emphasis> command
        completed successfully and all read-only sites currently have the same
        volume. The Volume Server infers that the current <emphasis role="bold">vos release</emphasis> command
        was issued because the read/write volume has changed. The Volume Server
        creates a new ReleaseClone and distributes it to all of the read-only
        sites.</para>

      </listitem>
      <listitem>
        <para>If any site definition in the VLDB entry is marked with a flag, either the
        previous release operation did not complete successfully or a new
        read-only site was defined since the last release. The Volume Server does
        not create a new ReleaseClone, instead distributing the existing
        ReleaseClone to sites marked with the <computeroutput>Old release</computeroutput> or <computeroutput>Not released</computeroutput>
        flag. As previously noted, the VL Server marks each VLDB site definition
        with the <computeroutput>New release</computeroutput> flag as the site receives the ReleaseClone, and
        clears all flags after all sites successfully receive it.</para>

      </listitem>
    </itemizedlist>
    <para>To override the default behavior, forcing the Volume Server to create and
    release a new ReleaseClone to the read-only sites, include the <emphasis role="bold">-f</emphasis>
    flag. This is appropriate if, for example, the data at the read/write site
    has changed since the existing ReleaseClone was created during the
    previous release operation.</para>

  </refsect1>
  <refsect1>
    <title>Options</title>
    <variablelist>
      <varlistentry>
        <term><emphasis role="bold">-id</emphasis> &lt;<emphasis>volume name or id</emphasis>&gt;</term>
        <listitem>
          <para>Specifies either the complete name or volume ID number of a read/write
          volume.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-f</emphasis></term>
        <listitem>
          <para>Creates a new ReleaseClone and distributes it all read-only sites
          regardless of whether or not any site definitions in the VLDB entry are
          marked with a flag.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-cell</emphasis> &lt;<emphasis>cell name</emphasis>&gt;</term>
        <listitem>
          <para>Names the cell in which to run the command. Do not combine this argument
          with the <emphasis role="bold">-localauth</emphasis> flag. For more details, see <link linkend="vos1">vos(1)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-noauth</emphasis></term>
        <listitem>
          <para>Assigns the unprivileged identity <computeroutput>anonymous</computeroutput> to the issuer. Do not
          combine this flag with the <emphasis role="bold">-localauth</emphasis> flag. For more details, see
          <link linkend="vos1">vos(1)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-localauth</emphasis></term>
        <listitem>
          <para>Constructs a server ticket using a key from the local
          <replaceable>/usr/afs/etc/KeyFile</replaceable> file. The <emphasis role="bold">vos</emphasis> command interpreter presents it
          to the Volume Server and Volume Location Server during mutual
          authentication. Do not combine this flag with the <emphasis role="bold">-cell</emphasis> argument or
          <emphasis role="bold">-noauth</emphasis> flag. For more details, see <link linkend="vos1">vos(1)</link>.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-verbose</emphasis></term>
        <listitem>
          <para>Produces on the standard output stream a detailed trace of the command's
          execution. If this argument is omitted, only warnings and error messages
          appear.</para>

        </listitem>
      </varlistentry>
      <varlistentry>
        <term><emphasis role="bold">-help</emphasis></term>
        <listitem>
          <para>Prints the online help for this command. All other valid options are
          ignored.</para>

        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>Examples</title>
    <para>The following command clones the read/write volume usr and releases it to
    the read-only sites defined in its VLDB entry.</para>

<programlisting>
   % vos release usr

</programlisting>
    </refsect1>
    <refsect1>
      <title>Privilege Required</title>
      <para>The issuer must be listed in the <replaceable>/usr/afs/etc/UserList</replaceable> file on the
      machine specified with the <emphasis role="bold">-server</emphasis> argument and on each database server
      machine. If the <emphasis role="bold">-localauth</emphasis> flag is included, the issuer must instead be
      logged on to a server machine as the local superuser <computeroutput>root</computeroutput>.</para>

    </refsect1>
    <refsect1>
      <title>See Also</title>
      <para><link linkend="vos1">vos(1)</link>,
      <link linkend="vos_addsite1">vos_addsite(1)</link>,
      <link linkend="vos_examine1">vos_examine(1)</link>,
      <link linkend="vos_listvldb1">vos_listvldb(1)</link></para>

    </refsect1>
    <refsect1>
      <title>Copyright</title>
      <para>IBM Corporation 2000. &lt;http://www.ibm.com/&gt; All Rights Reserved.</para>

      <para>This documentation is covered by the IBM Public License Version 1.0.  It was
      converted from HTML to POD by software written by Chas Williams and Russ
      Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</para>

    </refsect1>
  </refentry>
