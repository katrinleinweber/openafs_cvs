<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Backing Up and Restoring AFS Data</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="AFS Administration Guide"
HREF="book1.html"><LINK
REL="UP"
TITLE="Managing File Server Machines"
HREF="p3023.html"><LINK
REL="PREVIOUS"
TITLE="Configuring the AFS Backup System"
HREF="c12776.html"><LINK
REL="NEXT"
TITLE="Monitoring and Auditing AFS Performance"
HREF="c18360.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>AFS Administration Guide: Version 3.6</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c12776.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c18360.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="HDRWQ283"
></A
>Chapter 7. Backing Up and Restoring AFS Data</H1
><P
>The instructions in this chapter explain how to back up and restore AFS data and to administer the Backup Database. They
  assume that you have already configured all of the Backup System components by following the instructions in <A
HREF="c12776.html"
>Configuring the AFS Backup System</A
>.</P
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ284"
>Summary of Instructions</A
></H1
><P
>This chapter explains how to perform the following tasks by using the indicated commands:</P
><DIV
CLASS="informaltable"
><A
NAME="AEN15390"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL
WIDTH="70*"><COL
WIDTH="30*"><TBODY
><TR
><TD
>Enter interactive mode</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup (interactive)</B
></SPAN
></TD
></TR
><TR
><TD
>Leave interactive mode</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) quit</B
></SPAN
></TD
></TR
><TR
><TD
>List operations in interactive mode</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) jobs</B
></SPAN
></TD
></TR
><TR
><TD
>Cancel operation in interactive mode</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
></TD
></TR
><TR
><TD
>Start Tape Coordinator</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
></TD
></TR
><TR
><TD
>Stop Tape Coordinator</TD
><TD
>&#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Ctrl-c</B
></SPAN
>&#62;</TD
></TR
><TR
><TD
>Check status of Tape Coordinator</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup status</B
></SPAN
></TD
></TR
><TR
><TD
>Back up data</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
></TD
></TR
><TR
><TD
>Display dump records</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
></TD
></TR
><TR
><TD
>Display volume's dump history</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
></TD
></TR
><TR
><TD
>Scan contents of tape</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
></TD
></TR
><TR
><TD
>Restore volume</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
></TD
></TR
><TR
><TD
>Restore partition</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
></TD
></TR
><TR
><TD
>Restore group of volumes</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
></TD
></TR
><TR
><TD
>Verify integrity of Backup Database</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
></TD
></TR
><TR
><TD
>Repair corruption in Backup Database</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup restoredb</B
></SPAN
></TD
></TR
><TR
><TD
>Delete dump set from Backup Database</TD
><TD
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ286"
>Using the Backup System's Interfaces</A
></H1
><P
>When performing backup operations, you interact with three Backup System components: <UL
><LI
><P
>You initiate backup operations by issuing commands from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> suite. You can
          issue the commands in a command shell (or invoke them in a shell script) on any AFS client or server machine from which
          you can access the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> binary. In the conventional configuration, the binary resides
          in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin</B
></SPAN
> directory on a server machine and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afsws/etc</B
></SPAN
> directory on a client machine.</P
><P
>The suite provides an <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>interactive mode</I
></SPAN
>, in which you can issue multiple commands over a
          persistent connection to the Backup Server and the Volume Location (VL) Server. Interactive mode has several convenient
          features. For a discussion and instructions, see <A
HREF="c15383.html#HDRWQ288"
>Using Interactive and Regular Command
          Mode</A
>.</P
><P
>Note that some operating systems include a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command of their own. You must
          configure machines that run such an operating system to ensure that you are accessing the desired <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> binary.</P
></LI
><LI
><P
>Before you perform a backup operation that involves reading or writing to a tape device or backup data file, you
          must open a dedicated connection to the appropriate Tape Coordinator machine and start the Tape Coordinator (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
>) process that handles the device or file. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> process
          must continue to run over the dedicated connection as long as it is executing an operation or is to be available to
          execute one. For further discussion and instructions, see <A
HREF="c15383.html#HDRWQ291"
>Starting and Stopping the Tape
          Coordinator Process</A
>.</P
></LI
><LI
><P
>The Backup Server (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver</B
></SPAN
>) process must be running on database server machines,
          because most backup operations require accessing or changing information in the Backup Database. The <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS
          Quick Beginnings</I
></SPAN
> explains how to configure the Backup Server.</P
></LI
></UL
></P
><P
>For consistent Backup System performance, the AFS build level of all three binaries (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
>, and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver</B
></SPAN
>) must match.
    For instructions on displaying the build level, see <A
HREF="c3025.html#HDRWQ117"
>Displaying A Binary File's Build
    Level</A
>.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ287"
>Performing Backup Operations as the Local Superuser Root or in a Foreign Cell</A
></H2
><P
>By default, the volumes and Backup Database involved in a backup operation must reside on server machines that belong to
      the cell named in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> files on both the Tape Coordinator machine and
      the machine where you issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command. Also, to issue most <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands you must have AFS tokens for an identity listed in the local cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
> file (which by convention is the same on every server machine in a cell). You
      can, however, perform backup operations on volumes or the Backup Database from a foreign cell, or perform backup operations
      while logged in as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> rather than as a privileged AFS identity.</P
><P
>To perform backup operations on volumes that reside in a foreign cell using machines from the local cell, you must
      designate the foreign cell as the cell of execution for both the Tape Coordinator and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter. Use one of the two following methods. For either method, you must also have
      tokens as an administrator listed in the foreign cell's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
> file.
      <UL
><LI
><P
>Before issuing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
>
            command, set the AFSCELL environment variable to the foreign cell name in both command shells.</P
></LI
><LI
><P
>Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> and all
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands. If you include the argument on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            (interactive)</B
></SPAN
> command, it applies to all commands issued during the interactive session.</P
></LI
></UL
></P
><P
>To perform backup operations without having administrative AFS tokens, you must log on as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> on both the Tape Coordinator machine and the machine where you issue <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands. Both machines must be server machines, or at least have a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file that matches the file on other server machines. Then include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> argument on both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command and all <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands (or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup (interactive)</B
></SPAN
> command). The Tape
      Coordinator and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter construct a server ticket using the server
      encryption key with the highest key version number in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file,
      and present it to the Backup Server, Volume Server, and VL Server that belong to the cell named in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/ThisCell</B
></SPAN
> file. The ticket never expires.</P
><P
>You cannot combine the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> options on
      the same command. Also, each one overrides the local cell setting defined by the AFSCELL environment variable or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> file.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ288"
>Using Interactive and Regular Command Mode</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command suite provides an interactive mode, in which you can issue multiple
      commands over a persistent connection to the Backup Server and the VL Server. Interactive mode provides the following
      features: <UL
><LI
><P
>The <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt replaces the usual command shell prompt.</P
></LI
><LI
><P
>You omit the initial <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> string from command names. Type only the operation
            code and option names.</P
></LI
><LI
><P
>You cannot issue commands that do not belong to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> suite.</P
></LI
><LI
><P
>If you assume an administrative AFS identity or specify a foreign cell as you enter interactive mode, it applies
            to all commands issued during the interactive session. See <A
HREF="c15383.html#HDRWQ287"
>Performing Backup Operations as the
            Local Superuser Root or in a Foreign Cell</A
>.</P
></LI
><LI
><P
>You do not need to enclose shell metacharacters in double quotes.</P
></LI
></UL
></P
><P
>When you initiate a backup operation in interactive mode, the Backup System assigns it a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>job ID
      number</I
></SPAN
>. You can display the list of current and pending operations with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup)
      jobs</B
></SPAN
> command, for which instructions appear in <A
HREF="c15383.html#HDRWQ289"
>To display pending or running jobs in
      interactive mode</A
>. (In both regular and interactive modes, the Tape Coordinator also assigns a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>task ID
      number</I
></SPAN
> to each operation you initiate with a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command. You can track task ID
      numbers with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup status</B
></SPAN
> command. See <A
HREF="c15383.html#HDRWQ291"
>Starting and Stopping
      the Tape Coordinator Process</A
>.)</P
><P
>You can cancel an operation in interactive mode with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command, for
      which instructions appear in <A
HREF="c15383.html#HDRWQ290"
>To cancel operations in interactive mode</A
>. However, it is best not
      to interrupt a dump operation because the resulting dump is incomplete, and interrupting a restore operation can leave volumes
      in an inconsistent state, or even completely remove them from the server machine. For further discussion, see <A
HREF="c15383.html#HDRWQ296"
>Backing Up Data</A
> and <A
HREF="c15383.html#HDRWQ306"
>Restoring and Recovering Data</A
>.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) jobs</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> commands are
      available only in interactive mode and there is no equivalent functionality in regular command mode.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_325"
>To enter interactive mode</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. Entering interactive mode does not itself require privilege, but most other <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
          commands do, and the AFS identity you assume when entering the mode applies to all commands you issue within it. If
          necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup (interactive)</B
></SPAN
> command at the system prompt. The
          <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt appears. You can include either, but not both, of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> options, as discussed in <A
HREF="c15383.html#HDRWQ287"
>Performing Backup Operations as the Local Superuser Root or in a Foreign Cell</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
   backup&#62;
</PRE
></P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_326"
>To exit interactive mode</A
></H2
><OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
> command at the <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt.
          The command shell prompt reappears when the command succeeds, which it does only if there are no jobs pending or currently
          running. To display and cancel pending or running jobs, follow the instructions in <A
HREF="c15383.html#HDRWQ289"
>To display
          pending or running jobs in interactive mode</A
> and <A
HREF="c15383.html#HDRWQ290"
>To cancel operations in interactive
          mode</A
>. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
>
   %
</PRE
></P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ289"
>To display pending or running jobs in interactive mode</A
></H2
><OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
> command at the <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt.
          <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
>
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>j</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
>.</P
></DD
></DL
></DIV
></P
></LI
></OL
><P
>The output always includes the expiration date and time of the tokens that the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
      command interpreter is using during the current interactive session, in the following format:</P
><PRE
CLASS="programlisting"
>&#13;   date   time: TOKEN EXPIRATION
</PRE
><P
>If the execution date and time specified for a scheduled dump operation is later than <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>date time</I
></SPAN
>,
      then its individual line (as described in the following paragraphs) appears below this line to indicate that the current
      tokens will not be available to it.</P
><P
>If the issuer of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command included the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> flag when entering interactive mode, the line instead reads as follows:</P
><PRE
CLASS="programlisting"
>&#13;   :  TOKEN NEVER EXPIRES
</PRE
><P
>The entry for a scheduled dump operation has the following format:</P
><PRE
CLASS="programlisting"
>&#13;   Job job_ID:  timestamp:  dump  volume_set  dump_level
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>job_ID</B
></SPAN
></DT
><DD
><P
>Is a job identification number assigned by the Backup System.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>timestamp</B
></SPAN
></DT
><DD
><P
>Indicates the date and time the dump operation is to begin, in the format month/date/year hours:minutes (in
              24-hour format)</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume_set</B
></SPAN
></DT
><DD
><P
>Indicates the volume set to dump.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dump_level</B
></SPAN
></DT
><DD
><P
>Indicates the dump level at which to perform the dump operation.</P
></DD
></DL
></DIV
></P
><P
>The line for a pending or running operation of any other type has the following format:</P
><PRE
CLASS="programlisting"
>&#13;   Job job_ID:  operation  status
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>job_ID</B
></SPAN
></DT
><DD
><P
>Is a job identification number assigned by the Backup System.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>operation</B
></SPAN
></DT
><DD
><P
>Identifies the operation the Tape Coordinator is performing, which is initiated by the indicated command:
              <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Dump</SAMP
> (dump name)</B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command. The dump name has the following
                      format:</P
><P
>volume_set_name<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.</B
></SPAN
>dump_level_name</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Restore</SAMP
></B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
                      volrestore</B
></SPAN
>, or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> command.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Labeltape</SAMP
> (tape_label)</B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command. The tape_label is the name
                      specified by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-pname</B
></SPAN
> argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Scantape</SAMP
></B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>SaveDb</SAMP
></B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>RestoreDb</SAMP
></B
></SPAN
></DT
><DD
><P
>Initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup restoredb</B
></SPAN
> command.</P
></DD
></DL
></DIV
></P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>status</B
></SPAN
></DT
><DD
><P
>Indicates the job's current status in one of the following messages. If no message appears, the job is either
              still pending or has finished. <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>number <SAMP
CLASS="computeroutput"
>Kbytes, volume volume_name</SAMP
></B
></SPAN
></DT
><DD
><P
>For a running dump operation, indicates the number of kilobytes copied to tape or a backup data file so
                      far, and the volume currently being dumped.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>number <SAMP
CLASS="computeroutput"
>Kbytes, restore.volume</SAMP
></B
></SPAN
></DT
><DD
><P
>For a running restore operation, indicates the number of kilobytes copied into AFS from a tape or a
                      backup data file so far.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[abort requested]</SAMP
></B
></SPAN
></DT
><DD
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command was issued, but the termination signal has
                      yet to reach the Tape Coordinator.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[abort sent]</SAMP
></B
></SPAN
></DT
><DD
><P
>The operation is canceled by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command. Once the Backup
                      System removes an operation from the queue or stops it from running, it no longer appears at all in the output
                      from the command.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[butc contact lost]</SAMP
></B
></SPAN
></DT
><DD
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter cannot reach the Tape Coordinator. The
                      message can mean either that the Tape Coordinator handling the operation was terminated or failed while the
                      operation was running, or that the connection to the Tape Coordinator timed out.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[done]</SAMP
></B
></SPAN
></DT
><DD
><P
>The Tape Coordinator has finished the operation.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[drive wait]</SAMP
></B
></SPAN
></DT
><DD
><P
>The operation is waiting for the specified tape drive to become free.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[operator wait]</SAMP
></B
></SPAN
></DT
><DD
><P
>The Tape Coordinator is waiting for the backup operator to insert a tape in the drive.</P
></DD
></DL
></DIV
></P
></DD
></DL
></DIV
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ290"
>To cancel operations in interactive mode</A
></H2
><OL
TYPE="1"
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
> command at the <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt,
          to learn the job ID number of the operation you want to cancel. For details, see <A
HREF="c15383.html#HDRWQ289"
>To display
          pending or running jobs in interactive mode</A
>. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command to cancel the operation. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>job ID or dump set name</I
></SPAN
>&#62;
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>k</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>kill</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>job ID or dump set name</B
></SPAN
></DT
><DD
><P
>Specifies either the job ID number of the operation to cancel, as reported by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>jobs</B
></SPAN
> command, or for a dump operation only, the dump name in the format
                  volume_set_name.dump_level_name.</P
></DD
></DL
></DIV
></P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ291"
>Starting and Stopping the Tape Coordinator Process</A
></H2
><P
>Before performing a backup operation that reads from or writes to a tape device or backup data file, you must start the
      Tape Coordinator (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
>) process that handles the drive or file. This section explains how to
      start, stop, and check the status of a Tape Coordinator process. To use these instructions, you must have already configured
      the Tape Coordinator machine and created a Tape Coordinator entry in the Backup Database, as instructed in <A
HREF="c12776.html#HDRWQ261"
>Configuring Tape Coordinator Machines and Tape Devices</A
>.</P
><P
>The Tape Coordinator assigns a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>task ID number</I
></SPAN
> to each operation it performs. The number is distinct
      from the job ID number assigned by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter in interactive mode (which
      is discussed in <A
HREF="c15383.html#HDRWQ288"
>Using Interactive and Regular Command Mode</A
>). The Tape Coordinator reports the
      task ID number in its onscreen trace and in the messages that it writes to its log and error files. To view the task ID
      numbers of a Tape Coordinator's running or pending operations, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup status</B
></SPAN
>
      command.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ292"
>To start a Tape Coordinator process</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file of the cell in which the Tape Coordinator is to access volume data and the Backup Database. If necessary, issue the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display
          the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
><P
>Alternately, you can log into a file server machine as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> in
          Step <A
HREF="c15383.html#LIWQ293"
>3</A
>.</P
></LI
><LI
><P
>Verify that you can write to the Tape Coordinator's log and error files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
> directory (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name files). If the log and error files do not already exist, you must be able to insert
          and write to files in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
> directory.</P
></LI
><LI
><P
><A
NAME="LIWQ293"
></A
>Open a connection (using a command such as <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>telnet</B
></SPAN
> or
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rlogin</B
></SPAN
>) to the Tape Coordinator machine that drives the tape device, or whose local disk
          houses the backup data file. The Tape Coordinator uses a devoted connection or window that must remain open for the Tape
          Coordinator to accept requests and while it is executing them.</P
><P
>If you plan to include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> flag to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command in the next step, log in as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
>.</P
></LI
><LI
><P
><A
NAME="LIWQ294"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command to start the Tape Coordinator. You
          can include either, but not both, of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> options, as discussed in <A
HREF="c15383.html#HDRWQ287"
>Performing Backup Operations as the Local
          Superuser Root or in a Foreign Cell</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-debuglevel</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>trace level</I
></SPAN
>&#62;]  \
          [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>cellname</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
>]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
></DT
><DD
><P
>Must be typed in full.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>port offset</B
></SPAN
></DT
><DD
><P
>Specifies the Tape Coordinator's port offset number. You must provide this argument unless the default value
                  of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
> (zero) is appropriate.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-debuglevel</B
></SPAN
></DT
><DD
><P
>Specifies the type of trace messages that the Tape Coordinator writes to the standard output stream
                  (stdout). Provide one of the following three values, or omit this argument to display the default type of messages
                  (equivalent to setting a value of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
> [zero]): <UL
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
>: The Tape Coordinator generates only the minimum number of messages
                        necessary to communicate with the backup operator, including prompts for insertion of additional tapes and
                        messages that indicate errors or the beginning or completion of operations.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>1</B
></SPAN
>: In addition to the messages displayed at level <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
>, the Tape Coordinator displays the name of each volume being dumped or
                        restored.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>2</B
></SPAN
>: In addition to the messages displayed at levels <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>1</B
></SPAN
>, the Tape Coordinator displays all of the
                        messages it is also writing to its log file (<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup/TL_</B
></SPAN
>device_name).</P
></LI
></UL
></P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cellname</B
></SPAN
></DT
><DD
><P
>Names the cell in which to perform the backup operations (the cell where the relevant volumes reside and the
                  Backup Server process is running). If you omit this argument, the Tape Coordinator uses its home cell, as defined
                  in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/vice/etc/ThisCell</B
></SPAN
> file. Do not combine this argument with the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> flag.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
></DT
><DD
><P
>Disables the Tape Coordinator's prompt for the first tape it needs for each operation. For a description of
                  the advantages and consequences of including this flag, see <A
HREF="c12776.html#HDRWQ278"
>Eliminating the Search or
                  Prompt for the Initial Tape</A
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
></DT
><DD
><P
>Constructs a server ticket using a key from the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
>
                  file. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> process presents it to the Backup Server, Volume Server, and VL
                  Server during mutual authentication. You must be logged into a file server machine as the local superuser
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> to include this flag, and cannot combine it with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-cell</B
></SPAN
> argument.</P
></DD
></DL
></DIV
></P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="Header_331"
>To stop a Tape Coordinator process</A
></H2
><OL
TYPE="1"
><LI
><P
>Enter an interrupt signal such as &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Ctrl-c</B
></SPAN
>&#62; over the dedicated connection to
          the Tape Coordinator.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ295"
>To check the status of a Tape Coordinator process</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup status</B
></SPAN
> command. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup status</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>st</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>status</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TC port offset</B
></SPAN
></DT
><DD
><P
>Specifies the Tape Coordinator's port offset number. You must provide this argument unless the default value
                  of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
> (zero) is appropriate.</P
></DD
></DL
></DIV
></P
></LI
></OL
><P
>The following message indicates that the Tape Coordinator is not currently performing an operation:</P
><PRE
CLASS="programlisting"
>&#13;   Tape coordinator is idle
</PRE
><P
>Otherwise, the output includes a message of the following format for each running or pending operation:</P
><PRE
CLASS="programlisting"
>&#13;   Task task_ID:  operation:   status
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>task_ID</B
></SPAN
></DT
><DD
><P
>Is a task identification number assigned by the Tape Coordinator. It begins with the Tape Coordinator's port
              offset number.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>operation</B
></SPAN
></DT
><DD
><P
>Identifies the operation the Tape Coordinator is performing, which is initiated by the indicated command:
              <UL
><LI
><P
><SAMP
CLASS="computeroutput"
>Dump</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command)</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>Restore</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
>,
                    <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
>, or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
>
                    commands)</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>Labeltape</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
>
                    command)</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>Scantape</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
>
                    command)</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>SaveDb</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
>
                    command)</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>RestoreDb</SAMP
> (the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup restoredb</B
></SPAN
>
                    command)</P
></LI
></UL
></P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>status</B
></SPAN
></DT
><DD
><P
>Indicates the job's current status in one of the following messages. <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>number <SAMP
CLASS="computeroutput"
>Kbytes transferred, volume</SAMP
>
                    volume_name</B
></SPAN
></DT
><DD
><P
>For a running dump operation, indicates the number of kilobytes copied to tape or a backup data file so
                      far, and the volume currently being dumped.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>number <SAMP
CLASS="computeroutput"
>Kbytes, restore.volume</SAMP
></B
></SPAN
></DT
><DD
><P
>For a running restore operation, indicates the number of kilobytes copied into AFS from a tape or a
                      backup data file so far.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[abort requested]</SAMP
></B
></SPAN
></DT
><DD
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command was issued, but the termination signal has
                      yet to reach the Tape Coordinator.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[abort sent]</SAMP
></B
></SPAN
></DT
><DD
><P
>The operation is canceled by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command. Once the Backup
                      System removes an operation from the queue or stops it from running, it no longer appears at all in the output
                      from the command.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[butc contact lost]</SAMP
></B
></SPAN
></DT
><DD
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter cannot reach the Tape Coordinator. The
                      message can mean either that the Tape Coordinator handling the operation was terminated or failed while the
                      operation was running, or that the connection to the Tape Coordinator timed out.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[done]</SAMP
></B
></SPAN
></DT
><DD
><P
>The Tape Coordinator has finished the operation.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[drive wait]</SAMP
></B
></SPAN
></DT
><DD
><P
>The operation is waiting for the specified tape drive to become free.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>[operator wait]</SAMP
></B
></SPAN
></DT
><DD
><P
>The Tape Coordinator is waiting for the backup operator to insert a tape in the drive.</P
></DD
></DL
></DIV
></P
></DD
></DL
></DIV
></P
><P
>If the Tape Coordinator is communicating with an XBSA server (a third-party backup utility that implements the Open
      Group's Backup Service API [XBSA]), the following message appears last in the output:</P
><PRE
CLASS="programlisting"
>&#13;   XBSA_program Tape coordinator
</PRE
><P
>where XBSA_program is the name of the XBSA-compliant program.</P
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ296"
>Backing Up Data</A
></H1
><P
>This section explains how to use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command to back up AFS data to tape or
    to a backup data file. The instructions assume that you understand Backup System concepts and have already configured the Backup
    System according to the instructions in <A
HREF="c12776.html"
>Configuring the AFS Backup System</A
>. Specifically, you
    must already have: <UL
><LI
><P
>Decided whether to dump data to tape or to a backup data file, and configured the Tape Coordinator machine and Tape
          Coordinator process appropriately. See <A
HREF="c12776.html#HDRWQ261"
>Configuring Tape Coordinator Machines and Tape
          Devices</A
> and <A
HREF="c12776.html#HDRWQ282"
>Dumping Data to a Backup Data File</A
>.</P
></LI
><LI
><P
>Defined a volume set that includes the volumes you want to dump together. See <A
HREF="c12776.html#HDRWQ265"
>Defining and
          Displaying Volume Sets and Volume Entries</A
>.</P
></LI
><LI
><P
>Defined the dump level in the dump hierarchy at which you want to dump the volume set. If it is an incremental dump
          level, you must have previously created a dump at its parent level. See <A
HREF="c12776.html#HDRWQ267"
>Defining and Displaying
          the Dump Hierarchy</A
>.</P
></LI
><LI
><P
>Created a device configuration file. Such a file is required for each tape stacker, jukebox device, or backup data
          file. You can also use it to configure the Backup System's automation features. See <A
HREF="c12776.html#HDRWQ275"
>Automating
          and Increasing the Efficiency of the Backup Process</A
>.</P
></LI
></UL
></P
><P
>The most basic way to perform a dump operation is to create an initial dump of a single volume set as soon as the
    appropriate Tape Coordinator is available, by providing only the required arguments to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
    dump</B
></SPAN
> command. Instructions appear in <A
HREF="c15383.html#HDRWQ301"
>To create a dump</A
>. The command has several
    optional arguments that you can use to increase the efficiency and flexibility of your backup procedures: <UL
><LI
><P
>To append a dump to the end of a set of tapes that already contains other dumps, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
> argument. Otherwise, the Backup System creates an initial dump. Appending dumps enables you
          to use a tape's full capacity and has other potentially useful features. For a discussion, see <A
HREF="c15383.html#HDRWQ299"
>Appending Dumps to an Existing Dump Set</A
>.</P
></LI
><LI
><P
>To schedule one or more dump operations to run at a future time, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
>
          argument. For a discussion and instructions, see <A
HREF="c15383.html#HDRWQ300"
>Scheduling Dumps</A
>.</P
></LI
><LI
><P
>To initiate a number of dump operations with a single <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command, include
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument to name a file in which you have listed the commands. For a discussion
          and instructions, see <A
HREF="c15383.html#HDRWQ299"
>Appending Dumps to an Existing Dump Set</A
> and <A
HREF="c15383.html#HDRWQ300"
>Scheduling Dumps</A
>.</P
></LI
><LI
><P
>To generate a list of the volumes to be included in a dump, without actually dumping them, combine the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> flag with the other arguments to be used on the actual command.</P
></LI
></UL
></P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ297"
>Making Backup Operations More Efficient</A
></H2
><P
>There are several ways to make dump operations more efficient, less prone to error, and less disruptive to your users.
      Several of them also simplify the process of restoring data if that becomes necessary. <UL
><LI
><P
>It is best not to dump the read/write or read-only version of a volume, because no other users or processes can
            access a volume while it is being dumped. Instead, shortly before the dump operation begins, create a backup version of
            each volume to be dumped, and dump the backup version. Creating a Backup version usually makes the source volume
            unavailable for just a few moments (during which access attempts by other processes are blocked but do not fail). To
            automate the creation of backup volumes, you can create a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cron</B
></SPAN
> process in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/local/BosConfig</B
></SPAN
> file on one or more server machines, setting its start time at a
            sufficient interval before the dump operation is to begin. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
>
            argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backupsys</B
></SPAN
> command to
            enable it to run without administrative tokens. For instructions, see <A
HREF="c6449.html#HDRWQ162"
>To create and start a new
            process</A
>.</P
></LI
><LI
><P
>The volume set, dump level, and Tape Coordinator port offset you specify on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            dump</B
></SPAN
> command line must be properly defined in the Backup Database. The Backup System checks the database
            before beginning a dump operation and halts the command immediately if any of the required entities are missing. If
            necessary, use the indicated commands: <UL
><LI
><P
>To display volume sets, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup listvolsets</B
></SPAN
> command as described in
                  <A
HREF="c12776.html#HDRWQ266"
>To display volume sets and volume entries</A
>.</P
></LI
><LI
><P
>To display dump levels, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup listdumps</B
></SPAN
> command as described in
                  <A
HREF="c12776.html#HDRWQ271"
>To display the dump hierarchy</A
>.</P
></LI
><LI
><P
>To display port offsets, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup listhosts</B
></SPAN
> command as described in
                  <A
HREF="c12776.html#HDRWQ264"
>To display the list of configured Tape Coordinators</A
>.</P
></LI
></UL
></P
></LI
><LI
><P
>Ensure that a valid token corresponding to a privileged administrative identity is available to the Backup System
            processes both when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command is issued and when the dump operation
            actually runs (for a complete description or the necessary privileges, see <A
HREF="c12776.html#HDRWQ260"
>Granting
            Administrative Privilege to Backup Operators</A
>). This is a special concern for scheduled dumps. One alternative is
            to run <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands (or the script that invokes them) and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command on server machines, and to include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
>
            argument on the command. In this case, the processes use the key with the highest key version number in the local
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file to construct a token that never expires. Otherwise, you must
            use a method to renew tokens before they expire, or grant tokens with long lifetimes. In either case, you must protect
            against improper access to the tokens by securing the machines both physically and against unauthorized network access.
            The protection possibly needs to be even stronger than when a human operator is present during the operations.</P
></LI
><LI
><P
>Record tape capacity and filemark size values that are as accurate as possible in the Tape Coordinator's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup/tapeconfig</B
></SPAN
> file and on the tape's label. For suggested values and a description
            of what can happen when they are inaccurate, see <A
HREF="c12776.html#HDRWQ258"
>Configuring the tapeconfig File</A
>.</P
></LI
><LI
><P
>If an unattended dump requires multiple tapes, arrange to provide them by properly configuring a tape stacker or
            jukebox and writing a tape-mounting script to be invoked in the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file. For instructions, see <A
HREF="c12776.html#HDRWQ277"
>Invoking a Device's Tape
            Mounting and Unmounting Routines</A
>.</P
></LI
><LI
><P
>You can configure any tape device or backup data file's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file to
            take advantage of the Backup System's automation features. See <A
HREF="c12776.html#HDRWQ275"
>Automating and Increasing the
            Efficiency of the Backup Process</A
>.</P
></LI
><LI
><P
>When you issue a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command in regular (noninteractive) mode, the command
            shell prompt does not return until the operation completes. To avoid having to open additional connections, issue the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command in interactive mode, especially when including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument to schedule dump operations.</P
></LI
><LI
><P
>An incremental dump proceeds most smoothly if there is a dump created at the dump level immediately above the
            level you are using. If the Backup System does not find a Backup Database record for a dump created at the immediate
            parent level, it looks for a dump created at one level higher in the hierarchy, continuing up to the full dump level if
            necessary. It creates an incremental dump at the level one below the lowest valid parent dump that it finds, or even
            creates a full dump if that is necessary. This algorithm guarantees that the dump captures all data that has changed
            since the last dump, but has a couple of disadvantages. First, the Backup System's search through the database for a
            valid parent dump takes extra time. Second, the subsequent pattern of dumps can be confusing to a human operator who
            needs to restore data from them, because they were not performed at the expected dump levels.</P
><P
>The easiest way to guarantee that a dump exists at the immediate parent level is always to perform dump operations
            on the predetermined schedule. To check that the parent dump exists, you can issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            dumpinfo</B
></SPAN
> command (as described in <A
HREF="c15383.html#HDRWQ303"
>To display dump records</A
>) and search for it
            in the output. Alternatively, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
> command (as described in <A
HREF="c15383.html#HDRWQ304"
>To display a volume's dump history</A
>) for a volume that you believe is in the parent
            dump.</P
></LI
><LI
><P
>Always use dump levels from the same hierarchy (levels that are descendants of the same full level) when dumping a
            given volume set. The result of alternating between levels from different hierarchies can be confusing when you need to
            restore data or read dump records. It also increases the chance that changed data is not captured in any dump, or is
            backed up redundantly into more than one dump.</P
></LI
><LI
><P
>Use permanent tape names rather than AFS tape names. You can make permanent names more descriptive than is allowed
            by an AFS tape name's strict format, and also bypass the name-checking step that the Backup System performs by default
            when a tape has an AFS tape name only. You can also configure the Tape Coordinator always to skip the check, however;
            for instructions and a description of the acceptable format for AFS tape names, see <A
HREF="c12776.html#HDRWQ280"
>Eliminating
            the AFS Tape Name Check</A
>.</P
></LI
><LI
><P
>If you write dumps to tape, restore operations are simplest if all of your tape devices are compatible (can read
            the same type of tape, at the same compression ratios, and so on). If you must use incompatible devices, then at least
            use compatible devices for all dumps performed at dump levels that are at the same depth in their respective hierarchies
            (compatible devices for all dumps performed at a full dump level, compatible devices for all dumps performed at a level
            1 incremental dump level, and so on). The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> commands accepts
            multiple port offset numbers, but uses the first listed port offset when restoring all full dumps, the second port
            offset when restoring all level 1 dumps, and so on. If you did not use compatible tape devices when creating dumps at
            the same depth in a hierarchy, you must restore one volume at a time with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            volrestore</B
></SPAN
> command.</P
></LI
><LI
><P
>In some cases, it makes sense to use a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>temporary</I
></SPAN
> volume set, which exists only within the
            context of the interactive session in which it is created and for which no record is created in the Backup Database. One
            suitable situation is when dumping a volume to tape in preparation for removing it permanently (perhaps because its
            owner is leaving the cell). In this case, you can define a volume entry that includes only the volume of interest
            without cluttering up the Backup Database with a volume set record that you are using only once.</P
></LI
><LI
><P
>Do not perform a dump operation when you know that there are network, machine, or server process problems that can
            prevent the Backup System from accessing volumes or the Volume Location Database (VLDB). Although the Backup System
            automatically makes a number of repeated attempts to get to an inaccessible volume, the dump operation takes extra time
            and in some cases stops completely to prompt you for instructions on how to continue. Furthermore, if the Backup
            System's last access attempt fails and the volume is omitted from the dump, you must take extra steps to have it backed
            up (namely, the steps described just following for a halted dump operation). For a more complete description of how the
            Backup System makes repeated access attempts, see <A
HREF="c15383.html#HDRWQ298"
>How Your Configuration Choices Influence the
            Dump Process</A
>.</P
></LI
><LI
><P
>Review the logs created by the Backup System as soon as possible after a dump operation completes, particularly if
            it ran unattended. They name any volumes that were not successfully backed up, among other problems. The Backup Server
            writes to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BackupLog</B
></SPAN
> file on the local disk of the database server
            machine, and you can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos getlog</B
></SPAN
> command to read it remotely if you wish; for
            instructions, see <A
HREF="c6449.html#HDRWQ173"
>Displaying Server Process Log Files</A
>. The Tape Coordinator writes to
            two files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
> directory on the machine where it is running:
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name file records errors, and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name file records both trace and error messages.</P
></LI
><LI
><P
>Avoid halting a dump operation (for instance, by issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
>
            command in interactive mode), both because it introduces the potential for confusion and because recovering from the
            interruption requires extra effort. When a dump operation is interrupted, the volumes that were backed up before the
            halt signal is received are complete on the tape or in the backup data file, and are usable in restore operations. The
            records in the Backup Database about the volumes' dump history accurately show when and at which dump level they were
            backed up; to display the records, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
> command as described in <A
HREF="c15383.html#HDRWQ304"
>To display a volume's dump history</A
>.</P
><P
>However, there is no indication in the dump's Backup Database record that volumes were omitted; to display the
            record, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> command as described in <A
HREF="c15383.html#HDRWQ303"
>To
            display dump records</A
>. You must choose one of the following methods for dealing with the volumes that were not
            backed up before the dump operation halted. (Actually, you must make the same decision if the dump operation halts for
            reasons outside your control.) <UL
><LI
><P
>You can take no action, waiting until the next regularly scheduled dump operation to back them up. At that
                  time, the Backup System automatically dumps them at the appropriate level to guarantee that the dump captures all
                  of the data that changed since the volume was last dumped. However, you are gambling that restoring the volume is
                  not necessary before the next dump operation. If restoration is necessary, you can restore the volume only to its
                  state at the time it was last included in a dump--you have lost all changes made to the volume since that
                  time.</P
></LI
><LI
><P
>You can discard the entire dump and run the dump operation again. To discard the dump, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command to relabel the tapes or backup data file, which automatically
                  removes all associated records from the Backup Database. For instructions, see <A
HREF="c12776.html#HDRWQ272"
>Writing
                  and Reading Tape Labels</A
>. If a long time has passed since the backup version of the volumes was created,
                  some of the source volumes have possibly changed. If that seems likely, reissue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos
                  backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backupsys</B
></SPAN
> command on them before redoing the dump
                  operation.</P
></LI
><LI
><P
>You can create a new volume set that includes the missed volumes and dump it at a full dump level (even if
                  you specify an incremental dump level, the Backup System uses the full dump level at the top of your specified
                  level's hierarchy, because it has never before backed up these volumes as part of the new volume set). The next
                  time you dump the original volume set, the Backup System automatically dumps the missed volumes at the level one
                  below the level it used the last time it dumped the volumes as part of the original volume set.</P
></LI
></UL
></P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ298"
>How Your Configuration Choices Influence the Dump Process</A
></H2
><P
>This section provides an overview of the backup process, describing what happens at each stage both by default and as a
      result of your configuration choices, including the configuration instructions you include in the device-specific <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file. For the sake of clarity, it tracks the progress of a single <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command that creates an initial dump. For a discussion of the slight differences in the
      procedure when you append or schedule dumps, see <A
HREF="c15383.html#HDRWQ299"
>Appending Dumps to an Existing Dump Set</A
> or
      <A
HREF="c15383.html#HDRWQ300"
>Scheduling Dumps</A
>.</P
><P
>As a concrete example, the following description traces a dump of the volume set <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user</B
></SPAN
>
      at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/weekly/mon/tues/wed</B
></SPAN
> dump level. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user</B
></SPAN
> volume set
      has one volume entry that matches the backup version of all user volumes:</P
><PRE
CLASS="programlisting"
>&#13;        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.*    .*    user.*\.backup</B
></SPAN
>
      </PRE
><P
>The dump level belongs to the following dump hierarchy.</P
><PRE
CLASS="programlisting"
>&#13;   /weekly
          /mon
              /tues
                   /wed
                       /thurs
                             /fri
</PRE
><OL
TYPE="1"
><LI
><P
><A
NAME="LIBKOV-BUTC"
></A
>You issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command to start a Tape Coordinator
          to handle the dump operation. The Tape Coordinator does not have to be running when you issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command, but must be active in time to accept the list of volumes to be included in the
          dump, when Step <A
HREF="c15383.html#LIBKOV-VOLMATCHES"
>3</A
> is completed. To avoid coordination problems, it is best to
          start the Tape Coordinator before issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command.</P
><P
>As the Tape Coordinator initializes, it reads the entry in its local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup/tapeconfig</B
></SPAN
> file for the port offset you specify on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command line. The entry specifies the name of the device to use, and the Tape Coordinator
          verifies that it can access it. It also reads the device's configuration file, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup/CFG_</B
></SPAN
>device_name, if it exists. See Step <A
HREF="c15383.html#LIBKOV-READCFG"
>6</A
> for
          a description of how the instructions in the file influence the dump operation.</P
></LI
><LI
><P
>You issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command, specifying a volume set, dump level, and the
          same port offset number you specified on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command in Step <A
HREF="c15383.html#LIBKOV-BUTC"
>1</A
>. The Backup System verifies that they have correct Backup Database records and halts the
          operation with an error message if they do not.</P
><P
>If you issue the command in interactive mode, the Backup System assigns the operation a job ID number, which you can
          use to check the operation's status or halt it by using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) jobs</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command, respectively. For instructions, see <A
HREF="c15383.html#HDRWQ289"
>To display
          pending or running jobs in interactive mode</A
> and <A
HREF="c15383.html#HDRWQ290"
>To cancel operations in interactive
          mode</A
>.</P
></LI
><LI
><P
><A
NAME="LIBKOV-VOLMATCHES"
></A
>The Backup System works with the VL Server to generate a list of the volumes in the
          VLDB that match the name and location criteria defined in the volume set's volume entries. If a volume matches more than
          one volume entry, the Backup System ignores the duplicates so that the dump includes only one copy of data from the
          volume.</P
><P
>To reduce the number of times you need to switch tapes during a restore operation, the Backup System sorts the
          volumes by server machine and partition, and during the dump operation writes the data from all volumes stored on a
          specific partition before moving to the next partition.</P
><P
>As previously mentioned, it is best to back up backup volumes rather than read/write volumes, to avoid blocking
          users' access to data during the dump. To achieve this, you must explicitly include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> suffix on the volume names in volume entry definitions. For instructions, and to learn how
          to define volume entries that match multiple volumes, see <A
HREF="c12776.html#HDRWQ265"
>Defining and Displaying Volume Sets and
          Volume Entries</A
>.</P
><P
>In the example, suppose that 50 volumes match the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user</B
></SPAN
> volume set criteria,
          including three called <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.pat.backup</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.terry.backup</B
></SPAN
>, and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.smith.backup</B
></SPAN
>.</P
></LI
><LI
><P
><A
NAME="LIBKOV-CLONEDATE"
></A
>The Backup System next scans the dump hierarchy for the dump level you have
          specified on the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command line. If it is a full level, then in the current
          operation the Backup System backs up all of the data in all of the volumes in the list obtained in Step <A
HREF="c15383.html#LIBKOV-VOLMATCHES"
>3</A
>.</P
><P
>If the dump level is incremental, the Backup System reads each volume's dump history in the Backup Database to learn
          which of the parent levels in its pathname was used when the volume was most recently backed up as part of this volume
          set. In the usual case, it is the current dump level's immediate parent level.</P
><P
>An incremental dump of a volume includes only the data that changed since the volume was included in the parent
          dump. To determine which data are eligible, the Backup System uses the concept of a volume's <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>clone
          date</I
></SPAN
>. A read/write volume's clone date is when the Backup System locks the volume before copying its contents
          into a dump. A backup volume's clone date is the completion time of the operation that created it by cloning its
          read/write source volume (the operation initiated by a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backupsys</B
></SPAN
> command). A read-only volume's clone date is the time of the release operation
          (initiated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release</B
></SPAN
> command) that completed most recently before the dump
          operation.</P
><P
>More precisely then, an incremental dump includes only data that have a modification timestamp between the clone
          date of the volume included in the parent dump (the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>parent clone date</I
></SPAN
>) and the clone date of the
          volume to be included in the current dump (the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>current clone date</I
></SPAN
>).</P
><P
>There are some common exceptions to the general rule that a volume's parent dump is the dump created at the
          immediate parent level: <UL
><LI
><P
>The volume did not exist at all at the time of the last dump. In this case, the Backup System automatically
                does a full dump of it.</P
></LI
><LI
><P
>The volume did not match the volume set's name and location criteria at the time of the last dump. In this
                case, the Backup System automatically does a full dump of it, even if it was backed up recently (fully or
                incrementally) as part of another volume set. This redundancy is an argument for defining volume entries in terms of
                names rather than locations, particularly if you move volumes frequently.</P
></LI
><LI
><P
>The volume was not included in the dump at the immediate parent level for some reason (perhaps a process,
                machine, or network access prevented the Backup System from accessing it). In this case, the Backup System sets the
                clone date to the time of the last dump operation that included the volume. If the volume was not included in a dump
                performed at any of the levels in the current level's pathname, the Backup System does a full dump of it.</P
></LI
></UL
></P
><P
>In the example, the current dump level is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/weekly/mon/tues/wed</B
></SPAN
>. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.pat.backup</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.terry.backup</B
></SPAN
> volumes were included in the
          dump performed yesterday, Tuesday, at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/weekly/mon/tues</B
></SPAN
> level. The Backup System uses
          as their parent clone date 3:00 a.m. on Tuesday, which is when backup versions of them were created just before Tuesday's
          dump operation. However, Tuesday's dump did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.smith.backup</B
></SPAN
> volume for
          some reason. The last time it was included in a dump was Monday, at the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/weekly/mon</B
></SPAN
>
          level. The Backup System uses a parent clone date of Monday at 2:47 a.m., which is when a backup version of the volume was
          created just before the dump operation on Monday.</P
></LI
><LI
><P
>If performing an incremental dump, the Backup System works with the Volume Server to prepare a list of all of the
          files in each volume that have changed (have modification timestamps) between the parent clone date and the current clone
          date. The dump includes the complete contents of every such file. If a file has not changed, the dump includes only a
          placeholder stub for it. The dump also includes a copy of the complete directory structure in the volume, whether or not
          it has changed since the previous dump.</P
><P
>If none of the data in the volume has changed since the last dump, the Backup System omits the volume completely. It
          generates the following message in the Tape Coordinator window and log files:</P
><PRE
CLASS="programlisting"
>&#13;   Volume volume_name (volume_ID) not dumped - has not been modified 
      since last dump.
</PRE
></LI
><LI
><P
><A
NAME="LIBKOV-READCFG"
></A
>The Tape Coordinator prepares to back up the data. If there is a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file, the Tape Coordinator already read it in Step <A
HREF="c15383.html#LIBKOV-BUTC"
>1</A
>. The following list describes how the instructions in the file guide the Tape Coordinator's
          behavior at this point: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>FILE</B
></SPAN
></DT
><DD
><P
>If this instruction is set to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>YES</B
></SPAN
>, the Tape Coordinator writes data to a
                  backup data file. The device_name field in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tapeconfig</B
></SPAN
> file must also specify
                  a filename for the dump to work properly. For further discussion and instructions on configuring a backup data
                  file, see <A
HREF="c12776.html#HDRWQ282"
>Dumping Data to a Backup Data File</A
>.</P
><P
>If it is set to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NO</B
></SPAN
> or does not appear in the file, the Tape Coordinator
                  writes to a tape device.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT and UNMOUNT</B
></SPAN
></DT
><DD
><P
>If there is a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction in the file, each time the Tape Coordinator
                  needs a new tape, it invokes the indicated script or program to mount a tape in the device's tape drive. There
                  must be a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction if you want to utilize a tape stacker or jukebox's
                  ability to switch between tapes automatically. If there is no <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction,
                  the Tape Coordinator prompts the human operator whenever it needs a tape.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY</B
></SPAN
> instruction, which is described just following, modifies the
                  Tape Coordinator's tape acquisition procedure for the first tape it needs in a dump operation.</P
><P
>If there is an <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>UNMOUNT</B
></SPAN
> instruction, then the Tape Coordinator invokes the
                  indicated script or program whenever it closes the tape device. Not all tape devices have a separate tape
                  unmounting routine, in which case the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>UNMOUNT</B
></SPAN
> instruction is not necessary. For
                  more details on both instructions, see <A
HREF="c12776.html#HDRWQ277"
>Invoking a Device's Tape Mounting and Unmounting
                  Routines</A
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY</B
></SPAN
></DT
><DD
><P
>If this instruction is set to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NO</B
></SPAN
>, the Tape Coordinator assumes that the
                  first tape needed for the dump operation is already in the tape drive. It does not use its usual tape acquisition
                  procedure as described in the preceding discussion of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction. You
                  can achieve the same effect by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command.</P
><P
>If this instruction is absent or set to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>YES</B
></SPAN
>, the Tape Coordinator uses its
                  usual tape acquisition procedure even for the first tape. For more details, see <A
HREF="c12776.html#HDRWQ278"
>Eliminating the Search or Prompt for the Initial Tape</A
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>BUFFERSIZE</B
></SPAN
></DT
><DD
><P
>If this instruction appears in the file, the Tape Coordinator sets its buffer size to the specified value
                  rather than using the default buffer size of 16 KB. For further discussion, see <A
HREF="c12776.html#HDRWQ281"
>Setting
                  the Memory Buffer Size to Promote Tape Streaming</A
>.</P
></DD
></DL
></DIV
></P
><P
>If there is no <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file, the Tape Coordinator writes data to a tape
          device and prompts the human operator each time it needs a tape (the only exception being the first tape if you include
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command).</P
></LI
><LI
><P
><A
NAME="LIBKOV-NAMECHECK"
></A
>The Tape Coordinator opens either a tape drive or backup data file at this point, as
          directed by the instructions in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file (described in Step <A
HREF="c15383.html#LIBKOV-READCFG"
>6</A
>). The instructions also determine whether it invokes a mount script or prompts the
          operator. In Step <A
HREF="c15383.html#LIBKOV-BUTC"
>1</A
> the Tape Coordinator read in the device's capacity and filemark
          size from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tapeconfig</B
></SPAN
> file. It now reads the same values from the tape or backup data
          file's magnetic label, and overwrites the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tapeconfig</B
></SPAN
> values if there is a
          difference.</P
><P
>If creating an initial dump (as in the current example) and there is no permanent name on the label, the Tape
          Coordinator next checks that the AFS tape name has one of the three acceptable formats. If not, it rejects the tape and
          you must use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command to write an acceptable name. You can bypass
          this name-checking step by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NAME_CHECK NO</B
></SPAN
> instruction in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file. For discussion and a list of the acceptable AFS tape name values, see <A
HREF="c12776.html#HDRWQ280"
>Eliminating the AFS Tape Name Check</A
>.</P
></LI
><LI
><P
><A
NAME="LIBKOV-EXPDATE"
></A
>For an initial dump, the Tape Coordinator starts writing at the beginning of the tape
          or backup dump file, overwriting any existing data. To prevent inappropriate overwriting, the Backup System first checks
          the Backup Database for any dump records associated with the name (permanent or AFS tape name) on the tape or backup dump
          file's label. It refuses to write to a backup data file that has unexpired dumps in it, or to a tape that belongs to a
          dump set with any unexpired dumps. To recycle a file or tape before all dumps have expired, you must use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command to relabel it. Doing so removes the Backup Database records of all dumps
          in the file or on all tapes in the dump set, which makes it impossible to restore data from any of the tapes. For more
          information on expiration dates, see <A
HREF="c12776.html#HDRWQ270"
>Defining Expiration Dates</A
>.</P
><P
>The Tape Coordinator also checks for two other types of inappropriate tape reuse. The tape cannot already have data
          on it that belongs to the dump currently being performed, because that implies that the previous tape is still in the
          drive, or you have mistakenly reinserted it. The Tape Coordinator generates the following message and attempts to obtain
          another tape:</P
><PRE
CLASS="programlisting"
>&#13;   Can't overwrite tape containing the dump in progress
</PRE
><P
>The tape cannot contain data from a parent dump of the current (incremental) dump, because overwriting a parent dump
          makes it impossible to restore data from the current dump. The Tape Coordinator generates the following message and
          attempts to obtain another tape:</P
><PRE
CLASS="programlisting"
>&#13;   Can't overwrite the parent dump parent_name (parent_dump_ID)
</PRE
></LI
><LI
><P
><A
NAME="LIBKOV-WRITE"
></A
>The Tape Coordinator now writes data to the tape or backup data file. It uses the
          capacity and filemark size it obtained in Step <A
HREF="c15383.html#LIBKOV-NAMECHECK"
>7</A
> as it tracks how much more space
          is available, automatically using its tape acquisition procedure if the dump is not finished when it reaches the end of
          the tape. For a more detailed description, and a discussion of what happens if the Tape Coordinator reaches the physical
          end-of-tape unexpectedly, see <A
HREF="c12776.html#HDRWQ258"
>Configuring the tapeconfig File</A
>. Similarly, for instructions
          on configuring a backup data file to optimize recovery from unexpectedly running out of space, see Step <A
HREF="c12776.html#LITAPECONFIG-FILE"
>6</A
> in the instructions in <A
HREF="c12776.html#HDRWQ282"
>Dumping Data to a Backup Data
          File</A
>.</P
><P
>If the Tape Coordinator cannot access a volume during the dump (perhaps because of a server process, machine, or
          network outage), it skips the volume and continues dumping all volumes that it can access. It generates an error message
          in the Tape Coordinator window and log file about the omitted volume. It generates a similar message if it discovers that
          a backup volume has not been recloned since the previous dump operation (that is, that the volume's current clone date is
          the same as its parent clone date):</P
><PRE
CLASS="programlisting"
>&#13;   Volume volume_name (volume_ID) not dumped - has not been re-cloned 
       since last dump.
</PRE
><P
>After completing a first pass through all of the volumes, it attempts to dump each omitted volume again. It first
          checks to see if the reason that the volume was inaccessible during the first pass is that it has been moved since the VL
          Server generated the list of volumes to dump in Step <A
HREF="c15383.html#LIBKOV-VOLMATCHES"
>3</A
>. If so, it dumps the
          volume from its new site. If the second attempt to access a volume also fails, the Tape Coordinator it generates the
          following message, prompting you for instruction on how to proceed:</P
><PRE
CLASS="programlisting"
>&#13;   Dump of volume volume_name (volume_ID) failed
   Please select action to be taken for this volume.
      r - retry, try dumping this volume again
      o - omit, this volume from this dump
      a - abort, the entire dump
</PRE
><P
>To increase the automation of the dump process, you can include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ASK NO</B
></SPAN
>
          instruction in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file to suppress this prompt and have the Tape
          Coordinator automatically omit the volume from the dump.</P
><P
>If you are tracking the dump as it happens, the prompt enables you to take corrective action. If the volume has not
          been recloned, you can issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backup</B
></SPAN
> command. If the volume is inaccessible, you
          can investigate and attempt to resolve the cause.</P
></LI
><LI
><P
>If the tape or backup data file does not already have an AFS tape name, the Backup System constructs the appropriate
          one and records it on the label and in the Backup Database. It also assigns a dump name and ID number to the dump and
          records them in dump record that it creates in the Backup Database. For details on tape and dump names, see <A
HREF="c12776.html#HDRWQ253"
>Dump Names and Tape Names</A
>. For instructions on displaying dump records or a volume's dump
          history, or scanning the contents of a tape, see <A
HREF="c15383.html#HDRWQ302"
>Displaying Backup Dump Records</A
>.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ299"
>Appending Dumps to an Existing Dump Set</A
></H2
><P
>The AFS Backup System enables you to append dumps to the end of the final tape in a dump set by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
> flag to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command. Appending dumps improves
      Backup System automation and efficiency in several ways: <UL
><LI
><P
>It maximizes use of a tape's capacity. An initial dump must always start on a new tape, but does not necessarily
            extend to the end of the final tape in the dump set. You can fill up the unused tape by appending one or more
            dumps.</P
></LI
><LI
><P
>It can reduce the number of tapes and tape changes needed to complete a dump operation. Rather than performing a
            series of initial dumps first, instead begin with an initial dump and follow it immediately with several appended dumps.
            In this way you can write all dumps in the series to the same tape (assuming the tape is large enough to accommodate
            them all). If, in contrast, you perform all of the initial dumps first, each must begin on a new tape and you must
            switch tapes again if you then want to append dumps.</P
><P
>You can either issue the appropriate series of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> commands at the
            interactive <SAMP
CLASS="computeroutput"
>backup&#62;</SAMP
> prompt, or record them in a file that you then name with the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command. Appending
            dumps in this way enables you to run multiple unattended backup operations even without a tape stacker or jukebox, if
            all of the dumps fit on one tape.</P
></LI
><LI
><P
>It can reduce the number of tape changes during a restore operation. For example, if you append all of the
            incremental dumps of a volume set to tapes in one dump set, then restoring a volume from the volume set requires a
            minimum number of tape changes. It is best not to append incremental dumps to a tape that contains the parent full dump,
            however: if the tape is lost or damaged, you lose all of the data from the volume.</P
><P
>Although it can be efficient to group together appended dumps that are related, the Backup System does not require
            any relationship between the appended dumps on a tape or in a dump set.</P
></LI
></UL
></P
><P
>When writing an appended dump, the Backup System performs most of the steps described in <A
HREF="c15383.html#HDRWQ298"
>How
      Your Configuration Choices Influence the Dump Process</A
>. Appended dumps do not have to be related to one another or the
      initial dump, so it skips Step <A
HREF="c15383.html#LIBKOV-NAMECHECK"
>7</A
>: there is no need to check that the AFS tape name
      reflects the volume set and dump level names in this case. It also skips Step <A
HREF="c15383.html#LIBKOV-EXPDATE"
>8</A
>. Because
      it is not overwriting any existing data on the tape, it does not need to check the expiration dates of existing dumps on the
      tape or in the file. Then in Step <A
HREF="c15383.html#LIBKOV-WRITE"
>9</A
> the Tape Coordinator scans to the end of the last dump
      on the tape or in the backup data file before it begins writing data.</P
><P
>The Backup System imposes the following conditions on appended dumps: <UL
><LI
><P
>If writing to tape, the Tape Coordinator checks that it is the final one in a dump set for which there are
            complete and valid tape and dump records in the Backup Database. If not, it rejects the tape and requests an acceptable
            one. If you believe the tape has valid data on it, you can reconstruct the Backup Database dump records for it by using
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command as
            instructed in <A
HREF="c15383.html#HDRWQ305"
>To scan the contents of a tape</A
>.</P
></LI
><LI
><P
>The most recent dump on the tape or in the backup data file must have completed successfully.</P
></LI
><LI
><P
>The dump set to which the tape or file belongs must begin with an initial dump that is recorded in the Backup
            Database. If there are no dumps on the current tape, then the Backup System treats the dump operation as an initial dump
            and imposes the relevant requirements (for example, checks the AFS tape name if appropriate).</P
></LI
></UL
></P
><P
>As you append dumps, keep in mind that all of a dump set's dump and tape records in the Backup Database are indexed to
      the initial dump. If you want to delete an appended dump's record, you must delete the initial dump record, and doing so
      erases the records of all dumps in the dump set. Without those records, you cannot restore any of the data in the dump
      set.</P
><P
>Similarly, all of the dumps in a dump set must expire before you can recycle (write a new initial dump to) any of the
      tapes in a dump set. Do not append a dump if its expiration date is later than the date on which you want to recycle any of
      the tapes in its dump set. To recycle a tape before the last expiration date, you must delete the initial dump's record from
      the Backup Database. Either use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command to relabel the tape as
      instructed in <A
HREF="c12776.html#HDRWQ273"
>To label a tape</A
>, or use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
>
      command to delete the record directly as instructed in <A
HREF="c15383.html#HDRWQ322"
>To delete dump records from the Backup
      Database</A
>.</P
><P
>Although in theory you can append as many dumps as you wish, it generally makes sense to limit the number of tapes in a
      dump set (for example, to five), for these reasons: <UL
><LI
><P
>If an unreadable spot develops on one of the tapes in a dump set, it can prevent the Tape Coordinator from
            scanning the tape as part of a <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> operation you use to reconstruct Backup
            Database records. The Tape Coordinator can almost always scan the tape successfully up to the point of damage and can
            usually skip past minor damage. A scanning operation can start on any tape in a dump set, so damage on one tape does not
            prevent scanning of the others in the dump set. However, you can scan only the tapes that precede the damaged one in the
            dump set or the ones that follow the damaged one, but not both. (For more information on using tapes to reconstruct the
            information in the Backup Database, see <A
HREF="c15383.html#HDRWQ305"
>To scan the contents of a tape</A
>.)</P
><P
>An unreadable bad spot can also prevent you from restoring a volume completely, because restore operations must
            begin with the full dump and continue with each incremental dump in order. If you cannot restore a specific dump, you
            cannot restore any data from later incremental dumps.</P
></LI
><LI
><P
>If you decide in the future to archive one or more dumps, then you must archive the entire set of tapes that
            constitute the dump set, rather than just the ones that contain the data of interest. This wastes both tape and archive
            storage space. For more information on archiving, see <A
HREF="c12776.html#HDRWQ269"
>Archiving Tapes</A
>.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ300"
>Scheduling Dumps</A
></H2
><P
>By default, the Backup System starts executing a dump operation as soon as you enter the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
      dump</B
></SPAN
> command, and the Tape Coordinator begins writing data as soon as it is not busy and the list of files to write
      is available. You can, however, schedule a dump operation to begin at a specific later time: <UL
><LI
><P
>To schedule a single dump operation, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument to specify its
            start time.</P
></LI
><LI
><P
>To schedule multiple dump operations, list the operations in a file named by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument and use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument to specify when the
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter reads the file. If you omit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument, the command interpreter reads the file immediately, which does not count as
            scheduling, but does allow you to initiate multiple dump operations in a single command. Do not combine the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volumeset</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dump</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
>, or
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> options.</P
><P
>For file-formatting instructions, see the description of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument in
            Step <A
HREF="c15383.html#LIBKDUMP-SYNTAX"
>7</A
> of <A
HREF="c15383.html#HDRWQ301"
>To create a dump</A
>.</P
></LI
></UL
></P
><P
>The Backup System performs initial and appended dumps in the same manner whether they are scheduled or begin running as
      soon as you issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command. The only difference is that the requirements for
      successful execution hold both at the time you issue the command and when the Backup System actually begins running it. All
      required Backup Database entries for volume sets, dump levels, and port offsets, and all dump and tape records must exist at
      both times. Perhaps more importantly, the required administrative tokens must be available at both times. See <A
HREF="c15383.html#HDRWQ297"
>Making Backup Operations More Efficient</A
>.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ301"
>To create a dump</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>If the Tape Coordinator for the tape device that is to perform the operation is not already running, open a
          connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for
          which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape Coordinator process</A
>.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
></LI
><LI
><P
>If using a tape device, insert the tape.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Decide which volume set and dump level to use. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
          listvolsets</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup listdumps</B
></SPAN
> commands to display the existing volume sets
          and dump levels. For complete instructions and a description of the output, see <A
HREF="c12776.html#HDRWQ266"
>To display volume
          sets and volume entries</A
> and <A
HREF="c12776.html#HDRWQ271"
>To display the dump hierarchy</A
>. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>listvolsets</B
></SPAN
>  [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62;]
   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>listdumps</B
></SPAN
>
</PRE
></P
><P
>If you want to use a temporary volume set, you must create it during the current interactive session. This can be
          useful if you are dumping a volume to tape in preparation for removing it permanently (perhaps because its owner is
          leaving the cell). In this case, you can define a volume entry that includes only the volume of interest without
          cluttering up the Backup Database with a volume set record that you are using only once. Complete instructions appear in
          <A
HREF="c12776.html#HDRWQ265"
>Defining and Displaying Volume Sets and Volume Entries</A
>.</P
><PRE
CLASS="programlisting"
>&#13;   backup&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>addvolset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-temporary</B
></SPAN
>
   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>addvolentry  -name</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>partition name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volumes</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume name (regular expression)</I
></SPAN
>&#62;
</PRE
></LI
><LI
><P
>If you are creating an initial dump and writing to a tape or backup data file that does not have a permanent name,
          its AFS tape name must satisfy the Backup System's format requirements as described in <A
HREF="c12776.html#HDRWQ280"
>Eliminating the AFS Tape Name Check</A
>. If necessary, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
          readlabel</B
></SPAN
> command to display the label and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command to
          change the names, as instructed in <A
HREF="c12776.html#HDRWQ272"
>Writing and Reading Tape Labels</A
>. You must also relabel
          a tape if you want to overwrite it and it is part of a dump set that includes any unexpired dumps, though this is not
          recommended. For a discussion of the appropriate way to recycle tapes, see <A
HREF="c12776.html#HDRWQ268"
>Creating a Tape
          Recycling Schedule</A
>.</P
></LI
><LI
><P
><A
NAME="LIBKDUMP-SYNTAX"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command to dump the volume
          set. <UL
><LI
><P
>To create one initial dump, provide only the volume set name, dump level name, and port offset (if not
                zero).</P
></LI
><LI
><P
>To create one appended dump, add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
> flag.</P
></LI
><LI
><P
>To schedule a single initial or appended dump, add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument.</P
></LI
><LI
><P
>To initiate multiple dump operations, record the appropriate commands in a file and name it with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument. Do not combine this argument with options other than the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument.</P
></LI
></UL
></P
><PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dump</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62; &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dump level name</I
></SPAN
>&#62; [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]   \
                [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Date/time to start dump</I
></SPAN
>&#62;+]  \
                [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
>]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
>] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>load file</I
></SPAN
>&#62;]
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dump</B
></SPAN
></DT
><DD
><P
>Must be typed in full.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume set name</B
></SPAN
></DT
><DD
><P
>Names the volume set to dump.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dump level name</B
></SPAN
></DT
><DD
><P
>Specifies the complete pathname of the dump level at which to dump the volume set.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TC port offset</B
></SPAN
></DT
><DD
><P
>Specifies the port offset number of the Tape Coordinator process that is handling the operation. You must
                  provide this argument unless the default value of 0 (zero) is appropriate.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
></DT
><DD
><P
>Specifies the date and time in the future at which to run the command, or to read the file named by the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument. Provide a value in the format mm/dd/yyyy [hh:MM], where the month
                  (mm), day (dd), and year (yyyy) are required. Valid values for the year range from <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>1970</B
></SPAN
> to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>2037</B
></SPAN
>; higher values are not valid because the
                  latest possible date in the standard UNIX representation is in February 2038. The Backup System automatically
                  reduces any later date to the maximum value in 2038.</P
><P
>The hour and minutes (hh:MM) are optional, but if provided must be in 24-hour format (for example, the value
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>14:36</B
></SPAN
> represents 2:36 p.m.). If you omit them, the time defaults to midnight
                  (00:00 hours).</P
><P
>As an example, the value <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>04/23/1999 20:20</B
></SPAN
> schedules the command for 8:20
                  p.m. on 23 April 1999.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>A plus sign follows this argument in the command's syntax statement because it accepts a multiword value
                    which does not need to be enclosed in double quotes or other delimiters, not because it accepts multiple dates.
                    Provide only one date (and optionally, time) definition.</P
></BLOCKQUOTE
></DIV
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-append</B
></SPAN
></DT
><DD
><P
>Creates an appended dump by scanning to the end of the data from one or more previous dump operations that
                  it finds on the tape or in the backup data file.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
></DT
><DD
><P
>Displays the names of all volumes to be included in the indicated dump, without actually writing data to
                  tape or the backup data file. Combine this flag with the arguments you plan to use on the actual command, but not
                  with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
></DT
><DD
><P
>Specifies the local disk or AFS pathname of a file containing <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
                  commands. The Backup System reads the file immediately, or at the time specified by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument if it is provided. A partial pathname is interpreted relative to the current
                  working directory.</P
><P
>Place each <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command on its own line in the indicated file, using
                  the same syntax as for the command line, but without the word <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> at the start
                  of the line. Each command must include the volume set name and dump level name arguments plus the TC port offset
                  argument if the default value of zero is not appropriate. Commands in the file can also include any of the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command's optional arguments, including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-at</B
></SPAN
> argument (which must specify a date and time later than the date and time at which the
                  Backup System reads the file).</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>If you did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag when you issued the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, or if the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration
          file includes the instruction <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY YES</B
></SPAN
>, then the Tape Coordinator prompts you to
          place the tape in the device's drive. You have already done so, but you must now press &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62; to indicate that the tape is ready for labeling.</P
><P
>If more than one tape is required, you must either include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction in
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file and stock the corresponding stacker or jukebox with tapes, or
          remain at the console to respond to the Tape Coordinator's prompts for subsequent tapes.</P
></LI
><LI
><P
>After the dump operation completes, review the Backup System's log files to check for errors. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos getlog</B
></SPAN
> command as instructed in <A
HREF="c6449.html#HDRWQ173"
>Displaying Server Process Log
          Files</A
> to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BackupLog</B
></SPAN
> file, and a text editor on the Tape
          Coordinator machine to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
>
          directory.</P
><P
>It is also a good idea to record the tape name and dump ID number on the exterior label of each tape.</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ302"
>Displaying Backup Dump Records</A
></H1
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command suite includes three commands for displaying information about data
    you have backed up: <UL
><LI
><P
>To display information about one or more dump operations, such as the date it was performed and the number of
          volumes included, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> command as described in <A
HREF="c15383.html#HDRWQ303"
>To display dump records</A
>. You can display a detailed record of a single dump or more condensed
          records for a certain number of dumps, starting with the most recent and going back in time. You can specify the number of
          dumps or accept the default of 10.</P
></LI
><LI
><P
>To display a volume's dump history, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
> command as described in
          <A
HREF="c15383.html#HDRWQ304"
>To display a volume's dump history</A
>.</P
></LI
><LI
><P
>To display information extracted from a tape or backup data file about the volumes it includes, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command. To create new dump and tape records in the Backup Database derived from
          the tape and dump labels, add the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
> flag. For instructions, see <A
HREF="c15383.html#HDRWQ305"
>To scan the contents of a tape</A
>.</P
></LI
></UL
></P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ303"
>To display dump records</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> command to list information about dumps recorded in the
          Backup Database. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-ndumps</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>no. of dumps</I
></SPAN
>&#62;]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dump id</I
></SPAN
>&#62;]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
>]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dump</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dumpinfo</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-ndumps</B
></SPAN
></DT
><DD
><P
>Displays the Backup Database record for each of the specified number of dumps, starting with the most recent
                  and going back in time. If the database contains fewer dumps than are requested, the output includes the records
                  for all existing dumps. Do not combine this argument with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> argument or
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> flag; omit all three options to display the records for the last 10
                  dumps.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
></DT
><DD
><P
>Specifies the dump ID number of a single dump for which to display the Backup Database record. You must
                  include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> switch. Do not combine this option with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-ndumps</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> arguments; omit all three arguments to
                  display the records for the last 10 dumps.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
></DT
><DD
><P
>Provides more detailed information about the dump specified with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
>
                  argument, which must be provided along with it. Do not combine this flag with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-ndumps</B
></SPAN
> option.</P
></DD
></DL
></DIV
></P
></LI
></OL
><P
>If the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-ndumps</B
></SPAN
> argument is provided, the output presents the following information in
      table form, with a separate line for each dump: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>dumpid</SAMP
></B
></SPAN
></DT
><DD
><P
>The dump ID number.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>parentid</SAMP
></B
></SPAN
></DT
><DD
><P
>The dump ID number of the dump's parent dump. A value of <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero) identifies a
              full dump.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>lv</SAMP
></B
></SPAN
></DT
><DD
><P
>The depth in the dump hierarchy of the dump level used to create the dump. A value of
              <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero) identifies a full dump, in which case the value in the
              <SAMP
CLASS="computeroutput"
>parentid</SAMP
> field is also <SAMP
CLASS="computeroutput"
>0</SAMP
>. A value of
              <SAMP
CLASS="computeroutput"
>1</SAMP
> or greater indicates an incremental dump made at the corresponding level in the
              dump hierarchy.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>created</SAMP
></B
></SPAN
></DT
><DD
><P
>The date and time at which the Backup System started the dump operation that created the dump.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>nt</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of tapes that contain the data in the dump. A value of <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero)
              indicates that the dump operation was terminated or failed. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
>
              command to remove such entries.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>nvols</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of volumes from which the dump includes data. If a volume spans tapes, it is counted twice. A value
              of <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero) indicates that the dump operation was terminated or failed; the value in
              the <SAMP
CLASS="computeroutput"
>nt</SAMP
> field is also <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero) in this case.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>dump name</SAMP
></B
></SPAN
></DT
><DD
><P
>The dump name in the form <PRE
CLASS="programlisting"
>&#13;   volume_set_name.dump_level_name (initial_dump_ID)
</PRE
></P
><P
>where volume_set_name is the name of the volume set, and dump_level_name is the last element in the dump level
              pathname at which the volume set was dumped.</P
><P
>The initial_dump_ID, if displayed, is the dump ID of the initial dump in the dump set to which this dump
              belongs. If there is no value in parentheses, the dump is the initial dump in a dump set that has no appended
              dumps.</P
></DD
></DL
></DIV
></P
><P
>If the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> argument is provided alone, the first line of output begins with the string
      <SAMP
CLASS="computeroutput"
>Dump</SAMP
> and reports information for the entire dump in the following fields: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>id</SAMP
></B
></SPAN
></DT
><DD
><P
>The dump ID number.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>level</SAMP
></B
></SPAN
></DT
><DD
><P
>The depth in the dump hierarchy of the dump level used to create the dump. A value of
              <SAMP
CLASS="computeroutput"
>0</SAMP
> (zero) identifies a full dump. A value of <SAMP
CLASS="computeroutput"
>1</SAMP
> (one)
              or greater indicates an incremental dump made at the specified level in the dump hierarchy.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>volumes</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of volumes for which the dump includes data.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>created</SAMP
></B
></SPAN
></DT
><DD
><P
>The date and time at which the dump operation began.</P
></DD
></DL
></DIV
></P
><P
>If an XBSA server was the backup medium for the dump (rather than a tape device or backup data file), the following line
      appears next:</P
><PRE
CLASS="programlisting"
>&#13;   Backup Service: XBSA_program: Server: hostname
</PRE
><P
>where XBSA_program is the name of the XBSA-compliant program and hostname is the name of the machine on which the
      program runs.</P
><P
>Next the output includes an entry for each tape that houses volume data from the dump. Following the string
      <SAMP
CLASS="computeroutput"
>Tape</SAMP
>, the first two lines of each entry report information about that tape in the following
      fields: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>name</SAMP
></B
></SPAN
></DT
><DD
><P
>The tape's permanent name if it has one, or its AFS tape name otherwise, and its tape ID number in
              parentheses.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>nVolumes</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of volumes for which this tape includes dump data.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>created</SAMP
></B
></SPAN
></DT
><DD
><P
>The date and time at which the Tape Coordinator began writing data to this tape.</P
></DD
></DL
></DIV
></P
><P
>Following another blank line, the tape-specific information concludes with a table that includes a line for each volume
      dump on the tape. The information appears in columns with the following headings: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Pos</SAMP
></B
></SPAN
></DT
><DD
><P
>The relative position of each volume in this tape or file. On a tape, the counter begins at position 2 (the tape
              label occupies position 1), and increments by one for each volume. For volumes in a backup data file, the position
              numbers start with 1 and do not usually increment only by one, because each is the ordinal of the 16 KB offset in the
              file at which the volume's data begins. The difference between the position numbers therefore indicates how many 16 KB
              blocks each volume's data occupies. For example, if the second volume is at position 5 and the third volume in the
              list is at position 9, that means that the dump of the second volume occupies 64 KB (four 16-KB blocks) of space in
              the file.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Clone time</SAMP
></B
></SPAN
></DT
><DD
><P
>For a backup or read-only volume, the time at which it was cloned from its read/write source. For a Read/Write
              volume, it is the same as the dump creation date reported on the first line of the output.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Nbytes</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of bytes of data in the dump of the volume.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Volume</SAMP
></B
></SPAN
></DT
><DD
><P
>The volume name, complete with <SAMP
CLASS="computeroutput"
>.backup</SAMP
> or
              <SAMP
CLASS="computeroutput"
>.readonly</SAMP
> extension if appropriate.</P
></DD
></DL
></DIV
></P
><P
>If both the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
> options are provided, the
      output is divided into several sections: <UL
><LI
><P
>The first section, headed by the underlined string <SAMP
CLASS="computeroutput"
>Dump</SAMP
>, includes information
            about the entire dump. The fields labeled <SAMP
CLASS="computeroutput"
>id</SAMP
>, <SAMP
CLASS="computeroutput"
>level</SAMP
>,
            <SAMP
CLASS="computeroutput"
>created</SAMP
>, and <SAMP
CLASS="computeroutput"
>nVolumes</SAMP
> report the same values (though
            in a different order) as appear on the first line of output when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> argument is
            provided by itself. Other fields of potential interest to the backup operator are: <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Group id</SAMP
></B
></SPAN
></DT
><DD
><P
>The dump's <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>group ID number</I
></SPAN
>, which is recorded in the dump's Backup Database record if
                    the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>GROUPID</B
></SPAN
> instruction appears in the Tape Coordinator's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup/CFG_</B
></SPAN
>tcid file when the dump is created.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>maxTapes</SAMP
></B
></SPAN
></DT
><DD
><P
>The number of tapes that contain the dump set to which this dump belongs.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
><SAMP
CLASS="computeroutput"
>Start Tape Seq</SAMP
></B
></SPAN
></DT
><DD
><P
>The ordinal of the tape on which this dump begins in the set of tapes that contain the dump set.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>For each tape that contains data from this dump, there follows a section headed by the underlined string
            <SAMP
CLASS="computeroutput"
>Tape</SAMP
>. The fields labeled <SAMP
CLASS="computeroutput"
>name</SAMP
>,
            <SAMP
CLASS="computeroutput"
>written</SAMP
>, and <SAMP
CLASS="computeroutput"
>nVolumes</SAMP
> report the same values (though
            in a different order) as appear on the second and third lines of output when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
>
            argument is provided by itself. Other fields of potential interest to the backup operator are: <DIV
CLASS="variablelist"
><DL
><DT
><SAMP
CLASS="computeroutput"
>expires</SAMP
></DT
><DD
><P
>The date and time when this tape can be recycled, because all dumps it contains have expired.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>nMBytes Data</SAMP
> and <SAMP
CLASS="computeroutput"
>nBytes Data</SAMP
></DT
><DD
><P
>Summed together, these fields represent the total amount of dumped data actually from volumes (as opposed
                    to labels, filemarks, and other markers).</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>KBytes Tape Used</SAMP
></DT
><DD
><P
>The number of kilobytes of tape (or disk space, for a backup data file) used to store the dump data. It is
                    generally larger than the sum of the values in the <SAMP
CLASS="computeroutput"
>nMBytes Data</SAMP
> and
                    <SAMP
CLASS="computeroutput"
>nBytes Data</SAMP
> fields, because it includes the space required for the label, file
                    marks and other markers, and because the Backup System writes data at 16 KB offsets, even if the data in a given
                    block doesn't fill the entire 16 KB.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>For each volume on a given tape, there follows a section headed by the underlined string
            <SAMP
CLASS="computeroutput"
>Volume</SAMP
>. The fields labeled <SAMP
CLASS="computeroutput"
>name</SAMP
>,
            <SAMP
CLASS="computeroutput"
>position</SAMP
>, <SAMP
CLASS="computeroutput"
>clone</SAMP
>, and
            <SAMP
CLASS="computeroutput"
>nBytes</SAMP
> report the same values (though in a different order) as appear in the table that
            lists the volumes in each tape when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> argument is provided by itself. Other
            fields of potential interest to the backup operator are: <DIV
CLASS="variablelist"
><DL
><DT
><SAMP
CLASS="computeroutput"
>id</SAMP
></DT
><DD
><P
>The volume ID.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>tape</SAMP
></DT
><DD
><P
>The name of the tape containing this volume data.</P
></DD
></DL
></DIV
></P
></LI
></UL
></P
><P
>The following example command displays the Backup Database records for the five most recent dump operations.</P
><PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump 5</B
></SPAN
>
      dumpid   parentid lv created          nt nvols dump name
   924424000          0 0  04/18/1999 04:26  1    22 usr.sun (924424000)
   924685000  924424000 1  04/21/1999 04:56  1    62 usr.wed (924424000)
   924773000  924424000 1  04/22/1999 05:23  1    46 usr.thu (924424000)
   924860000  924424000 1  04/23/1999 05:33  1    58 usr.fri (924424000)
   925033000          0 0  04/25/1999 05:36  2    73 sys.week
</PRE
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ304"
>To display a volume's dump history</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
> command to display a volume's dump history.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume name</I
></SPAN
>&#62;
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>voli</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volinfo</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume name</B
></SPAN
></DT
><DD
><P
>Names the volume for which to display the dump history. If you dumped the backup or read-only version of the
                  volume, include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
>
                  extension.</P
></DD
></DL
></DIV
></P
></LI
></OL
><P
>The output includes a line for each Backup Database dump record that mentions the specified volume, order from most to
      least recent. The output for each record appears in a table with six columns: <DIV
CLASS="variablelist"
><DL
><DT
><SAMP
CLASS="computeroutput"
>dumpID</SAMP
></DT
><DD
><P
>The dump ID of the dump that includes the volume.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>lvl</SAMP
></DT
><DD
><P
>The depth in the dump hierarchy of the dump level at which the volume was dumped. A value of
              <SAMP
CLASS="computeroutput"
>0</SAMP
> indicates a full dump. A value of <SAMP
CLASS="computeroutput"
>1</SAMP
> or greater
              indicates an incremental dump made at the specified depth in the dump hierarchy.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>parentid</SAMP
></DT
><DD
><P
>The dump ID of the dump's parent dump. A value of <SAMP
CLASS="computeroutput"
>0</SAMP
> indicates a full dump,
              which has no parent; in this case, the value in the <SAMP
CLASS="computeroutput"
>lvl</SAMP
> column is also
              <SAMP
CLASS="computeroutput"
>0</SAMP
>.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>creation date</SAMP
></DT
><DD
><P
>The date and time at which the Backup System started the dump operation that created the dump.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>clone date</SAMP
></DT
><DD
><P
>For a backup or read-only volume, the time at which it was cloned from its read/write source. For a read/write
              volume, the same as the value in the <SAMP
CLASS="computeroutput"
>creation date</SAMP
> field.</P
></DD
><DT
><SAMP
CLASS="computeroutput"
>tape name</SAMP
></DT
><DD
><P
>The name of the tape containing the dump: either the permanent tape name, or an AFS tape name in the format
              <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume_set_name</I
></SPAN
>.<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dump_level_name</I
></SPAN
>.<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>tape_index</I
></SPAN
> where
              <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume_set_name</I
></SPAN
> is the name of the volume set associated with the initial dump in the dump set of
              which this tape is a part; <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dump_level_name</I
></SPAN
> is the name of the dump level at which the initial
              dump was backed up; <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>tape_index</I
></SPAN
> is the ordinal of the tape in the dump set. Either type of name
              can be followed by a dump ID in parentheses; if it appears, it is the dump ID of the initial dump in the dump set to
              which this appended dump belongs.</P
></DD
></DL
></DIV
></P
><P
>The following example shows part of the dump history of the backup volume <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>user.smith.backup</B
></SPAN
>:</P
><PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volinfo user.smith.backup</B
></SPAN
>
   DumpID    lvl parentID  creation   date  clone date       tape name
   924600000 1   924427600 04/20/1999 05:20 04/20/1999 05:01 user_incr_2 (924514392)
   924514392 1   924427600 04/19/1999 05:33 04/19/1999 05:08 user_incr_2 
   924427600 0           0 04/18/1999 05:26 04/18/1999 04:58 user_full_6 
       .     .      .         .       .       .      .         .
       .     .      .         .       .       .      .         .
</PRE
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ305"
>To scan the contents of a tape</A
></H2
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>The ability to scan a tape that is corrupted or damaged depends on the extent of the damage and what type of data is
        corrupted. The Backup System can almost always scan the tape successfully up to the point of damage. If the damage is minor,
        the Backup System can usually skip over it and scan the rest of the tape, but more major damage can prevent further
        scanning. A scanning operation does not have to begin with the first tape in a dump set, but the Backup System can process
        tapes only in sequential order after the initial tape provided. Therefore, damage on one tape does not prevent scanning of
        the others in the dump set, but it is possible to scan either the tapes that precede the damaged one or the ones that follow
        it, not both.</P
></BLOCKQUOTE
></DIV
><P
>If you use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
> flag to scan information into the Backup Database and the first
      tape you provide is not the first tape in the dump set, the following restrictions apply: <UL
><LI
><P
>If the first data on the tape is a continuation of a volume that begins on the previous (unscanned) tape in the
            dump set, the Backup System does not add a record for that volume to the Backup Database.</P
></LI
><LI
><P
>The Backup System must read the marker that indicates the start of an appended dump to add database records for
            the volumes in it. If the first volume on the tape belongs to an appended dump, but is not immediately preceded by the
            appended-dump marker, the Backup System does not create a Backup Database record for it or any subsequent volumes that
            belong to that appended dump.</P
></LI
></UL
> <OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
            file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>If the Tape Coordinator for the tape device that is to perform the operation is not already running, open a
            connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for
            which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape Coordinator process</A
>.
            <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
></LI
><LI
><P
>If scanning a tape, place it in the drive.</P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter
            interactive mode. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command to read the contents of the tape.
            <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>scantape</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
>] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sc</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>scantape</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
></DT
><DD
><P
>Constructs dump and tape records from the tape and dump labels in the dump and writes them into the Backup
                    Database.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TC port offset</B
></SPAN
></DT
><DD
><P
>Specifies the port offset number of the Tape Coordinator process that is handling the operation. You must
                    provide this argument unless the default value of 0 (zero) is appropriate.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>If you did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag when you issued the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, or the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration file
            includes the instruction <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY YES</B
></SPAN
> instruction, then the Tape Coordinator prompts
            you to place the tape in the device's drive. You have already done so, but you must now press &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62; to indicate that the tape is ready for reading.</P
></LI
></OL
></P
><P
>To terminate a tape scanning operation, use a termination signal such as &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Ctrl-c</B
></SPAN
>&#62;, or issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
> command in interactive mode. It
      is best not to interrupt the scan if you included the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
> argument. If the Backup System
      has already written new records into the Backup Database, then you must remove them before rerunning the scanning operation.
      If during the repeated scan operation the Backup System finds that a record it needs to create already exists, it halts the
      operation.</P
><P
>For each dump on the tape, the output in the Tape Coordinator window displays the dump label followed by an entry for
      each volume. There is no output in the command window. The dump label has the same fields as the tape label displayed by the
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup readlabel</B
></SPAN
> command, as described in <A
HREF="c12776.html#HDRWQ272"
>Writing and Reading Tape
      Labels</A
>. Or see the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
> for a detailed description of the fields in
      the output.</P
><P
>The following example shows the dump label and first volume entry on the tape in the device that has port offset
      2:</P
><PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape 2</B
></SPAN
>
   -- Dump label --
   tape name = monthly_guest
   AFS tape name = guests.monthly.3
   creationTime =  Mon Feb  1 04:06:40 1999
   cell = abc.com
   size = 2150000 Kbytes
   dump path = /monthly
   dump id = 917860000
   useCount = 44
   -- End of dump label --
   -- volume --
   volume name: user.guest10.backup
   volume ID 1937573829
   dumpSetName: guests.monthly
   dumpID 917860000
   level 0
   parentID 0
   endTime 0
   clonedate Mon Feb  1 03:03:23 1999
</PRE
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ306"
>Restoring and Recovering Data</A
></H1
><P
>The purpose of making backups is to enable you to recover when data becomes corrupted or is removed accidentally,
    returning the data to a coherent past state. The AFS Backup System provides three commands that restore varying numbers of
    volumes: <UL
><LI
><P
>To restore one or more volumes to a single site (partition on an AFS file server machine), use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
> command.</P
></LI
><LI
><P
>To restore one or more volumes that are defined as a volume set, each to a specified site, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> command.</P
></LI
><LI
><P
>To restore an entire partition (that is, all of the volumes that the VLDB lists as resident on it), use the
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> command.</P
></LI
></UL
></P
><P
>The commands are suited to different purposes because they vary in the combinations of features they offer and in the
    requirements they impose. To decide which is appropriate for a specific restore operation, see the subsequent sections of this
    introduction: <A
HREF="c15383.html#HDRWQ308"
>Using the backup volrestore Command</A
>, <A
HREF="c15383.html#HDRWQ310"
>Using the backup
    diskrestore Command</A
>, and <A
HREF="c15383.html#HDRWQ312"
>Using the backup volsetrestore Command</A
>.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ307"
>Making Restore Operations More Efficient</A
></H2
><P
>The following comments apply to all types of restore operation: <UL
><LI
><P
>The Backup System begins by restoring the most recent full dump of a volume. As it restores subsequent incremental
            dumps, it alters the data in the full dump appropriately, essentially repeating the volume's change history. The
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> commands
            always restore all incremental dumps, bringing a volume to its state at the time of the most recent incremental dump.
            You can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
> command to return a volume to its state at a
            specified time in the past, by not restoring the data from incremental dumps performed after that time.</P
></LI
><LI
><P
>The Backup System sets a restored volume's creation date to the date and time of the restore operation. The
            creation date appears in the <SAMP
CLASS="computeroutput"
>Creation</SAMP
> field of the output from the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos examine</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos listvol</B
></SPAN
> commands.</P
></LI
><LI
><P
>When identifying the volumes to restore, it is best to specify the base (read/write) name. In this case, the
            Backup System searches the Backup Database for the most recent dump set that includes data from either the read/write or
            backup version of the volume, and restores dumps of that volume starting with the most recent full dump. If you include
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
> extension on the volume name,
            the Backup System restores dumps of that version only. If it cannot find data dumped from that version, it does not
            perform the restoration even if another version was dumped.</P
></LI
><LI
><P
>All three restoration commands accept the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> option, which generates a list of
            the volumes to be restored and the tapes or backup data files that contain the necessary dumps, without actually
            restoring data to AFS server partitions. This enables you to gather together the tapes before beginning the restore
            operation, even preloading them into a stacker or jukebox if you are using one.</P
></LI
><LI
><P
>If you back up AFS data to tape, restoration is simplest if all of your tape devices are compatible, meaning that
            they can read the same type of tape, at the same compression ratios, and so on. (This suggestion also appears in <A
HREF="c15383.html#HDRWQ297"
>Making Backup Operations More Efficient</A
>, because by the time you need to restore data it is
            too late to implement it.) You can still restore multiple volumes with a single command even if data was backed up using
            incompatible devices, because the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> argument to all three restoration
            commands accepts multiple values. However, the Backup System uses the first port offset listed when restoring the full
            dump of each volume, the next port offset when restoring the level 1 incremental dump of each volume, and so on. If you
            did not use a compatible tape device when creating the full dump of every volume (and at each incremental level too),
            you cannot restore multiple volumes with a single command. You must use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            volrestore</B
></SPAN
> command to restore one volume at a time, or use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
            volsetrestore</B
></SPAN
> command after defining volume sets that group volumes according to the tape device used to dump
            them.</P
></LI
><LI
><P
>During a restore operation, the Backup System uses instructions in the relevant <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration file in much the same way as during a dump operation, as described
            in <A
HREF="c15383.html#HDRWQ298"
>How Your Configuration Choices Influence the Dump Process</A
>. It uses the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>UNMOUNT</B
></SPAN
>, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY</B
></SPAN
>,
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>BUFFERSIZE</B
></SPAN
>, and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>FILE</B
></SPAN
> instructions just as for a dump
            operation. A difference for the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>BUFFERSIZE</B
></SPAN
> instruction is that the default buffer size
            overridden by the instruction is 32 KB for restore operations rather than the 16 KB used for dump operations. The Backup
            System does not use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NAME_CHECK</B
></SPAN
> instruction at all during restore operations. The
            <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>ASK</B
></SPAN
> instruction controls whether the Backup System prompts you if it cannot restore a
            volume for any reason. If the setting is <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NO</B
></SPAN
>, it skips the problematic volume and
            restores as many of the other volumes as possible.</P
></LI
><LI
><P
>Do not perform a restore operation when you know that there are network, machine, or server process problems that
            can prevent the Backup System from accessing volumes or the VLDB. Although the Backup System automatically makes a
            number of repeated attempts to restore a volume, the restore operation takes extra time and in some cases stops
            completely to prompt you for instructions on how to continue.</P
></LI
><LI
><P
>Avoid halting a restore operation (for instance by issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) kill</B
></SPAN
>
            command in interactive mode). If a restore operation is interrupted for any reason, including causes outside your
            control, reissue the same restoration command as soon as is practical; if an outage or other problem caused the
            operation to halt, do not continue until the system returns to normal.</P
><P
>Any volume that is completely restored when the operation halts is online and usable, but very few volumes are
            likely to be in this state. When restoring multiple volumes at once, the Backup System restores the full dump of every
            volume before beginning the level 1 incremental restore for any of them, and so on, completing the restore of every
            volume at a specific incremental level before beginning to restore data from the next incremental level. Unless a volume
            was dumped at fewer incremental levels than others being restored as part of the same operation, it is unlikely to be
            complete.</P
><P
>It is even more dangerous to interrupt a restore operation if you are overwriting the current contents of the
            volume. Depending on how far the restore operation has progressed, it is possible that the volume is in such an
            inconsistent state that the Backup System removes it entirely. The data being restored is still available on tape or in
            the backup data file, but you must take extra steps to re-create the volume.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ308"
>Using the backup volrestore Command</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
> command is most appropriate when you need to restore a few
      volumes to a single site (partition on a file server machine). By default, it restores the volumes to their state at the time
      of the most recent dump operation (this is termed a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>full restore</I
></SPAN
>). You can also use the command to
      perform a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>date-specific restore</I
></SPAN
>, which restores only the dumps (full and incremental) performed before a
      specified date and time, leaving the volume in the state it was in at the time of the final relevant incremental dump. The
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> commands can
      only perform full restores.</P
><P
>You can restore data into a new copy of each volume rather than overwriting the current version, by including the
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> argument. After mounting the new volume in the filespace, you can compare the
      contents of the two and decide which to keep permanently.</P
><P
>The following list summarizes how to combine the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
> command's arguments
      to restore a volume in different ways: <UL
><LI
><P
>To perform a date-specific restore as described just previously, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-date</B
></SPAN
>
            argument to specify the date and optionally time. The Backup System restores the most recent full dump and each
            subsequent incremental dump for which the clone date of the volume included in the dump is before the indicated date and
            time (for a definition of the clone date, see Step <A
HREF="c15383.html#LIBKOV-CLONEDATE"
>4</A
> in <A
HREF="c15383.html#HDRWQ298"
>How Your Configuration Choices Influence the Dump Process</A
>). You can combine this argument with
            the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> argument to place the date-specific restore in a new volume.</P
></LI
><LI
><P
>To move a volume to a new site as you overwrite its contents with the restored data, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> arguments, singly or in combination, to
            specify the new site rather than the current site. The Backup System creates a new volume at that site, removes the
            existing volume, and updates the site information in the volume's VLDB entry. The volume's backup version is not removed
            automatically from the original site, if it exists. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos remove</B
></SPAN
> command to
            remove it and the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos backup</B
></SPAN
> command to create a backup version at the new site.</P
></LI
><LI
><P
>To create a new volume to house the restored data, rather than overwriting an existing volume, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> argument. The Backup System creates the new volume on the server and partition named
            by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> arguments, derives its
            name by adding the extension to the name specified with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volume</B
></SPAN
> argument, and
            creates a new VLDB entry for it. The command does not affect the existing volume in any way. However, if a volume with
            the specified extension also already exists, the command overwrites it. To make the contents of the new volume
            accessible, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount it. You can then compare its contents
            to those of the existing volume, to see which to retain permanently.</P
></LI
><LI
><P
>To restore a volume that no longer exists on an AFS server partition, but for which you have backed up data,
            specify the name of the new volume with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volume</B
></SPAN
> argument and use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> arguments to place it at the desired
            site. The Backup System creates a new volume and new VLDB entry.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ309"
>To restore volumes with the backup volrestore command</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>If the Tape Coordinator for the tape device that is to perform the operation is not already running, open a
          connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for
          which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape Coordinator process</A
>.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
><P
>Repeat the command for each Tape Coordinator if you are using more than one tape device.</P
></LI
><LI
><P
>If using a tape device, insert the tape.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volrestore</B
></SPAN
> command with the desired arguments. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volrestore</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>destination machine</I
></SPAN
>&#62; &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>destination partition</I
></SPAN
>&#62;  \ 
                      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volume</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume(s) to restore</I
></SPAN
>&#62;+  \
                      [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>new volume name extension</I
></SPAN
>&#62;]  \
                      [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-date</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>date from which to restore</I
></SPAN
>&#62;]  \
                      [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offsets</I
></SPAN
>&#62;+] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
>]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volr</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volrestore</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>destination machine</B
></SPAN
></DT
><DD
><P
>Names the file server machine on which to restore each volume. It does not have to be a volume's current
                  site.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>destination partition</B
></SPAN
></DT
><DD
><P
>Names the partition on which to restore each volume. It does not have to be a volume's current site.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volume</B
></SPAN
></DT
><DD
><P
>Names each volume to restore. It is best to provide the base (read/write) name, for the reasons discussed in
                  <A
HREF="c15383.html#HDRWQ307"
>Making Restore Operations More Efficient</A
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
></DT
><DD
><P
>Creates a new volume to house the restored data, with a name derived by appending the specified string to
                  each volume named by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volume</B
></SPAN
> extension. The Backup System preserves the
                  contents of the existing volume if it still exists. Do not use either of the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> extensions, which are reserved. The
                  combination of base volume name and extension cannot exceed 22 characters in length. If you want a period to
                  separate the extension from the name, specify it as the first character of the string (as in <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rst</B
></SPAN
>, for example).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-date</B
></SPAN
></DT
><DD
><P
>Specifies a date and optionally time; the restored volume includes data from dumps performed before the date
                  only. Provide a value in the format mm/dd/yyyy [hh:MM], where the required mm/dd/yyyy portion indicates the month
                  (mm), day (dd), and year (yyyy), and the optional hh:MM portion indicates the hour and minutes in 24-hour format
                  (for example, the value <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>14:36</B
></SPAN
> represents 2:36 p.m.). If omitted, the time
                  defaults to 59 seconds after midnight (00:00:59 hours).</P
><P
>Valid values for the year range from <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>1970</B
></SPAN
> to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>2037</B
></SPAN
>; higher values are not valid because the latest possible date in the standard UNIX
                  representation is in February 2038. The command interpreter automatically reduces any later date to the maximum
                  value.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>A plus sign follows this argument in the command's syntax statement because it accepts a multiword value
                    which does not need to be enclosed in double quotes or other delimiters, not because it accepts multiple dates.
                    Provide only one date (and optionally, time) definition.</P
></BLOCKQUOTE
></DIV
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
></DT
><DD
><P
>Specifies one or more port offset numbers, each corresponding to a Tape Coordinator to use in the operation.
                  If there is more than one value, the Backup System uses the first one when restoring the full dump of each volume,
                  the second one when restoring the level 1 incremental dump of each volume, and so on. It uses the final value in
                  the list when restoring dumps at the corresponding depth in the dump hierarchy and all dumps at lower
                  levels.</P
><P
>Provide this argument unless the default value of 0 (zero) is appropriate for all dumps. If 0 is just one of
                  the values in the list, provide it explicitly in the appropriate order.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
></DT
><DD
><P
>Displays the list of tapes that contain the dumps required by the restore operation, without actually
                  performing the operation.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>If you did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag when you issued the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, or the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration file
          includes the instruction <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY YES</B
></SPAN
>, then the Tape Coordinator prompts you to place
          the tape in the device's drive. You have already done so, but you must now press &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62; to indicate that the tape is ready for labeling.</P
><P
>If more than one tape is required, you must either include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction in
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file and stock the corresponding stacker or jukebox with tapes, or
          remain at the console to respond to the Tape Coordinator's prompts for subsequent tapes.</P
></LI
><LI
><P
>After the restore operation completes, review the Backup System's log files to check for errors. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos getlog</B
></SPAN
> command as instructed in <A
HREF="c6449.html#HDRWQ173"
>Displaying Server Process Log
          Files</A
> to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BackupLog</B
></SPAN
> file, and a text editor on the Tape
          Coordinator machine to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
>
          directory.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ310"
>Using the backup diskrestore Command</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> command is most appropriate when you need to restore all of the
      volumes on an AFS server partition, perhaps because a hardware failure has corrupted or destroyed all of the data. The command
      performs a full restore of all of the read/write volumes for which the VLDB lists the specified partition as the current site,
      using the dumps of either the read/write or backup version of each volume depending on which type was dumped more recently.
      (You can restore any backup or read-only volumes that resided on the partition by using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos
      backup</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos release</B
></SPAN
> commands after the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
      diskrestore</B
></SPAN
> operation is complete.)</P
><P
>By default, the Backup System restores the volumes to the site they previously occupied. To move the partition contents
      to a different site, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newserver</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newpartition</B
></SPAN
>
      arguments, singly or in combination.</P
><P
>By default, the Backup System overwrites the contents of existing volumes with the restored data. To create a new volume
      to house the restored data instead, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> argument. The Backup System creates
      the new volume at the site designated by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newserver</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newpartition</B
></SPAN
> arguments if they are used or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> arguments otherwise. It derives the volume name by adding the extension to the read/write
      base name listed in the VLDB, and creates a new VLDB entry. The command does not affect the existing volume in any way.
      However, if a volume with the specified extension also already exists, the command overwrites it.</P
><P
>If a partition seems damaged, be sure not to run the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos syncserv</B
></SPAN
> command before the
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> command. As noted, the Backup System restores volumes according to VLDB
      site definitions. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>vos syncserv</B
></SPAN
> command sometimes removes a volume's VLDB entry when the
      corruption on the partition is so severe that the Volume Server cannot confirm the volume's presence.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ311"
>To restore a partition with the backup diskrestore command</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>If the Tape Coordinator for the tape device that is to perform the operation is not already running, open a
          connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for
          which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape Coordinator process</A
>.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
><P
>Repeat the command for each Tape Coordinator if you are using more than one tape device.</P
></LI
><LI
><P
>If using a tape device, insert the tape.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup diskrestore</B
></SPAN
> command with the desired arguments. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>diskrestore</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine to restore</I
></SPAN
>&#62; &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>partition to restore</I
></SPAN
>&#62;  \
                       [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;+]  \
                       [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newserver</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>destination machine</I
></SPAN
>&#62;]  \
                       [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newpartition</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>destination partition</I
></SPAN
>&#62;]  \
                       [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>new volume name extension</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
>]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>di</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>diskrestore</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>machine to restore</B
></SPAN
></DT
><DD
><P
>Names the file server machine that the VLDB lists as the site of the volumes that need to be
                  restored.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>partition to restore</B
></SPAN
></DT
><DD
><P
>Names the partition that the VLDB lists as the site of the volumes that need to be restored.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
></DT
><DD
><P
>Specifies one or more port offset numbers, each corresponding to a Tape Coordinator to use in the operation.
                  If there is more than one value, the Backup System uses the first one when restoring the full dump of each volume,
                  the second one when restoring the level 1 incremental dump of each volume, and so on. It uses the final value in
                  the list when restoring dumps at the corresponding depth in the dump hierarchy and all dumps at lower
                  levels.</P
><P
>Provide this argument unless the default value of 0 (zero) is appropriate for all dumps. If 0 is just one of
                  the values in the list, provide it explicitly in the appropriate order.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newserver</B
></SPAN
></DT
><DD
><P
>Names an alternate file server machine to which to restore the volumes. If you omit this argument, the
                  volumes are restored to the file server machine named by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
>
                  argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-newpartition</B
></SPAN
></DT
><DD
><P
>Names an alternate partition to which to restore the data. If you omit this argument, the volumes are
                  restored to the partition named by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
></DT
><DD
><P
>Creates a new volume for each volume being restored, to house the restored data, appending the specified
                  string to the volume's read/write base name as listed in the VLDB. Any string other than <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> is acceptable, but the combination of
                  the base name and extension cannot exceed 22 characters in length. To use a period to separate the extension from
                  the name, specify it as the first character of the string (as in <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rst</B
></SPAN
>, for
                  example).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
></DT
><DD
><P
>Displays a list of the tapes necessary to perform the requested restore, without actually performing the
                  operation.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>If you did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag when you issued the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, or the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration file
          includes the instruction <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY YES</B
></SPAN
>, then the Tape Coordinator prompts you to place
          the tape in the device's drive. You have already done so, but you must now press &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62; to indicate that the tape is ready for labeling.</P
><P
>If more than one tape is required, you must either include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction in
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file and stock the corresponding stacker or jukebox with tapes, or
          remain at the console to respond to the Tape Coordinator's prompts for subsequent tapes.</P
></LI
><LI
><P
>After the restore operation completes, review the Backup System's log files to check for errors. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos getlog</B
></SPAN
> command as instructed in <A
HREF="c6449.html#HDRWQ173"
>Displaying Server Process Log
          Files</A
> to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BackupLog</B
></SPAN
> file, and a text editor on the Tape
          Coordinator machine to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
>
          directory.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ312"
>Using the backup volsetrestore Command</A
></H2
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> command is most appropriate when you need to perform a full
      restore of several read/write volumes, placing each at a specified site. You specify the volumes to restore either by naming a
      volume set with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> argument or by listing each volume's name and restoration site in a
      file named by the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument, as described in the following sections.</P
><P
>Because the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> command enables you to restore a large number of
      volumes with a single command, the restore operation can potentially take hours to complete. One way to reduce the time is to
      run multiple instances of the command simultaneously. Either use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> argument to
      specify disjoint volume sets for each command, or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument to name files that list
      different volumes. You must have several Tape Coordinators available to read the required tapes. Depending on how the volumes
      to be restored were dumped to tape, specifying disjoint volume sets can also reduce the number of tape changes
      required.</P
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ313"
>Restoring a Volume Set with the -name Argument</A
></H3
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> argument to restore a group of volumes defined in a volume set. The
        Backup System creates a list of the volumes in the VLDB that match the server, partition, and volume name criteria defined
        in the volume set's volume entries, and for which dumps are available. The volumes do not have to exist on the server
        partition as long as the VLDB still lists them (this can happen when, for instance, a hardware problem destroys the contents
        of an entire disk).</P
><P
>By default, the Backup System restores, as a read/write volume, each volume that matches the volume set criteria to
        the site listed in the VLDB. If a volume of the matching name exists at that site, its current contents are overwritten. You
        can instead create a new volume to house the restored data by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
>
        argument. The Backup System creates the new volume at the existing volume's site, derives its name by adding the extension
        to the existing volume's read/write base name, and creates a new VLDB entry for it. The command does not affect the existing
        volume in any way. However, if a volume with the specified extension also already exists, the command overwrites it. To make
        the contents of the new volume accessible, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount it. You can
        then compare its contents to those of the existing volume, to see which to retain permanently.</P
><P
>It is not required that the volume set was previously used to back up volumes (was used as the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volumeset</B
></SPAN
> option to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> command). It can be defined
        especially to match the volumes that need to be restored with this command, and that is usually the better choice. Indeed, a
        <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>temporary</I
></SPAN
> volume set, created by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-temporary</B
></SPAN
> flag to the
        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup addvolset</B
></SPAN
> command, can be especially useful in this context (instructions appear in
        <A
HREF="c12776.html#HDRWQ265"
>Defining and Displaying Volume Sets and Volume Entries</A
>). A temporary volume set is not added
        to the Backup Database and exists only during the current interactive backup session, which is suitable if the volume set is
        needed only to complete the single restore operation initialized by this command.</P
><P
>The reason that a specially defined volume set is probably better is that volume sets previously defined for use in
        dump operations usually match the backup version of volumes, whereas for a restore operation it is best to define volume
        entries that match the base (read/write) name. In this case, the Backup System searches the Backup Database for the newest
        dump set that includes a dump of either the read/write or the backup version of the volume. If, in contrast, a volume entry
        explicitly matches the volume's backup or read-only version, the Backup System uses dumps of that volume version only,
        restoring them to a read/write volume by stripping off the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
> extension.</P
><P
>If there are VLDB entries that match the volume set criteria, but for which there are no dumps recorded in the Backup
        Database, the Backup System cannot restore them. It generates an error message on the standard error stream for each
        one.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="HDRWQ314"
>Restoring Volumes Listed in a File with the -file Argument</A
></H3
><P
>Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument to specify the name and site of each read/write volume to
        restore. Each volume's entry must appear on its own (unbroken) line in the file, and comply with the following
        format:</P
><PRE
CLASS="programlisting"
>&#13;   machine    partition   volume    [comments...]
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>machine</B
></SPAN
></DT
><DD
><P
>Names the file server machine to which to restore the volume. You can move the volume as you restore it by
                naming a machine other than the current site.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>partition</B
></SPAN
></DT
><DD
><P
>Names the partition to which to restore the volume. You can move the volume as you restore it by naming a
                partition other than the current site.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume</B
></SPAN
></DT
><DD
><P
>Names the volume to restore. Specify the base (read/write) name to have the Backup System search the Backup
                Database for the newest dump set that includes a dump of either the read/write or the backup version of the volume.
                It restores the dumps of that version of the volume, starting with the most recent full dump. If, in contrast, you
                include the <SAMP
CLASS="computeroutput"
>.backup</SAMP
> or <SAMP
CLASS="computeroutput"
>.readonly</SAMP
> extension, the
                Backup System restores dumps of that volume version only, but into a read/write volume without the extension. The
                base name must match the name used in Backup Database dump records rather than in the VLDB, if they differ, because
                the Backup System does not consult the VLDB when you use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>comments...</B
></SPAN
></DT
><DD
><P
>Is any other text. The Backup System ignores any text on each line that appears after the volume name, so you
                can use this field for helpful notes.</P
></DD
></DL
></DIV
></P
><P
>Do not use wildcards (for example, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.*</B
></SPAN
>) in the machine, partition, or volume fields.
        It is acceptable for multiple lines in the file to name the same volume, but the Backup System processes only the first of
        them.</P
><P
>By default, the Backup System replaces the existing version of each volume with the restored data, placing the volume
        at the site specified in the machine and partition fields. You can instead create a new volume to house the restored
        contents by including the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> argument. The Backup System creates a new volume at
        the site named in the machine and partition fields, derives its name by adding the specified extension to the read/write
        version of the name in the volume field, and creates a new VLDB entry for it. The command does not affect the existing
        volume in any way. However, if a volume with the specified extension also already exists, the command overwrites it. To make
        the contents of the new volume accessible, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>fs mkmount</B
></SPAN
> command to mount it. You can
        then compare its contents to those of the existing volume, to see which to retain permanently.</P
><P
>If the file includes entries for volumes that have no dumps recorded in the Backup Database, the Backup System cannot
        restore them. It generates an error message on the standard error stream for each one.</P
><P
>One way to generate a file to use as input to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument is to issue the
        command with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> options and direct the
        output to a file. The output includes a line like the following for each volume (shown here on two lines only for legibility
        reasons); the value comes from the source indicated in the following list:</P
><PRE
CLASS="programlisting"
>&#13;   machine   partition   volume_dumped  # as   volume_restored;    \
         tape_name   (tape_ID);   pos   position_number;   date
</PRE
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>machine</B
></SPAN
></DT
><DD
><P
>Names the file server machine that currently houses the volume, as listed in the VLDB.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>partition</B
></SPAN
></DT
><DD
><P
>Names the partition that currently houses the volume, as listed in the VLDB.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume_dumped</B
></SPAN
></DT
><DD
><P
>Specifies the version (read/write or backup) of the volume that was dumped, as listed in the Backup
                Database.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volume_restored</B
></SPAN
></DT
><DD
><P
>Specifies the name under which the Backup System restores the volume when the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> flag is not included. If you include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
>
                argument with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
> options, then the
                extension appears on the name in this field (as in <SAMP
CLASS="computeroutput"
>user.pat.rst</SAMP
>, for
                example).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tape_name</B
></SPAN
></DT
><DD
><P
>Names the tape containing the dump of the volume, from the Backup Database. If the tape has a permanent name,
                it appears here; otherwise, it is the AFS tape name.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tape_ID</B
></SPAN
></DT
><DD
><P
>The tape ID of the tape containing the dump of the volume, from the Backup Database.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>position_number</B
></SPAN
></DT
><DD
><P
>Specifies the dump's position on the tape (for example, <SAMP
CLASS="computeroutput"
>31</SAMP
> indicates that 30
                volume dumps precede the current one on the tape). If the dump was written to a backup data file, this number is the
                ordinal of the 16 KB-offset at which the volume's data begins.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>date</B
></SPAN
></DT
><DD
><P
>The date and time when the volume was dumped.</P
></DD
></DL
></DIV
></P
><P
>To make the entries suitable for use with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument, edit them as indicated:
        <UL
><LI
><P
>The Backup System uses only the first three fields on each line of the input file, and so ignores all the fields
              after the number sign (<SAMP
CLASS="computeroutput"
>#</SAMP
>). You can remove them if it makes it easier for you to read
              the file, but that is not necessary.</P
></LI
><LI
><P
>The volume_dumped (third) field of each line in the output file becomes the volume field in the input file. The
              Backup System restores data to read/write volumes only, so remove the <SAMP
CLASS="computeroutput"
>.backup</SAMP
> or
              <SAMP
CLASS="computeroutput"
>.readonly</SAMP
> extension if it appears on the name in the volume_dumped field.</P
></LI
><LI
><P
>The output file includes a line for every dump operation in which a specific volume was included (the full dump
              and any incremental dumps), but the Backup System only processes the first line in the input file that mentions a
              specific volume. You can remove the repeated lines if it makes the file easier for you to read.</P
></LI
><LI
><P
>The <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine</I
></SPAN
> and <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>partition</I
></SPAN
> fields on an output line designate the
              volume's current site. To move the volume to another location as you restore it, change the values.</P
></LI
></UL
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ315"
>To restore a group of volumes with the backup volsetrestore command</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>If the Tape Coordinator for the tape device that is to perform the operation is not already running, open a
          connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for
          which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape Coordinator process</A
>.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
><P
>Repeat the command for each Tape Coordinator if you are using more than one tape device.</P
></LI
><LI
><P
>If using a tape device, insert the tape.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> If appropriate, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup)
          addvolset</B
></SPAN
> command to create a new volume set expressly for this restore operation. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-temporary</B
></SPAN
> flag if you do not need to add the volume set to the Backup Database. Then issue one or
          more <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) addvolentry</B
></SPAN
> commands to create volume entries that include only the volumes
          to be restored. Complete instructions appear in <A
HREF="c12776.html#HDRWQ265"
>Defining and Displaying Volume Sets and Volume
          Entries</A
>. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>addvolset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62;  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-temporary</B
></SPAN
>]
   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>addvolentry  -name</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-server</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-partition</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>partition name</I
></SPAN
>&#62;  \
                        <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-volumes</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume name (regular expression)</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup volsetrestore</B
></SPAN
> command with the desired arguments. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>volsetrestore</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>volume set name</I
></SPAN
>&#62;]  \
                 [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>file name</I
></SPAN
>&#62;]  \
                 [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;+]  \
                 [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>new volume name extension</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
>] 
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
></DT
><DD
><P
>Names a volume set to restore. The Backup System restores all of the volumes listed in the VLDB that match
                  the volume set's volume entries, as described in <A
HREF="c15383.html#HDRWQ313"
>Restoring a Volume Set with the -name
                  Argument</A
>. Provide this argument or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument, but not
                  both.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
></DT
><DD
><P
>Specifies the full pathname of a file that lists one or more volumes and the site (file server machine and
                  partition) to which to restore each. The input file has the format described in <A
HREF="c15383.html#HDRWQ314"
>Restoring
                  Volumes Listed in a File with the -file Argument</A
>. Use either this argument or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> argument, but not both.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
></DT
><DD
><P
>Specifies one or more port offset numbers, each corresponding to a Tape Coordinator to use in the operation.
                  If there is more than one value, the Backup System uses the first one when restoring the full dump of each volume,
                  the second one when restoring the level 1 incremental dump of each volume, and so on. It uses the final value in
                  the list when restoring dumps at the corresponding depth in the dump hierarchy and all dumps at lower
                  levels.</P
><P
>Provide this argument unless the default value of 0 (zero) is appropriate for all dumps. If 0 is just one of
                  the values in the list, provide it explicitly in the appropriate order.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-extension</B
></SPAN
></DT
><DD
><P
>Creates a new volume for each volume being restored, to house the restored data, appending the specified
                  string to the volume's read/write base name as listed in the VLDB. Any string other than <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.readonly</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.backup</B
></SPAN
> is acceptable, but the combination of
                  the base name and extension cannot exceed 22 characters in length. To use a period to separate the extension from
                  the name, specify it as the first character of the string (as in <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>.rst</B
></SPAN
>, for
                  example).</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-n</B
></SPAN
></DT
><DD
><P
>Displays a list of the volumes to be restored when the flag is not included, without actually restoring
                  them. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Output</B
></SPAN
> section of this reference page details the format of the output.
                  When combined with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-name</B
></SPAN
> argument, its output is easily edited for use as
                  input to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-file</B
></SPAN
> argument on a subsequent <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
                  volsetrestore</B
></SPAN
> command.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>If you did not include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
> flag when you issued the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, or the device's <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name configuration file
          includes the instruction <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>AUTOQUERY YES</B
></SPAN
>, then the Tape Coordinator prompts you to place
          the tape in the device's drive. You have already done so, but you must now press &#60;<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Return</B
></SPAN
>&#62; to indicate that the tape is ready for labeling.</P
><P
>If more than one tape is required, you must either include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>MOUNT</B
></SPAN
> instruction in
          the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>CFG_</B
></SPAN
>device_name file and stock the corresponding stacker or jukebox with tapes, or
          remain at the console to respond to the Tape Coordinator's prompts for subsequent tapes.</P
></LI
><LI
><P
>After the restore operation completes, review the Backup System's log files to check for errors. Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos getlog</B
></SPAN
> command as instructed in <A
HREF="c6449.html#HDRWQ173"
>Displaying Server Process Log
          Files</A
> to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/logs/BackupLog</B
></SPAN
> file, and a text editor on the Tape
          Coordinator machine to read the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TE_</B
></SPAN
>device_name and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>TL_</B
></SPAN
>device_name files in the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/backup</B
></SPAN
>
          directory.</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="HDRWQ316"
>Maintaining the Backup Database</A
></H1
><P
>The Backup Database stores all of the configuration and tracking information that the Backup System uses when dumping and
    restoring data. If a hardware failure or other problem on a database server machine corrupts or damages the database, it is
    relatively easy to recreate the configuration information (the dump hierarchy and lists of volume sets and Tape Coordinator port
    offset numbers). However, restoring the dump tracking information (dump records) is more complicated and time-consuming. To
    protect yourself against loss of data, back up the Backup Database itself to tape on a regular schedule.</P
><P
>Another potential concern is that the Backup Database can grow large rather quickly, because the Backup System keeps very
    detailed and cross-referenced records of dump operations. Backup operations become less efficient if the Backup Server has to
    navigate through a large number of obsolete records to find the data it needs. To keep the database to a manageable size, use
    the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
> command to delete obsolete records, as described in <A
HREF="c15383.html#HDRWQ321"
>Removing Obsolete Records from the Backup Database</A
>. If you later find that you have removed records
    that you still need, you can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command to read the information from the
    dump and tape labels on the corresponding tapes back into the database, as instructed in <A
HREF="c15383.html#HDRWQ305"
>To scan the
    contents of a tape</A
>.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ317"
>Backing Up and Restoring the Backup Database</A
></H2
><P
>Because of the importance of the information in the Backup Database, it is best to back it up to tape or other permanent
      media on a regular basis. As for the other AFS, administrative databases, the recommended method is to use a utility designed
      to back up a machine's local disk, such as the UNIX <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>tar</B
></SPAN
> command. For instructions, see <A
HREF="c3025.html#HDRWQ107"
>Backing Up and Restoring the Administrative Databases</A
>.</P
><P
>In the rare event that the Backup Database seems damaged or corrupted, you can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
      dbverify</B
></SPAN
> command to check its status. If it is corrupted, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
>
      command to repair some types of damage. Then use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup restoredb</B
></SPAN
> to return the corrected
      database to the local disks of the database server machines. For instructions, see <A
HREF="c15383.html#HDRWQ318"
>Checking for and
      Repairing Corruption in the Backup Database</A
>.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ318"
>Checking for and Repairing Corruption in the Backup Database</A
></H2
><P
>In rare cases, the Backup Database can become damaged or corrupted, perhaps because of disk or other hardware errors.
      Use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
> command to check the integrity of the database. If it is corrupted,
      the most efficient way to repair it is to use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command to copy the database
      to tape. The command automatically repairs several types of corruption, and you can then use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
      restoredb</B
></SPAN
> command to transfer the repaired copy of the database back to the local disks of the database server
      machines.</P
><P
>The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command also removes <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>orphan blocks</I
></SPAN
>, which are
      ranges of memory that the Backup Server preallocated in the database but cannot use. Orphan blocks do not interfere with
      database access, but do waste disk space. The <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
> command reports the existence
      of orphan blocks if you include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-detail</B
></SPAN
> flag.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ319"
>To verify the integrity of the Backup Database</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
> command to check the integrity of the Backup Database.
          <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-detail</B
></SPAN
>]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>db</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dbverify</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-detail</B
></SPAN
></DT
><DD
><P
>Reports the existence of orphan blocks and other information about the database, as described on the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dbverify</B
></SPAN
> reference page in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration
                  Reference</I
></SPAN
>.</P
></DD
></DL
></DIV
></P
><P
>The output reports one of the following messages: <UL
><LI
><P
><SAMP
CLASS="computeroutput"
>Database OK</SAMP
> indicates that the Backup Database is undamaged.</P
></LI
><LI
><P
><SAMP
CLASS="computeroutput"
>Database not OK</SAMP
> indicates that the Backup Database is damaged. To recover
                from the problem, use the instructions in <A
HREF="c15383.html#HDRWQ320"
>To repair corruption in the Backup
                Database</A
>.</P
></LI
></UL
></P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ320"
>To repair corruption in the Backup Database</A
></H2
><OL
TYPE="1"
><LI
><P
>Log in as the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> on each database server machine in the
          cell.</P
></LI
><LI
><P
><A
NAME="LISAVEDB-STARTTC"
></A
>If the Tape Coordinator for the tape device that is to perform the operation is not
          already running, open a connection to the appropriate Tape Coordinator machine and issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> command, for which complete instructions appear in <A
HREF="c15383.html#HDRWQ292"
>To start a Tape
          Coordinator process</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>butc</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port offset</I
></SPAN
>&#62;] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-noautoquery</B
></SPAN
>]
</PRE
></P
></LI
><LI
><P
>If writing to tape, place a tape in the appropriate device.</P
></LI
><LI
><P
>Working on one of the machines, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode.
          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup -localauth</B
></SPAN
>
</PRE
></P
><P
>where <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> constructs a server ticket from the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file. This flag enables you to issue a privileged command while logged in as
          the local superuser <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> but without AFS administrative tokens.</P
></LI
><LI
><P
>Verify that no backup operations are actively running. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup)
          status</B
></SPAN
> command as described in <A
HREF="c15383.html#HDRWQ295"
>To check the status of a Tape Coordinator
          process</A
>. Repeat for each Tape Coordinator port offset in turn. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>status -portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
><A
NAME="LISAVEDB-CMD"
></A
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) savedb</B
></SPAN
> command to repair corruption
          in the database as it is written to tape or a file. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>savedb</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>sa</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>savedb</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
></DT
><DD
><P
>Specifies the port offset number of the Tape Coordinator handling the tape or backup data file for this
                  operation. You must provide this argument unless the default value of 0 (zero) is appropriate.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
>Exit interactive mode. <PRE
CLASS="programlisting"
>&#13;   backup&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
>  
</PRE
></P
></LI
><LI
><P
>On each machine in turn, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos shutdown</B
></SPAN
> command to shut down the Backup
          Server process. Include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> flag because you are logged in as the local
          superuser root, but do not necessarily have administrative tokens. For complete command syntax, see <A
HREF="c6449.html#HDRWQ168"
>To stop processes temporarily</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bos shutdown</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver  -localauth  -wait</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>On each machine in turn, issue the following commands to remove the Backup Database. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>cd /usr/afs/db</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm bdb.DB0</B
></SPAN
>
   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>rm bdb.DBSYS1</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>On each machine in turn, starting with the machine with the lowest IP address, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos
          start</B
></SPAN
> command to restart the Backup Server process, which creates a zero-length copy of the Backup Database as
          it starts. For complete command syntax, see <A
HREF="c6449.html#HDRWQ166"
>To start processes by changing their status flags to
          Run</A
>. <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/bin/bos start</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>buserver  -localauth</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
>Working on one of the machines, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter interactive mode.
          <PRE
CLASS="programlisting"
>&#13;   # <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup -localauth</B
></SPAN
>
</PRE
></P
><P
>where <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-localauth</B
></SPAN
> constructs a server ticket from the local <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/KeyFile</B
></SPAN
> file.</P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) addhost</B
></SPAN
> command to create an entry in the new, empty database
          for the Tape Coordinator process handling the tape or file from which you are reading the repaired copy of the database
          (presumably the process you started in Step <A
HREF="c15383.html#LISAVEDB-STARTTC"
>2</A
> and which performed the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> operation in Step <A
HREF="c15383.html#LISAVEDB-CMD"
>6</A
>). For complete syntax, see
          Step <A
HREF="c12776.html#LICONFTC-ADDHOST"
>8</A
> in <A
HREF="c12776.html#HDRWQ262"
>To configure a Tape Coordinator machine</A
>.
          <PRE
CLASS="programlisting"
>&#13;   backup&#62;  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>addhost</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>tape machine name</I
></SPAN
>&#62; [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(backup) restoredb</B
></SPAN
> command to copy the repaired database to the database
          server machines. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>restoredb</B
></SPAN
>  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>TC port offset</I
></SPAN
>&#62;]
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>res</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>restoredb</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-portoffset</B
></SPAN
></DT
><DD
><P
>Specifies the port offset number of the Tape Coordinator handling the tape or backup data file for this
                  operation. You must provide this argument unless the default value of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>0</B
></SPAN
> (zero) is
                  appropriate.</P
></DD
></DL
></DIV
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Exit interactive mode if you do not plan to issue any additional
          <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> commands. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>quit</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> If desired, enter <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Ctrl-d</B
></SPAN
> or another
          interrupt signal to exit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>root</B
></SPAN
> shell on each database server machine. You can also
          issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>Ctrl-c</B
></SPAN
> signal on the Tape Coordinator machine to stop the process.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ321"
>Removing Obsolete Records from the Backup Database</A
></H2
><P
>Whenever you recycle or relabel a tape using the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dump</B
></SPAN
> or <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup labeltape</B
></SPAN
> command, the Backup System automatically removes all of the dump records for the dumps
      contained on the tape and all other tapes in the dump set. However, obsolete records can still accumulate in the Backup
      Database over time. For example, when you discard a backup tape after using it the maximum number of times recommended by the
      manufacturer, the records for dumps on it remain in the database. Similarly, the Backup System does not automatically remove a
      dump's record when the dump reaches its expiration date, but only if you then recycle or relabel the tape that contains the
      dump. Finally, if a backup operation halts in the middle, the records for any volumes successfully written to tape before the
      halt remain in the database.</P
><P
>A very large Backup Database can make backup operations less efficient because the Backup Server has to navigate through
      a large number of records to find the ones it needs. To remove obsolete records, use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup
      deletedump</B
></SPAN
> command. Either identify individual dumps by dump ID number, or specify the removal of all dumps created
      during a certain time period. Keep in mind that you cannot remove the record of an appended dump except by removing the record
      of its initial dump, which removes the records of all associated appended dumps. Removing records of a dump makes it
      impossible to restore data from the corresponding tapes or from any dump that refers to the deleted dump as its parent,
      directly or indirectly. That is, restore operations must begin with the full dump and continue with each incremental dump in
      order. If you have removed the records for a specific dump, you cannot restore any data from later incremental dumps.</P
><P
>Another way to truncate the Backup Database is to include the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-archive</B
></SPAN
> argument to the
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command. After a copy of the database is written to tape or to a backup data
      file, the Backup Server deletes the dump records for all dump operations with timestamps prior to the date and time you
      specify. However, issuing the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
> command with only the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
> argument is equivalent in effect and is simpler because it does not require starting a Tape
      Coordinator process as the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command does. For further information on the
      <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-archive</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup savedb</B
></SPAN
> command, see the
      command's reference page in the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>IBM AFS Administration Reference</I
></SPAN
>.</P
><P
>If you later need to access deleted dump records, and the corresponding tapes still exist, you can use the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dbadd</B
></SPAN
> argument to the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup scantape</B
></SPAN
> command to scan their contents
      into the database, as instructed in <A
HREF="c15383.html#HDRWQ305"
>To scan the contents of a tape</A
>.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="HDRWQ322"
>To delete dump records from the Backup Database</A
></H2
><OL
TYPE="1"
><LI
><P
>Verify that you are authenticated as a user listed in the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>/usr/afs/etc/UserList</B
></SPAN
>
          file. If necessary, issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> command, which is fully described in <A
HREF="c32432.html#HDRWQ593"
>To display the users in the UserList file</A
>. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>bos listusers</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>machine name</I
></SPAN
>&#62;
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command to enter
          interactive mode, if you want to delete multiple records or issue additional commands. The interactive prompt appears in
          the following step. <PRE
CLASS="programlisting"
>&#13;   % <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
>
</PRE
></P
></LI
><LI
><P
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>(Optional)</B
></SPAN
> Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> command to
          list information from the Backup Database that can help you decide which records to delete. For detailed instructions, see
          <A
HREF="c15383.html#HDRWQ303"
>To display dump records</A
>. <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dumpinfo</B
></SPAN
> [&#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>no. of dumps</I
></SPAN
>&#62;]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-id</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dump id</I
></SPAN
>&#62;]  [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-verbose</B
></SPAN
>]
</PRE
></P
></LI
><LI
><P
>Issue the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup deletedump</B
></SPAN
> command to delete one or more dump sets.
          <PRE
CLASS="programlisting"
>&#13;   backup&#62; <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>deletedump</B
></SPAN
> [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dumpid</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>dumpid</I
></SPAN
>&#62;+] [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>date time</I
></SPAN
>&#62;]  \
                      [<SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
> &#60;<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>date time</I
></SPAN
>&#62;] 
</PRE
></P
><P
>where <DIV
CLASS="variablelist"
><DL
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>dele</B
></SPAN
></DT
><DD
><P
>Is the shortest acceptable abbreviation of <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>deletedump</B
></SPAN
>.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dumpid</B
></SPAN
></DT
><DD
><P
>Specifies the dump ID of each initial dump to delete from the Backup Database. The records for all
                  associated appended dumps are also deleted. Provide either this argument or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
> (and optionally, <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
>) argument.</P
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
></DT
><DD
><P
>Specifies the beginning of a range of dates; the record for any dump created during the indicated period of
                  time is deleted.</P
><P
>To omit all records before the time indicated with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
> argument, omit
                  this argument. Otherwise provide a value in the following format</P
><P
>mm/dd/yyyy [hh:MM]</P
><P
>where the month (mm), day (dd), and year (yyyy) are required. You can omit the hour and minutes (hh:MM) to
                  indicate the default of midnight (00:00 hours). If you provide them, use 24-hour format (for example, the value
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>14:36</B
></SPAN
> represents 2:36 p.m.).</P
><P
>You must provide the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
> argument along with this one.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>A plus sign follows this argument in the command's syntax statement because it accepts a multiword value
                    which does not need to be enclosed in double quotes or other delimiters, not because it accepts multiple dates.
                    Provide only one date (and optionally, time) definition.</P
></BLOCKQUOTE
></DIV
></DD
><DT
><SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-to</B
></SPAN
></DT
><DD
><P
>Specifies the end of a range of dates; the record of any dump created during the range is deleted from the
                  Backup Database.</P
><P
>To delete all records created after the date you specify with the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
>
                  argument, specify the value <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NOW</B
></SPAN
>. To delete every dump record in the Backup
                  Database, provide the value <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>NOW</B
></SPAN
> and omit the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
> argument. Otherwise, provide a date value in the same format as described for the
                  <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
> argument. Valid values for the year (yyyy) range from <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>1970</B
></SPAN
> to <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>2037</B
></SPAN
>; higher values are not valid because the
                  latest possible date in the standard UNIX representation is in early 2038. The command interpreter automatically
                  reduces any later date to the maximum value in 2038.</P
><P
>If you omit the time portion (hh:MM), it defaults to 59 seconds after midnight (00:00:59 hours). Similarly,
                  the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup</B
></SPAN
> command interpreter automatically adds 59 seconds to any time value
                  you provide. In both cases, adding 59 seconds compensates for how the Backup Database and <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>backup dumpinfo</B
></SPAN
> command represent dump creation times in hours and minutes only. For
                  example, the Database records a creation timestamp of <SAMP
CLASS="computeroutput"
>20:55</SAMP
> for any dump
                  operation that begins between 20:55:00 and 20:55:59. Automatically adding 59 seconds to a time thus includes the
                  records for all dumps created during that minute.</P
><P
>Provide either this argument, or the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-dumpid</B
></SPAN
> argument. This argument is
                  required if the <SPAN
CLASS="bold"
><B
CLASS="emphasis"
>-from</B
></SPAN
> argument is provided.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>A plus sign follows this argument in the command's syntax statement because it accepts a multiword value
                    which does not need to be enclosed in double quotes or other delimiters, not because it accepts multiple dates.
                    Provide only one date (and optionally, time) definition.</P
></BLOCKQUOTE
></DIV
></DD
></DL
></DIV
></P
></LI
></OL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c12776.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c18360.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Configuring the AFS Backup System</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="p3023.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Monitoring and Auditing AFS Performance</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>