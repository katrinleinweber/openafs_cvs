<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>Administration Reference</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- /tmp/idwt3190/auarf000.scr converted by idb2h R4.2 (359) ID      -->
<!-- Workbench Version (AIX) on 5 Nov 1999 at 13:58:29                -->
<META HTTP-EQUIV="updated" CONTENT="Fri, 05 Nov 1999 13:58:29">
<META HTTP-EQUIV="review" CONTENT="Sun, 05 Nov 2000 13:58:29">
<META HTTP-EQUIV="expires" CONTENT="Mon, 05 Nov 2001 13:58:29">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    --> 
<BODY bgcolor="ffffff"> 
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>Administration Reference</H1>
<HR><P ALIGN="center"> <A HREF="../index.htm"><IMG SRC="../books.gif" BORDER="0" ALT="[Return to Library]"></A> <A HREF="auarf002.htm#ToC"><IMG SRC="../toc.gif" BORDER="0" ALT="[Contents]"></A> <A HREF="auarf058.htm"><IMG SRC="../prev.gif" BORDER="0" ALT="[Previous Topic]"></A> <A HREF="#Bot_Of_Page"><IMG SRC="../bot.gif" BORDER="0" ALT="[Bottom of Topic]"></A> <A HREF="auarf060.htm"><IMG SRC="../next.gif" BORDER="0" ALT="[Next Topic]"></A> <A HREF="auarf284.htm#HDRINDEX"><IMG SRC="../index.gif" BORDER="0" ALT="[Index]"></A> <P> 
<P>
<H2><A NAME="HDRAFSMONITOR" HREF="auarf002.htm#ToC_73">afsmonitor</A></H2>
<P><STRONG>Purpose</STRONG>
<P>Monitors File Servers and Cache Managers
<P><STRONG>Description</STRONG>
<PRE><B>afsmonitor</B> [<B>initcmd</B>]  [<B>-config</B> &lt;<VAR>configuration&nbsp;file</VAR>>]
           [<B>-frequency</B> &lt;<VAR>poll&nbsp;frequency,&nbsp;in&nbsp;seconds</VAR>>]
           [<B>-output</B> &lt;<VAR>storage&nbsp;file&nbsp;name</VAR>>]  [<B>-detailed</B>] 
           [<B>-debug</B> &lt;<VAR>turn&nbsp;debugging&nbsp;output&nbsp;on&nbsp;to&nbsp;the&nbsp;named&nbsp;file</VAR>>]
           [<B>-fshosts</B> &lt;<VAR>list&nbsp;of&nbsp;file&nbsp;servers&nbsp;to&nbsp;monitor</VAR>><SUP>+</SUP>]
           [<B>-cmhosts</B> &lt;<VAR>list&nbsp;of&nbsp;cache&nbsp;managers&nbsp;to&nbsp;monitor</VAR>><SUP>+</SUP>]
           [<B>-buffers</B> &lt;<VAR>number&nbsp;of&nbsp;buffer&nbsp;slots</VAR>>]  [<B>-help</B>]
   
<B>afsmonitor</B> [<B>i</B>]  [<B>-co</B> &lt;<VAR>configuration&nbsp;file</VAR>>]
           [<B>-fr</B> &lt;<VAR>poll&nbsp;frequency,&nbsp;in&nbsp;seconds</VAR>>]
           [<B>-o</B> &lt;<VAR>storage&nbsp;file&nbsp;name</VAR>>]  [<B>-det</B>]
           [<B>-deb</B> &lt;<VAR>turn&nbsp;debugging&nbsp;output&nbsp;on&nbsp;to&nbsp;the&nbsp;named&nbsp;file</VAR>>]
           [<B>-fs</B> &lt;<VAR>list&nbsp;of&nbsp;file&nbsp;servers&nbsp;to&nbsp;monitor</VAR>><SUP>+</SUP>]
           [<B>-cm</B> &lt;<VAR>list&nbsp;of&nbsp;cache&nbsp;managers&nbsp;to&nbsp;monitor</VAR>><SUP>+</SUP>]
           [<B>-b</B> &lt;<VAR>number&nbsp;of&nbsp;buffer&nbsp;slots</VAR>>]  [<B>-h</B>]
</PRE>
<P><STRONG>Description</STRONG>
<P>The <B>afsmonitor</B> command initializes a program that gathers and
displays statistics about specified File Server and Cache Manager
operations. It allows the issuer to monitor, from a single location, a
wide range of File Server and Cache Manager operations on any number of
machines in both local and foreign cells.
<P>There are 271 available File Server statistics and 570 available Cache
Manager statistics, listed in the appendix about <B>afsmonitor</B>
statistics in the <I>AFS Administration Guide</I>. By default, the
command displays all of the relevant statistics for the file server machines
named by the <B>-fshosts</B> argument and the client machines named by the
<B>-cmhosts</B> argument. To limit the display to only the
statistics of interest, list them in the configuration file specified by the
<B>-config</B> argument. In addition, use the configuration file
for the following purposes&#58;
<UL>
<P><LI>To set threshold values for any monitored statistic. When the value
of a statistic exceeds the threshold, the <B>afsmonitor</B> command
displays it in reverse video. There are no default threshold
values.
<P><LI>To invoke a program or script automatically when a statistic exceeds its
threshold. The AFS distribution does not include any such
scripts.
<P><LI>To list the file server and client machines to monitor, instead of using
the <B>-fshosts</B> and <B>-cmhosts</B> arguments.
</UL>
<P>For a description of the configuration file, see the <B>afsmonitor
Configuration File</B> reference page
<P><STRONG>Cautions</STRONG>
<P>The following software must be accessible to a machine where the
<B>afsmonitor</B> program is running&#58;
<UL>
<P><LI>The AFS <B>xstat</B> libraries, which the <B>afsmonitor</B>
program uses to gather data
<P><LI>The <B>curses</B> graphics package, which most UNIX distributions
provide as a standard utility
</UL>
<A NAME="IDX4198"></A>
<A NAME="IDX4199"></A>
<P>The <B>afsmonitor</B> screens format successfully both on so-called
dumb terminals and in windowing systems that emulate terminals. For the
output to looks its best, the display environment needs to support reverse
video and cursor addressing. Set the TERM environment variable to the
correct terminal type, or to a value that has characteristics similar to the
actual terminal type. The display window or terminal must be at least
80 columns wide and 12 lines long.
<A NAME="IDX4200"></A>
<A NAME="IDX4201"></A>
<A NAME="IDX4202"></A>
<P>The <B>afsmonitor</B> program must run in the foreground, and in its
own separate, dedicated window or terminal. The window or terminal is
unavailable for any other activity as long as the <B>afsmonitor</B>
program is running. Any number of instances of the
<B>afsmonitor</B> program can run on a single machine, as long as each
instance runs in its own dedicated window or terminal. Note that it can
take up to three minutes to start an additional instance.
<P><STRONG>Options</STRONG>
<DL>
<P><DT><B>initcmd
</B><DD>Accommodates the command&#39;s use of the AFS command parser, and is
optional.
<P><DT><B>-config
</B><DD>Names the configuration file which lists the machines to monitor,
statistics to display, and threshold values, if any. A partial pathname
is interpreted relative to the current working directory. Provide this
argument if not providing the <B>-fshosts</B> argument,
<B>-cmhosts</B> argument, or neither. For instructions on creating
this file, see the preceding <B>Description</B> section, and the section
on the <B>afsmonitor</B> program in the <I>AFS Administration
Guide</I>.
<P><DT><B>-frequency
</B><DD>Specifies in seconds how often the <B>afsmonitor</B> program probes
the File Servers and Cache Managers. Valid values range from
<B>1</B> to <B>86400</B> (which is 24 hours); the default value
is <B>60</B>. This frequency applies to both File Servers and Cache
Managers, but the <B>afsmonitor</B> program initiates the two types of
probes, and processes their results, separately. The actual interval
between probes to a host is the probe frequency plus the time required for all
hosts to respond.
<P><DT><B>-output
</B><DD>Names the file to which the <B>afsmonitor</B> program writes all of
the statistics that it collects. By default, no output file is
created. See the section on the <B>afsmonitor</B> command in the
<I>AFS Administration Guide</I> for information on this file.
<P><DT><B>-detailed
</B><DD>Formats the information in the output file named by <B>-output</B>
argument in a maximally readable format. Provide the <B>-output</B>
argument along with this one.
<P><DT><B>-fshosts
</B><DD>Names one or more machines from which to gather File Server
statistics. For each machine, provide either a fully qualified host
name, or an unambiguous abbreviation (the ability to resolve an abbreviation
depends on the state of the cell&#39;s name service at the time the command
is issued). This argument can be combined with the <B>-cmhosts</B>
argument, but not with the <B>-config</B> argument.
<P><DT><B>-cmhosts
</B><DD>Names one or more machines from which to gather Cache Manager
statistics. For each machine, provide either a fully qualified host
name, or an unambiguous abbreviation (the ability to resolve an abbreviation
depends on the state of the cell&#39;s name service at the time the command
is issued). This argument can be combined with the <B>-fshosts</B>
argument, but not with the <B>-config</B> argument.
<P><DT><B>-buffers
</B><DD>Is nonoperational and provided to accommodate potential future
enhancements to the program.
<P><DT><B>-help
</B><DD>Prints the online help for this command. All other valid options
are ignored.
</DL>
<P><STRONG>Output</STRONG>
<P>The <B>afsmonitor</B> program displays its data on three screens&#58;
<UL>
<P><LI><TT>System Overview</TT>&#58; This screen appears automatically when
the <B>afsmonitor</B> program initializes. It summarizes separately
for File Servers and Cache Managers the number of machines being monitored and
how many of them have <I>alerts</I> (statistics that have exceeded their
thresholds). It then lists the hostname and number of alerts for each
machine being monitored, indicating if appropriate that a process failed to
respond to the last probe.
<P><LI><TT>File Server</TT>&#58; This screen displays File Server statistics
for each file server machine being monitored. It highlights statistics
that have exceeded their thresholds, and identifies machines that failed to
respond to the last probe.
<P><LI><TT>Cache Managers</TT>&#58; This screen displays Cache Manager
statistics for each client machine being monitored. It highlights
statistics that have exceeded their thresholds, and identifies machines that
failed to respond to the last probe.
</UL>
<P>Fields at the corners of every screen display the following
information&#58;
<UL>
<P><LI>In the top left corner, the program name and version number.
<P><LI>In the top right corner, the screen name, current and total page numbers,
and current and total column numbers. The page number (for example,
<TT>p. 1 of 3</TT>) indicates the index of the current page and the
total number of (vertical) pages over which data is displayed. The
column number (for example, <TT>c. 1 of 235</TT>) indicates the index
of the current leftmost column and the total number of columns in which data
appears. (The symbol <TT>>>></TT> indicates that there is additional
data to the right; the symbol <TT>&lt;&lt;&lt;</TT> indicates that
there is additional data to the left.)
<P><LI>In the bottom left corner, a list of the available commands. Enter
the first letter in the command name to run that command. Only the
currently possible options appear; for example, if there is only one page
of data, the <TT>next</TT> and <TT>prev</TT> commands, which scroll the
screen up and down respectively, do not appear. For descriptions of the
commands, see the following section about navigating the display
screens.
<P><LI>In the bottom right corner, the <TT>probes</TT> field reports how many
times the program has probed File Servers (<TT>fs</TT>), Cache Managers
(<TT>cm</TT>), or both. The counts for File Servers and Cache
Managers can differ. The <TT>freq</TT> field reports how often the
program sends probes.
</UL>
<P><B>Navigating the afsmonitor Display Screens</B>
<P>As noted, the lower left hand corner of every display screen displays the
names of the commands currently available for moving to alternate screens,
which can either be a different type or display more statistics or machines of
the current type. To execute a command, press the lowercase version of
the first letter in its name. Some commands also have an uppercase
version that has a somewhat different effect, as indicated in the following
list.
<DL>
<P><DT><B><TT>cm</TT>
</B><DD>Switches to the <TT>Cache Managers</TT> screen. Available only on
the <TT>System Overview</TT> and <TT>File Servers</TT> screens.
<P><DT><B><TT>fs</TT>
</B><DD>Switches to the <TT>File Servers</TT> screen. Available only on
the <TT>System Overview</TT> and the <TT>Cache Managers</TT>
screens.
<P><DT><B><TT>left</TT>
</B><DD>Scrolls horizontally to the left, to access the data columns situated to
the left of the current set. Available when the <TT>&lt;&lt;&lt;</TT>
symbol appears at the top left of the screen. Press uppercase
<B>L</B> to scroll horizontally all the way to the left (to display the
first set of data columns).
<P><DT><B><TT>next</TT>
</B><DD>Scrolls down vertically to the next page of machine names.
Available when there are two or more pages of machines and the final page is
not currently displayed. Press uppercase <B>N</B> to scroll to the
final page.
<P><DT><B><TT>oview</TT>
</B><DD>Switches to the <TT>System Overview</TT> screen. Available only
on the <TT>Cache Managers</TT> and <TT>File Servers</TT> screens.
<P><DT><B><TT>prev</TT>
</B><DD>Scrolls up vertically to the previous page of machine names.
Available when there are two or more pages of machines and the first page is
not currently displayed. Press uppercase <B>N</B> to scroll to the
first page.
<P><DT><B><TT>right</TT>
</B><DD>Scrolls horizontally to the right, to access the data columns situated to
the right of the current set. This command is available when the
<TT>>>></TT> symbol appears at the upper right of the screen. Press
uppercase <B>R</B> to scroll horizontally all the way to the right (to
display the final set of data columns).
</DL>
<P><B>The System Overview Screen</B>
<P>The <TT>System Overview</TT> screen appears automatically as the
<B>afsmonitor</B> program initializes. This screen displays the
status of as many File Server and Cache Manager processes as can fit in the
current window; scroll down to access additional information.
<P>The information on this screen is split into File Server information on the
left and Cache Manager information on the right. The header for each
grouping reports two pieces of information&#58;
<UL>
<P><LI>The number of machines on which the program is monitoring the indicated
process
<P><LI>The number of alerts and the number of machines affected by them (an
<I>alert</I>means that a statistic has exceeded its threshold or a process
failed to respond to the last probe)
</UL>
<P>A list of the machines being monitored follows. If there are any
alerts on a machine, the number of them appears in square brackets to the left
of the hostname. If a process failed to respond to the last probe, the
letters <TT>PF</TT> (probe failure) appear in square brackets to the left of
the hostname.
<P><B>The File Servers Screen</B>
<P>The <TT>File Servers</TT> screen displays the values collected at the
most recent probe for File Server statistics.
<P>A summary line at the top of the screen (just below the standard program
version and screen title blocks) specifies the number of monitored File
Servers, the number of alerts, and the number of machines affected by the
alerts.
<P>The first column always displays the hostnames of the machines running the
monitored File Servers.
<P>To the right of the hostname column appear as many columns of statistics as
can fit within the current width of the display screen or window; each
column requires space for 10 characters. The name of the statistic
appears at the top of each column. If the File Server on a machine did
not respond to the most recent probe, a pair of dashes (<TT>--</TT>) appears
in each column. If a value exceeds its configured threshold, it is
highlighted in reverse video. If a value is too large to fit into the
allotted column width, it overflows into the next row in the same
column.
<P><B>The Cache Managers Screen</B>
<P>The <TT>Cache Managers</TT> screen displays the values collected at the
most recent probe for Cache Manager statistics.
<P>A summary line at the top of the screen (just below the standard program
version and screen title blocks) specifies the number of monitored Cache
Managers, the number of alerts, and the number of machines affected by the
alerts.
<P>The first column always displays the hostnames of the machines running the
monitored Cache Managers.
<P>To the right of the hostname column appear as many columns of statistics as
can fit within the current width of the display screen or window; each
column requires space for 10 characters. The name of the statistic
appears at the top of each column. If the Cache Manager on a machine
did not respond to the most recent probe, a pair of dashes (<TT>--</TT>)
appears in each column. If a value exceeds its configured threshold, it
is highlighted in reverse video. If a value is too large to fit into
the allotted column width, it overflows into the next row in the same
column.
<P><B>Writing to an Output File</B>
<P>Include the <B>-output</B> argument to name the file into which the
<B>afsmonitor</B> program writes all of the statistics it collects.
The output file can be useful for tracking performance over long periods of
time, and enables the administrator to apply post-processing techniques that
reveal system trends. The AFS distribution does not include any
post-processing programs.
<P>The output file is in ASCII format and records the same information as the
<TT>File Server</TT> and <TT>Cache Manager</TT> display screens.
Each line in the file uses the following format to record the time at which
the <B>afsmonitor</B> program gathered the indicated statistic from the
Cache Manager (<TT>CM</TT>) or File Server (<TT>FS</TT>) running on the
machine called <VAR>host_name</VAR>. If a probe failed, the error code
<TT>-1</TT> appears in the <VAR>statistic</VAR> field.
<PRE>   <VAR>time</VAR>  <VAR>host_name</VAR>  CM|FS   <VAR>statistic</VAR>
   
</PRE>
<P>If the administrator usually reviews the output file manually, rather than
using it as input to an automated analysis program or script, including the
<B>-detail</B> flag formats the data in a more easily readable
form.
<P><STRONG>Examples</STRONG>
<P>For examples of commands, display screens, and configuration files, see the
section about the <B>afsmonitor</B> program in the <I>AFS Administration
Guide</I>.
<P><STRONG>Privilege Required</STRONG>
<P>None
<P><STRONG>Related Information</STRONG>
<P><A HREF="auarf052.htm#HDRAFSMONCONFIG">afsmonitor Configuration File</A>
<P><A HREF="auarf169.htm#HDRFSTRACE_INTRO">fstrace</A>
<P><A HREF="auarf233.htm#HDRSCOUT">scout</A>
<P>
<HR><P ALIGN="center"> <A HREF="../index.htm"><IMG SRC="../books.gif" BORDER="0" ALT="[Return to Library]"></A> <A HREF="auarf002.htm#ToC"><IMG SRC="../toc.gif" BORDER="0" ALT="[Contents]"></A> <A HREF="auarf058.htm"><IMG SRC="../prev.gif" BORDER="0" ALT="[Previous Topic]"></A> <A HREF="#Top_Of_Page"><IMG SRC="../top.gif" BORDER="0" ALT="[Top of Topic]"></A> <A HREF="auarf060.htm"><IMG SRC="../next.gif" BORDER="0" ALT="[Next Topic]"></A> <A HREF="auarf284.htm#HDRINDEX"><IMG SRC="../index.gif" BORDER="0" ALT="[Index]"></A> <P> 
<!-- Begin Footer Records  ========================================== -->
<P><HR><B> 
<br>&#169; <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved 
</B> 
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
