# Copyright 2000, International Business Machines Corporation and others.
# All Rights Reserved.
# 
# This software has been released under the terms of the IBM Public
# License.  For details, see the LICENSE file in the top-level source
# directory or online at http://www.openafs.org/dl/license10.html

# make compiler warnings fatal

AFSDEV_AUXCDEFINES = $(AFSDEV_AUXCDEFINES) -WX

# since we're using rpcndr.h, we can't include <afs/stds.h>'s "hyper" type.

AFSDEV_AUXCDEFINES = $(AFSDEV_AUXCDEFINES) -DIGNORE_STDS_H

# allow the resource compiler to search the dest\include tree

AFSDEV_AUXRCFLAGS = $(AFSDEV_AUXRCFLAGS) -I$(DESTDIR)\include

# include the primary makefile

!INCLUDE ..\..\config\NTMakefile.$(SYS_NAME)
!INCLUDE ..\..\config\NTMakefile.version

############################################################################
#
# BUILD TARGETS
#

EXEFILE = $(DESTDIR)\root.server\usr\afs\bin\TaAfsAccountManager.exe

EXEOBJS = \
	$(OJT)\AfsUsrMgr_stub.res \
	$(OJT)\action.obj \
	$(OJT)\browse.obj \
	$(OJT)\cell_prop.obj \
	$(OJT)\cmdline.obj \
	$(OJT)\columns.obj \
	$(OJT)\command.obj \
	$(OJT)\creds.obj \
	$(OJT)\display.obj \
	$(OJT)\errdata.obj \
	$(OJT)\general.obj \
	$(OJT)\grp_col.obj \
	$(OJT)\grp_create.obj \
	$(OJT)\grp_delete.obj \
	$(OJT)\grp_prop.obj \
	$(OJT)\grp_rename.obj \
	$(OJT)\grp_tab.obj \
	$(OJT)\helpfunc.obj \
	$(OJT)\main.obj \
	$(OJT)\mch_col.obj \
	$(OJT)\mch_create.obj \
	$(OJT)\mch_delete.obj \
	$(OJT)\mch_tab.obj \
	$(OJT)\options.obj \
	$(OJT)\task.obj \
	$(OJT)\usr_col.obj \
	$(OJT)\usr_cpw.obj \
	$(OJT)\usr_create.obj \
	$(OJT)\usr_delete.obj \
	$(OJT)\usr_prop.obj \
	$(OJT)\usr_search.obj \
	$(OJT)\usr_tab.obj \
	$(OJT)\window.obj \
	$(OJT)\winlist.obj

VCLIBS =\
	comctl32.lib \
	shell32.lib

EXELIBS = \
	$(DESTDIR)\lib\afs\TaAfsAdmSvrClient.lib \
	$(DESTDIR)\lib\afs\TaAfsAppLib.lib

############################################################################

$(EXEFILE) : $(EXEOBJS) $(EXELIBS)
	$(EXEGUILINK) $(VCLIBS)
	$(EXEPREP) 

lang ::
	$(CD) lang
	for /f %l in ('dir /B ??_??') do @$(NTLANG) %l $(MAKECMD) /nologo /f NTMakefile install
	$(CD) ..

install : $(EXEFILE) lang

############################################################################
#
# Dependencies
#

$(OJT)\AfsUsrMgr_stub.res : AFS_component_version_number.h

mkdir:
	-mkdir $(OJT)\lang
	cd lang
	nmake /nologo /f ntmakefile SRC=$(SRC) OBJ=$(OBJ) mkdir
	cd ..
	
