# Copyright 2000, International Business Machines Corporation and others.
# All Rights Reserved.
# 
# This software has been released under the terms of the IBM Public
# License.  For details, see the LICENSE file in the top-level source
# directory or online at http://www.openafs.org/dl/license10.html

!INCLUDE ..\..\..\config\NTMakefile.$(SYS_NAME)
!INCLUDE ..\..\..\config\NTMakefile.version

############################################################################

CELLSERVDB = $(DESTDIR)\root.client\usr\vice\etc\afsdcell.ini

$(CELLSERVDB): afsdcell.ini
    copy $** $@

prep: $(CELLSERVDB) AFS_component_version_number.txt
    CreateISDirTree.bat
    ScatterFiles.bat
    CreateGeneratedFiles.bat
    CompileScript.bat

build:
    BuildSetup.bat
    xcopy/s/e/y "Media\Transarc AFS\Disk Images\disk1\*.*" $(DESTDIR)\WinInstall
    copy AFS_component_version_number.txt $(DESTDIR)\WinInstall\Version.txt
    $(DEL) /q "Media\Transarc AFS\Disk Images\disk1\*.*"
!IF ((EXIST("$(ISWEB)")) &&("$(ISWEB)"!=""))
!	IF (!EXIST($(DESTDIR)\Wininstall\PackageWeb))
		$(MKDIR) $(DESTDIR)\Wininstall\PackageWeb
!	ENDIF
	$(DEL) /q $(DESTDIR)\Wininstall\PackageWeb\*.*
	$(ISWEB)\Pftwwiz.exe $(AFSROOT)\src\winnt\install\InstallShield5\PackageWeb.pfw -s -a 
!ENDIF

install: prep build
