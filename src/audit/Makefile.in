# Copyright 2000, International Business Machines Corporation and others.
# All Rights Reserved.
# 
# This software has been released under the terms of the IBM Public
# License.  For details, see the LICENSE file in the top-level source
# directory or online at http://www.openafs.org/dl/license10.html

# # Auditing is currently only supported for AIX32 machines.  It is
# # integrated with the AIX auditing facility.  The objects, events, 
# # and config files are AIX specific.  The Audit file is not but is
# # included in the rs_aix32 case since other platforms are not
# # supported (if not supported, don't show it).
# ######################################################################

DESTDIR=@DESTDIR@
SRCDIR=@SRCDIR@
TOP_SRCDIR=@TOP_SRCDIR@
SYS_NAME=@AFS_SYSNAME@

SHELL = /bin/sh

include ../config/Makefile.${SYS_NAME}

UKERNELDIR = ../libuafs/

CFLAGS = ${OPTMZ} -I${TOP_SRCDIR}/config -I${SRCDIR}/include ${XCFLAGS}

all: install

install: ukinstall ${DESTDIR}/lib/afs/libaudit.a ${DESTDIR}/include/afs/audit.h
	case ${SYS_NAME} in \
	rs_aix*) \
	   ${INSTALL} Audit              ${DESTDIR}/root.server/usr/afs/local ;  \
	   ${INSTALL} objects.aix.sample ${DESTDIR}/root.server/usr/afs/local/audit/objects.sample ;  \
	   ${INSTALL} events.aix.sample  ${DESTDIR}/root.server/usr/afs/local/audit/events.sample  ;  \
	   ${INSTALL} config.aix.sample  ${DESTDIR}/root.server/usr/afs/local/audit/config.sample  ;; \
        *) ;; \
        esac ;

ukinstall: ${UKERNELDIR}/afs ${UKERNELDIR}/afs/audit.h

${UKERNELDIR}/afs:
	mkdir -p ${UKERNELDIR}/afs

${UKERNELDIR}/afs/audit.h: audit.h
	${INSTALL} $? $@

${DESTDIR}/include/afs/audit.h: audit.h
	${INSTALL} $? $@

${DESTDIR}/lib/afs/libaudit.a: libaudit.a
	${INSTALL} $? $@

libaudit.a: audit.o AFS_component_version_number.o
	$(RM) -f libaudit.a
	ar r libaudit.a audit.o AFS_component_version_number.o
	$(RANLIB) libaudit.a

audit.o: audit.c audit.h 
	${CC} ${CFLAGS} -c audit.c

clean:
	$(RM) -f *.a *.o core AFS_component_version_number.c

include ../config/Makefile.version
