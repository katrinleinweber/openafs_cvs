# Copyright 2000, International Business Machines Corporation and others.
# All Rights Reserved.
# 
# This software has been released under the terms of the IBM Public
# License.  For details, see the LICENSE file in the top-level source
# directory or online at http://www.openafs.org/dl/license10.html

!include ..\config\NTMakefile.$(SYS_NAME)
!include ..\config\NTMakefile.version

# RX has different strings for it's version number.
VERSFILE=RX_component_version_number
CML_PREFIX=rx_

!include ..\config\NTMakefile.version

# Additional debugging flag for RX.
AFSDEV_AUXCDEFINES = -DRXDEBUG

LIBFILE = $(DESTDIR)\lib\afsrx.lib

# Object files by category.
XDROBJS = $(OJT)\xdr.obj $(OJT)\xdr_array.obj $(OJT)\xdr_arrayn.obj $(OJT)\xdr_float.obj $(OJT)\xdr_mem.obj \
	$(OJT)\xdr_rec.obj  $(OJT)\xdr_refernce.obj $(OJT)\xdr_rx.obj $(OJT)\xdr_update.obj \
	$(OJT)\xdr_afsuuid.obj $(OJT)\xdr_int64.obj $(OJT)\xdr_int32.obj

RXOBJS = $(OJT)\rx_event.obj $(OJT)\rx_clock_nt.obj $(OJT)\rx_user.obj $(OJT)\rx_lwp.obj $(OJT)\rx.obj \
	$(OJT)\rx_null.obj $(OJT)\rx_globals.obj $(OJT)\rx_getaddr.obj $(OJT)\rx_misc.obj $(OJT)\rx_packet.obj \
	$(OJT)\rx_rdwr.obj $(OJT)\rx_trace.obj $(OJT)\rx_xmit_nt.obj $(OJT)\rx_conncache.obj

MULTIOBJS = $(OJT)\rx_multi.obj

LIBOBJS = $(RXOBJS) $(MULTIOBJS) $(XDROBJS)

INCFILEDIR = $(DESTDIR)\include\rx

INCFILES  = \
	$(INCFILEDIR)\rx.h \
	$(INCFILEDIR)\rx_packet.h \
	$(INCFILEDIR)\rx_user.h \
	$(INCFILEDIR)\rx_event.h \
	$(INCFILEDIR)\rx_queue.h \
	$(INCFILEDIR)\rx_globals.h \
	$(INCFILEDIR)\rx_clock.h \
	$(INCFILEDIR)\rx_misc.h \
	$(INCFILEDIR)\rx_multi.h \
	$(INCFILEDIR)\rx_null.h \
	$(INCFILEDIR)\rx_lwp.h \
	$(INCFILEDIR)\rx_pthread.h \
	$(INCFILEDIR)\rx_xmit_nt.h \
	$(INCFILEDIR)\xdr_prototypes.h \
	$(INCFILEDIR)\rx_prototypes.h \
	$(INCFILEDIR)\xdr.h

LOCAL_HEADERS = \
	rx_internal.h

$(LIBOBJS): $(INCFILES) $(LOCAL_HEADERS)

$(MULTIOBJS):  rx_multi.h

$(XDROBJS): xdr.h

$(LIBFILE): $(LIBOBJS)
	$(LIBARCH)

# Not yet
#rxdumptrace.exe: rx_trace.c

# build rxdebug.
RXDEBUG = $(DESTDIR)\etc\rxdebug.exe
RXDOBJS = $(OJT)\rxdebug.obj \
	  $(OJT)\rxdebug.res

LIBDIR  = $(DESTDIR)\lib
RXDLIBS = $(LIBDIR)\afs\afscmd.lib \
	  $(LIBDIR)\afsrx.lib \
	  $(LIBDIR)\afslwp.lib \
	  $(LIBDIR)\afs\afsutil.lib \
          $(LIBDIR)\afs\afsreg.lib

$(OJT)\rxdebug.res: rxdebug.rc AFS_component_version_number.h
	$(RC) /Fo$*.RES $(*F).rc 

$(RXDEBUG): $(RXDOBJS) $(RXDLIBS)
	$(EXECONLINK)
	$(EXEPREP)

install: $(LIBFILE) $(INCFILES) $(RXDEBUG)

install9x: $(LIBFILE) $(INCFILES)

clean::
	$(DEL) $(LIBFILE) $(INCFILES)

mkdir:
	
