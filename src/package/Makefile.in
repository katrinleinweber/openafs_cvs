# Copyright 2000, International Business Machines Corporation and others.
# All Rights Reserved.
#
# This software has been released under the terms of the IBM Public
# License.  For details, see the LICENSE file in the top-level source
# directory or online at http://www.openafs.org/dl/license10.html
#
# Makefile for package, the AFS workstation configuration tool.
#
srcdir=@srcdir@
include @TOP_OBJDIR@/src/config/Makefile.config

CFLAGS   = ${COMMON_CFLAGS} -DKFLAG -DANDREW -DVICE -UDEBUG

OBJS =  package.o \
	gram.o \
	lex.o \
	conftree.o \
	check.o \
	update.o \
	fileops.o \
	messages.o \
	misc.o \
	globfuncs.o

TEST_OBJS = test.o \
	test_gram.o \
	lex.o \
	conftree.o \
	messages.o \
	misc.o \
	globfuncs.o

LIBS=${TOP_LIBDIR}/libsys.a \
        ${TOP_LIBDIR}/libcmd.a \
	${TOP_LIBDIR}/libcom_err.a \
        ${TOP_LIBDIR}/librx.a \
	${TOP_LIBDIR}/libsys.a \
	${TOP_LIBDIR}/util.a \
	${TOP_LIBDIR}/liblwp.a \
	${XLIBS}

include ../config/Makefile.version

all	: package package_test

package	: $(OBJS)
	$(CC) $(CFLAGS) -o $@ $(OBJS) $(NON_SHARED) ${LIBS}

package_test : $(TEST_OBJS)
	$(CC) $(CFLAGS) -o package_test $(TEST_OBJS) ${LIBS}

package.o: package.c AFS_component_version_number.o
test.o: test.c AFS_component_version_number.o

lex.c:
	-$(RM) -f lex.c
	$(LEX)  -t lex.l > lex.c

clean	:
	$(RM) -f *.o gram.c test_gram.c core package package_test *.BAK y.output yacc.tmp yacc.acts\
	AFS_component_version_number.c lex.c y.tab.h

install: package package_test makepkgfiles
	${INSTALL} -d ${DESTDIR}${sbindir}
	${INSTALL_PROGRAM} package ${DESTDIR}${sbindir}/package
	${INSTALL_PROGRAM} package_test ${DESTDIR}${sbindir}/package_test
	${INSTALL_PROGRAM} makepkgfiles ${DESTDIR}${sbindir}/makepkgfiles

dest: package package_test makepkgfiles
	${INSTALL} -d ${DEST}/etc
	${INSTALL_PROGRAM} package ${DEST}/etc/package
	${INSTALL_PROGRAM} package_test ${DEST}/etc/package_test
	${INSTALL_PROGRAM} makepkgfiles ${DEST}/etc/makepkgfiles
