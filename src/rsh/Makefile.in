#
# Copyright (c) 1988 Regents of the University of California.
# All rights reserved.
#
# Redistribution and use in source and binary forms are permitted
# provided that the above copyright notice and this paragraph are
# duplicated in all such forms and that any documentation, advertising
# materials, and other materials related to such redistribution and
# use acknowledge that the software was developed by the University
# of California, Berkeley.  The name of the University may not be
# used to endorse or promote products derived from this software
# without specific prior written permission.  THIS SOFTWARE IS PROVIDED
# ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
# WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND
# FITNESS FOR A PARTICULAR PURPOSE.
#
# @(#)Makefile	5.1 (Berkeley) 9/20/88
#
DEST=@DEST@
TOP_INCDIR=@TOP_INCDIR@
TOP_LIBDIR=@TOP_LIBDIR@
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
libexecdir=@libexecdir@
libdir=@libdir@
includedir=@includedir@
mandir=@mandir@
afssrvbindir=@afssrvbindir@
afssrvsbindir=@afssrvsbindir@
afssrvlibexecdir=@afssrvlibexecdir@
COMPILE_ET=${TOP_SRCDIR}/comerr/compile_et
RXGEN=${TOP_SRCDIR}/rxgen/rxgen
TOP_SRCDIR=@TOP_SRCDIR@
SYS_NAME=@AFS_SYSNAME@

SHELL=/bin/sh

include ../config/Makefile.${SYS_NAME}

INCLUDES=-I${TOP_SRCDIR}/config -I${TOP_INCDIR}
CFLAGS=	${DBUG} ${INCLUDES} ${XCFLAGS}
LIBC=	/lib/libc.a
OBJS=   rcmd.o ../inetd/ta-rauth.o herror.o
MAN=	
SRCS=	rsh.c rcmd.c ../inetd/ta-rauth.c herror.c AFS_component_version_number.c
AFSLIBS = ${TOP_LIBDIR}/libkauth.a ${TOP_LIBDIR}/libubik.a \
          ${TOP_LIBDIR}/libauth.a ${TOP_LIBDIR}/libsys.a \
          ${TOP_LIBDIR}/librx.a ${TOP_LIBDIR}/liblwp.a \
	  ${TOP_LIBDIR}/librxkad.a ${TOP_LIBDIR}/libsys.a \
          ${TOP_LIBDIR}/libdes.a ${TOP_LIBDIR}/libcmd.a \
          ${TOP_LIBDIR}/libcom_err.a ${TOP_LIBDIR}/util.a
LIBS = ${AFSLIBS} 

include ../config/Makefile.version

all: rsh

rsh: rsh.o ${OBJS} ${LIBS}
	${CC} -o $@ ${CFLAGS} rsh.o ${OBJS} ${LIBS} ${XLIBS}

rlogin: rlogin.o ${OBJS} ${LIBS}
	${CC} -o $@ ${CFLAGS} rlogin.o ${OBJS} ${LIBS} ${XLIBS}

rlogin.o: rlogin.c AFS_component_version_number.c
rsh.o: rsh.c AFS_component_version_number.c

../rlogind/herror.o: ../rlogind/herror.c
	(cd ../rlogind ; $(MAKE) herror.o )
../inetd/ta-rauth.o : ../inetd/ta-rauth.c
	(cd ../inetd ; $(MAKE) ta-rauth.o DESTDIR=${DESTDIR})

clean:
	$(RM) -f ${OBJS} core rsh *.BAK AFS_component_version_number.c rlogin rlogin.o rsh.o

cleandir: clean
	$(RM) -f ${MAN} tags .depend

depend: ${SRCS}
	mkdep -p ${CFLAGS} ${SRCS}

install: rsh
	set -x; \
	case "${SYS_NAME}" in \
	hp* ) \
		${INSTALL} -m 4755 -f rsh ${DESTDIR}${bindir}/remsh ;; \
	* ) \
		${INSTALL} -m 4755 rsh ${DESTDIR}${bindir}/rsh ;; \
	esac

dest: rsh
	set -x; \
	case "${SYS_NAME}" in \
	hp* ) \
		${INSTALL} -m 4755 -f rsh ${DEST}/bin/remsh ;; \
	* ) \
		${INSTALL} -m 4755 rsh ${DEST}/bin/rsh ;; \
	esac
